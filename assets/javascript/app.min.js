var isHomePage = $('body.homepage');
if (isHomePage){
    $.fn.isInViewport = function() {
        var that = $(this);
        if (that !== 'undefined' && that.length) {
            var elementTop = $(this).offset().top;
            var elementBottom = elementTop + $(this).outerHeight();
            var viewportTop = $(window).scrollTop();
            var viewportBottom = viewportTop + $(window).height();
            return elementBottom > viewportTop && elementTop < viewportBottom;
        }
    };
}

var aboutAnimationHasRan = false;
var aboutUsAnimationHasRan = false;
var valuesAnimationHasRan = false;
var headerAnimationHasRan = false;
var brandsAnimationHasRan = false;
var headerElem = $('#header');
var aboutElem = $('#about');
var brandsElem = $('.brandlist');
var aboutUsElem = $('#aboutUs');
var valuesElem = $('#values');


$(function(){
    if (isHomePage){
        fireAnimations();
        $(window).on('resize scroll', function() {
            fireAnimations();
        });
    }
});

function fireAnimations(){
    if(isHomePage && headerElem.length > 0){
        if(headerElem.isInViewport()){
            var logo = $('#header .logo');
            var caption = $('#header h1');
            var playBtn = $('#header .icon-play');
            if (!headerAnimationHasRan) {
                TweenMax.fromTo(logo, .5, {css: {y: "-30", opacity: 0}}, {css:{y:"0", opacity: "1"}});
                TweenMax.fromTo(caption, .5, {css: {y: "-30", opacity: 0}}, {css:{y:"0", opacity: "1"}, delay: .3});
                TweenMax.fromTo(playBtn, .5, {opacity: 0, scale:1.5, ease:Bounce.ease}, {opacity: 1, scale:1});
                headerAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && headerElem.length > 0){
        if(aboutElem.isInViewport()){
            var leftSideElem = $('#about > .left-container');
            var rightSideElem = $('#about > .right-container');
            if (!aboutAnimationHasRan) {
                TweenMax.fromTo(leftSideElem, 1, {css: {x: "-100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1});
                TweenMax.fromTo(rightSideElem, 1, {css: {x: "100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1});

                aboutAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && aboutUsElem.length > 0){
        if(aboutUsElem.isInViewport()){
            var emplo = $('.employee-wrapper');
            if (!aboutUsAnimationHasRan) {
                TweenMax.staggerFromTo(emplo, 1, {css: {x: "-100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1}, 0.5);
                aboutUsAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && brandsElem.length > 0){
        if(brandsElem.isInViewport()){
            var brand = brandsElem.find('li');
            if (!brandsAnimationHasRan) {
                TweenMax.staggerFromTo(brand, .5, {css: {x: "-40", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: .2}, 0.2);
                brandsAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && valuesElem.length > 0){
        if(valuesElem.isInViewport()){
            var valueItem = $('.valueItem');
            if (!valuesAnimationHasRan) {

                $.each(valueItem, function(){
                    var textElem = $(this).find('strong');
                    var randomNum = (Math.random() * (0.5 - 2.9) + 2.9).toFixed(2);
                    TweenMax.fromTo(textElem, 1, {css: {x: "-10", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: randomNum});
                });

                valuesAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && aboutUsElem.length > 0){
        if(aboutUsElem.isInViewport()){
            var employee = $('.employee-wrapper');
            if (!aboutUsAnimationHasRan) {
                TweenMax.staggerFromTo(employee, 1, {css: {x: "-100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1}, 0.5);
                aboutUsAnimationHasRan = true;
            }
        }
    }
}






// jQuery bootstrap

$(function () {
    //********* Const
    var lastScrollTop = 0
        , hasScrolled = false
        , headerElem = $('#header')
        , isHomePage = $('body.homepage')
        , viewPortHeight = $(window).height()
        , viewPortWidth = $(window).width()
        , animationIncrements = 950
        , step = 0
        , scroll = 0
        , hasSnapped = false
        , methodItem = $('.method-item')
        , methodContent = $('.fadeIn')
        , isMobile = window.orientation > -1 && screen.width <= 640
        , is_iPad = navigator.userAgent.match(/iPad/i) != null
        , placeholder = $('body').find("[data-content='content-method-hoverLabel']");

    //********* Event Handlers

    $(window).on('mousewheel DOMMouseScroll touchmove', function() {
        hasScrolled = true;
    });

    $(window).on('resize', function(){
        viewPortHeight = $(this).height();
        viewPortWidth = $(this).width();
        animationIncrements = $(window).height() / 100 * 20;
    });

    if(isHomePage !== undefined && isHomePage.length > 0){
        var methodContainer = $('#method')
            , methodScrollContainer = $('.method-scroll-wrapper')
            , methodContainerHeight = methodContainer.height()
            , methodContainerOffset = methodContainer.offset().top
            , CaseStudyContainer = $('#case-studies')
            , CaseStudyContainerOffset = ~~CaseStudyContainer.offset().top
            , aboutContainer = $('#about')
            , preAboutContainer = $('#preabout')
            , preAboutContainerOffset = preAboutContainer.offset().top
            , toggleClassName = 'active'
            , visibleClassName = 'show';

        if(isMobile || is_iPad) {
            CaseStudyContainer.addClass(visibleClassName);
            methodContent.addClass(visibleClassName);
            aboutContainer.addClass(visibleClassName);
        }

        $(methodItem).on('mouseenter', function(){
            var item = $(this).attr('data-item');
            $(this).addClass('active');
            $('.diagram-logo').addClass('hidden');
            if(placeholder.length > 0){
                placeholder.addClass('hidden');
            }
            $('.method-desc.'+ item).addClass('active');
            $('#diagram').addClass(item);
        }).on('mouseleave',function(){
            var item = $(this).attr('data-item');
            $(this).removeClass('active');
            $('.diagram-logo').removeClass('hidden');
            if(placeholder.length > 0){
                placeholder.removeClass('hidden');
            }
            $('.method-desc.'+ item).removeClass('active');
            $('#diagram').removeClass(item);
        });

        $('.close-btn').on('click', function(){
            $('body').toggleClass('isPlaying');
            headerElem.removeClass('play');
            headerElem.find('.video-container').removeClass('play');
            $('.youtube-video-embed iframe').attr('id', '').attr('src', '');
        });

        $('.play-video-wrapper').on('click', function(){
            $('body').toggleClass('isPlaying');
            headerElem.addClass('play');
            headerElem.find('.video-container').addClass('play');
            var url = './assets/json/content.json';
            $.getJSON(url, function(data) {
                var loc = getCookie('lang');
                var locData = data[loc];
                var homepage = locData.pages.homepage;
                var header = homepage.header.content;

                $('.youtube-video-embed iframe').attr('id', header.youtubeURL).attr('src', 'https://www.youtube.com/embed/' + header.youtubeURL + '?autoplay=0&rel=0&fs=1&enablejsapi=1')
            });
        });

        $(window).on('scroll', function(){
            scroll = ~~$(this).scrollTop();

            if(viewPortHeight < 1100){
                animationIncrements = 1050;
            }

            methodItem.removeClass(toggleClassName);

            getDirection(scroll, lastScrollTop, function(direction, scroll){
                lastScrollTop = scroll;

                if(scroll && hasScrolled && !isMobile && viewPortWidth > 1200 && !is_iPad) {
                    if(direction === 'down') {
                        //on
                        if (scroll >= methodContainerOffset) {
                            if (!hasSnapped) {
                                methodContent.removeClass(visibleClassName);
                                //methodItem.removeClass('active');
                               // methodScrollContainer.addClass('fixed');
                                methodScrollContainer.addClass(visibleClassName);
                                handleMethodScroll(5);
                            }
                            //hasSnapped = true;
                        }

                        if (scroll >= methodContainerOffset + methodContainerHeight) {
                            CaseStudyContainer.addClass(visibleClassName);
                            methodContent.removeClass(visibleClassName);
                            //methodItem.removeClass('active');
                            //methodScrollContainer.removeClass('fixed');
                            methodScrollContainer.removeClass(visibleClassName);
                            //hasSnapped = false;
                        }

                        if (scroll >= preAboutContainerOffset) {
                            aboutContainer.addClass(visibleClassName);
                        }
                    } else {
                        CaseStudyContainer.addClass(visibleClassName);
                        methodContent.addClass(visibleClassName);
                        aboutContainer.addClass(visibleClassName);
                    }

                    if(direction === 'up') {
                        //on
                        if (scroll < CaseStudyContainerOffset - animationIncrements) {
                            if (!hasSnapped) {
                                //methodItem.removeClass(toggleClassName);
                                //methodScrollContainer.addClass('fixed');
                                methodScrollContainer.addClass(visibleClassName);
                                handleMethodScroll(5);
                            }
                            //hasSnapped = true;
                        }

                        if (scroll <= methodContainerOffset - 100 ) {
                            methodContent.removeClass(toggleClassName);
                            //methodItem.removeClass('active');
                            //methodScrollContainer.removeClass('fixed');
                            //hasSnapped = false;
                        }
                    }

                    if(hasSnapped) {
                        if (scroll > methodContainerOffset && scroll < methodContainerOffset + animationIncrements) {
                            step = 1;
                        } else if (scroll > methodContainerOffset + animationIncrements && scroll < methodContainerOffset + animationIncrements * 2) {
                            step = 2;
                        } else if (scroll > methodContainerOffset + animationIncrements * 2 && scroll < methodContainerOffset + animationIncrements * 3) {
                            step = 3;
                        } else if (scroll > methodContainerOffset + animationIncrements * 3 && scroll < methodContainerOffset + animationIncrements * 4) {
                            step = 4;
                        } else if (scroll > methodContainerOffset + animationIncrements * 4 && scroll < CaseStudyContainerOffset) {
                            step = 5;
                        }

                        handleMethodScroll(step);
                    }

                }
            });
        });
    }
});

function getDirection (scroll, lastScrollTop, callback){
    var direction = null
        , delta = 5;

    if(Math.abs(lastScrollTop - scroll) <= delta) {
        return;
    }

    if (scroll > lastScrollTop){
        direction = 'down';
    } else {
        direction = 'up';
    }
    callback(direction, scroll);
}

// This function showed the appropriate bubble
// currently not used as the scrolling function is disabled
function handleMethodScroll(step){
    var toggleClassName = 'method'
        , fadeInElemClass = '.fadeIn'
        , methodElem = '.method-item'
        , introElemClass = '.intro'
        , designElemClass = '.design'
        , tuningElemClass = '.tuning'
        , constructionElemClass = '.construction'
        , evalElemClass = '.eval';

    $(fadeInElemClass).removeClass(toggleClassName);
    $(methodElem).removeClass(toggleClassName);

    if(step === 1){
        $(fadeInElemClass+introElemClass).addClass(toggleClassName);
        $(methodElem+introElemClass).addClass(toggleClassName);
    } else if(step === 2) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(fadeInElemClass+designElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
    } else if(step === 3) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
        $(fadeInElemClass+tuningElemClass).addClass(toggleClassName);
        $(methodElem+tuningElemClass).addClass(toggleClassName);
    } else if(step === 4) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
        $(methodElem+tuningElemClass).addClass(toggleClassName);
        $(fadeInElemClass+constructionElemClass).addClass(toggleClassName);
        $(methodElem+constructionElemClass).addClass(toggleClassName);
    } else if(step === 5) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
        $(methodElem+tuningElemClass).addClass(toggleClassName);
        $(methodElem+constructionElemClass).addClass(toggleClassName);
        $(fadeInElemClass+evalElemClass).addClass(toggleClassName);
        $(methodElem+evalElemClass).addClass(toggleClassName);
    }
}
chooseCookie();

function setCookie(name,value,days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
}
function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}
function eraseCookie(name) {
    document.cookie = name+'=; Max-Age=-99999999;';
}

function chooseCookie(){
    var userLang = navigator.language || navigator.userLanguage;
    var activeCookie = getCookie('lang');
    if(activeCookie === undefined || activeCookie === null || activeCookie === ''){
        if(userLang.match(/de/g)){
            setCookie('lang','en',7);
        } else if (userLang.match(/en/g)){
            setCookie('lang','en',7);
        } else if (userLang.match(/nl/g)) {
            setCookie('lang','nl',7);
        } else {
            setCookie('lang','nl',7);
        }
    }

    setTimeout(function(){
        $('#nav .active-loc').html(getCookie('lang'));
    },200);
}


$(function () {
    var navIsOpen = false
        , mobileNav = $('#nav ul')
        , hamburgerElem = $('.hamburger')
        , viewPortOffset = $(window).scrollTop();

    $('#nav li a').on('click', function(e){
        e.preventDefault();
        var navLink = $(this).attr('href');
        if(navLink.indexOf('.') !== -1) {
            window.location.href = navLink;
        } else if ($(this).hasClass('loc')){
            eraseCookie('lang');
            setCookie('lang',navLink,7);
            window.location.reload();
        } else if(navLink.indexOf('#') !== -1) {
            var linkPos = $(navLink).offset().top;
            $("html, body").animate({ scrollTop: linkPos });
        }

        if (navIsOpen) {
            hamburgerElem.removeClass("is-active");
            mobileNav.removeClass("open");
            navIsOpen = false;
        }
    });

    hamburgerElem.click(function(){
        $(this).toggleClass("is-active");
        mobileNav.toggleClass("open");
        navIsOpen = true;
    });

    $(window).on('scroll', function(){
        var scroll = ~~$(this).scrollTop();
        fixNav(scroll);
    });

    $('.contact-btn').on('click', function(){
        var footerOffset = $('footer').offset().top;
        $("html, body").animate({ scrollTop: footerOffset });
    });

    fixNav(viewPortOffset);
});


function fixNav(scroll){
    var nav = $("#nav");
    if (scroll >= 500) {
        nav.addClass("fixed");
    } else {
        nav.removeClass("fixed");
    }
}
$(function(){
    // Load projects
    if ($('body').hasClass('homepage')){
        var url = './assets/json/content.bin';
        $.ajax({
            url: url,
            scriptCharset: "utf-8",
            type: "GET",
            success: function (data) {
                var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))));
                var loc = getCookie('lang');
                var locData = actual[loc];
                var homepage = locData.pages.homepage;
                var comparison = homepage.content.comparison;
                var comparisonWrapper = $("#comparison");
                var comparisonItem = comparison.comparisons || '';
                $.each(comparisonItem, function (index, item) {
                    comparisonWrapper.append('<div class="item"><img data-content="content-comparison-before" src="' + item.before + '" class="before" alt>\n' +
                        '<div data-content="content-comparison-after" class="after" style="background-image: url(' + item.after + ')"></div></div>');
                });

                sliderInit(comparisonWrapper);
            }
        });
    }
});

function sliderInit(projectElem){
    projectElem.not('.slick-initialized').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        autoplay: true,
        autoplaySpeed: 3000,
        nextArrow: '.icon-arrow-right',
        prevArrow: '.icon-arrow-left',
        swipeToSlide: false
    });
    projectElem.on('setPosition', function(event, slick, currentSlide, nextSlide){
        var inkbox = projectElem.find('.slick-active');
        if (inkbox) {
            inkbox.on("mousemove",trackLocation);
            inkbox.on("touchstart",trackLocation);
            inkbox.on("touchmove",trackLocation);
        }
    });
}

function trackLocation(e){
    var colorbox = $('.slick-active .after')
        , fillerImage = $('.slick-active .before')
        , rect = fillerImage[0].getBoundingClientRect()
        , fillerImageOw = fillerImage.outerWidth()
        , position = ((e.pageX - rect.left) / fillerImageOw)*100;

    if(position <= 100){
        colorbox.css('width', position+"%");
    }
}


$(function(){
    var url = './assets/json/content.bin';
    var $body = $("body");

    $.ajax({
        url: url,
        scriptCharset: "utf-8",
        type: "GET",
        success: function (data) {
            var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))));
            var loc = getCookie('lang');
            var locData = actual[loc];
            var nav = locData.nav.labels;
            var homepage = locData.pages.homepage;
            var header = homepage.header.content;
            var intro = homepage.content.intro;
            var brands = intro.images;
            var about = homepage.content.about;
            var aboutUs = homepage.content.aboutUs;
            var values = homepage.content.values;
            var comparison = homepage.content.comparison;
            var method = homepage.content.method;
            var model = homepage.content.model;
            var projects = homepage.content.projects;
            var footer = homepage.footer;

            if (locData) {
                $body.removeClass('loading');
            }

            if(nav) {
                var navItem = $('#nav > ul > li ');
                navItem.find('a[href="#preabout"]').html(nav.about);
                navItem.find('a[href="index.html#preabout"]').html(nav.about);
                navItem.find('a[href="#method"]').html(nav.method);
                navItem.find('a[href="index.html#method"]').html(nav.method);
                navItem.find('a[href="#values"]').html(nav.values);
                navItem.find('a[href="index.html#values"]').html(nav.values);
                navItem.find('a[href="#aboutUs"]').html(nav.aboutUs);
                navItem.find('a[href="index.html#aboutUs"]').html(nav.aboutUs);
                navItem.find('a[href="projects.html"]').html(nav.projects);
                navItem.find('a[href="#footer"]').html(nav.contact);
                navItem.find('a[href="#footer"]').html(nav.contact);
                navItem.find('a[href="#mission"]').html(nav.mission);
                navItem.find('a[href="index.html#mission"]').html(nav.mission);
                navItem.find('a[href="#model"]').html(nav.model);
                navItem.find('a[href="index.html#model"]').html(nav.model);
                navItem.find('a[href="#foundation"]').html(nav.foundation);
                navItem.find('a[href="index.html#foundation"]').html(nav.foundation);
                navItem.find('a[href="#comparison"]').html(nav.comparison);
                navItem.find('a[href="index.html#comparison"]').html(nav.comparison);
            }

            if (header) {
                $('.background-video').css({'backgroundImage': header.backgroundImageSrc});
                $('.youtube-video-embed iframe').attr('id', header.youtubeURL).attr('src', 'https://www.youtube.com/embed/' + header.youtubeURL + '?autoplay=0&rel=0&fs=1&enablejsapi=1')
                $('video source#mp4').attr('src', header.backgroundVideoMp4Src);
                $('video source#webm').attr('src', header.backgroundVideoWebMSrc);
                $body.find("[data-content='header-content-title']").html(header.header);
            }

            if (intro) {
                $body.find("[data-content='content-intro-title']").html(intro.header);
                $body.find("[data-content='content-intro-desc']").html(intro.description);

                if($('.brandlist').length > 0){
                    $.each(brands, function (index, brand) {
                        if(brand.src){
                            $body.find('.brandlist').append('<li><img src="'+brand.src+'" alt="'+brand.alt+'" /></li>');
                        }
                    });
                }
            }

            if (about) {
                $body.find("[data-content='content-about-row1-title']").html(about.row1.header);
                $body.find("[data-content='content-about-row1-image']").css({'backgroundImage': about.row1.image.src});
                $body.find("[data-content='content-about-row1-desc']").html(about.row1.description);

                $body.find("[data-content='content-about-row2-title']").html(about.row2.header);
                $body.find("[data-content='content-about-row2-image']").css({'backgroundImage': about.row2.image.src});
                $body.find("[data-content='content-about-row2-desc']").html(about.row2.description);
            }

            if (aboutUs) {
                $body.find("[data-content='content-aboutUs-title']").html(aboutUs.header);
                $body.find("[data-content='content-aboutUs-description']").html(aboutUs.description);

                $body.find("[data-content='content-employee-niek-image']").attr('src', aboutUs.employees.niek.image.src).attr('alt', aboutUs.employees.niek.image.alt);
                $body.find("[data-content='content-employee-niek-title']").html(aboutUs.employees.niek.header);
                $body.find("[data-content='content-employee-niek-desc']").html(aboutUs.employees.niek.description);

                $body.find("[data-content='content-employee-jan-image']").attr('src', aboutUs.employees.jan.image.src).attr('alt', aboutUs.employees.jan.image.alt);
                $body.find("[data-content='content-employee-jan-title']").html(aboutUs.employees.jan.header);
                $body.find("[data-content='content-employee-jan-desc']").html(aboutUs.employees.jan.description);
            }

            if (values) {
                $body.find("[data-content='content-values-image']").css({'backgroundImage': values.image.src});
                $body.find("[data-content='content-values-title']").html(values.header);
                $body.find("[data-content='content-values-desc']").html(values.description);

                $body.find("[data-content='content-value1']").html(values.values.value1);
                $body.find("[data-content='content-value2']").html(values.values.value2);
                $body.find("[data-content='content-value3']").html(values.values.value3);
                $body.find("[data-content='content-value4']").html(values.values.value4);
                $body.find("[data-content='content-value5']").html(values.values.value5);
                $body.find("[data-content='content-value6']").html(values.values.value6);
            }

            if (method) {
                $body.find("[data-content='content-method-title']").html(method.header);
                $body.find("[data-content='content-method-desc']").html(method.description);
                $body.find("[data-content='content-method-hoverLabel']").html(method.hoverLabel);

                $body.find("[data-content='content-method-intro-title']").html(method.methods.intro.header);
                $body.find("[data-content='content-method-intro-desc']").html(method.methods.intro.description);

                $body.find("[data-content='content-method-design-title']").html(method.methods.design.header);
                $body.find("[data-content='content-method-design-desc']").html(method.methods.design.description);

                $body.find("[data-content='content-method-tuning-title']").html(method.methods.tuning.header);
                $body.find("[data-content='content-method-tuning-desc']").html(method.methods.tuning.description);

                $body.find("[data-content='content-method-construction-title']").html(method.methods.construction.header);
                $body.find("[data-content='content-method-construction-desc']").html(method.methods.construction.description);

                $body.find("[data-content='content-method-eval-title']").html(method.methods.eval.header);
                $body.find("[data-content='content-method-eval-desc']").html(method.methods.eval.description);
            }

            if (model) {
                $body.find("[data-content='content-model-title']").html(model.header);
                $body.find("[data-content='content-model-image']").css({'backgroundImage': model.image.src});
                $body.find("[data-content='content-model-desc']").html(model.description);
            }

            if (projects) {
                $body.find("[data-content='content-projects-title']").html(projects.header);
                $body.find("[data-content='content-projects-desc']").html(projects.description);
                $body.find("[data-content='content-projects-button']").html(projects.button.label);

                $body.find("[data-content='content-project1-image']").attr('src', projects.project1.image.src).attr('alt', projects.project1.image.alt);
                $body.find("[data-content='content-project1-title']").html(projects.project1.header);
                $body.find("[data-content='content-project1-btn']").html(projects.project1.button);

                $body.find("[data-content='content-project2-image']").attr('src', projects.project2.image.src).attr('alt', projects.project2.image.alt);
                $body.find("[data-content='content-project2-title']").html(projects.project2.header);
                $body.find("[data-content='content-project2-btn']").html(projects.project2.button);
            }

            if(comparison){
                $body.find("[data-content='content-projects-comparison-title']").html(comparison.header);
                $body.find("[data-content='content-projects-comparison-desc']").html(comparison.description);
            }

            if (footer) {
                $body.find("[data-content='footer-testimonials-title']").html(footer.testimonials.header);
                $body.find("[data-content='footer-contacts-header']").html(footer.contacts.header);

                $body.find("[data-content='footer-contacts-jan-title']").html(footer.contacts.jan.header);
                $body.find("[data-content='footer-contacts-jan-email']").attr('href', footer.contacts.jan.links.email.src).html(footer.contacts.jan.links.email.header);
                $body.find("[data-content='footer-contacts-linkedin-jan']").attr('href', footer.contacts.jan.links.linkedin.src);
                $body.find("[data-content='footer-contacts-linkedin-jan-title']").html( footer.contacts.jan.links.linkedin.header+' ');
                $body.find("[data-content='footer-contacts-call-jan-phone']").attr('href', footer.contacts.jan.phone);

                $body.find("[data-content='footer-contacts-niek-title']").html(footer.contacts.niek.header);
                $body.find("[data-content='footer-contacts-niek-email']").attr('href', footer.contacts.niek.links.email.src).html(footer.contacts.niek.links.email.header);
                $body.find("[data-content='footer-contacts-linkedin-niek']").attr('href', footer.contacts.niek.links.linkedin.src);
                $body.find("[data-content='footer-contacts-linkedin-niek-title']").html(footer.contacts.niek.links.linkedin.header+' ');
                $body.find("[data-content='footer-contacts-call-niek-phone']").attr('href', footer.contacts.niek.phone);

                $body.find("[data-content='footer-contacts-phone-header']").html(footer.phone.header);
                $body.find("[data-content='footer-contacts-visit-header']").html(footer.visit.header);

                $body.find("[data-content='footer-contacts-visit-desc']").html(footer.visit.description);
                $body.find("[data-content='footer-copyright-desc']").html(footer.copyright.description);
            }
        }
    });
});

// Google maps setup

var map;
google.maps.event.addDomListener(window, 'load', googleMapsInit);

function googleMapsInit() {
    var myLatlng = new google.maps.LatLng(51.372027, 6.160478);
    var mapOptions = {
        zoom: 15,
        center: myLatlng,
        scrollwheel: false,
        navigationControl: false,
        mapTypeControl: false,
        scaleControl: false,
        disableDefaultUI: true,
        styles: [{"featureType":"landscape","stylers":[{"visibility":"simplified"},{"color":"#2b3f57"},{"weight":0.1}]},{"featureType":"administrative","stylers":[{"visibility":"on"},{"hue":"#ff0000"},{"weight":0.4},{"color":"#ffffff"}]},{"featureType":"road.highway","elementType":"labels.text","stylers":[{"weight":1.3},{"color":"#FFFFFF"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"color":"#f55f77"},{"weight":3}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#f55f77"},{"weight":1.1}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#f55f77"},{"weight":0.4}]},{},{"featureType":"road.highway","elementType":"labels","stylers":[{"weight":0.8},{"color":"#ffffff"},{"visibility":"on"}]},{"featureType":"road.local","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"road.arterial","elementType":"labels","stylers":[{"color":"#ffffff"},{"weight":0.7}]},{"featureType":"poi","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi","stylers":[{"color":"#6c5b7b"}]},{"featureType":"water","stylers":[{"color":"#f3b191"}]},{"featureType":"transit.line","stylers":[{"visibility":"on"}]}]
    };

    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

    var marker = new google.maps.Marker({
        position: myLatlng,
        icon: '//expo-mate.github.io/assets/images/marker.png',
        map: map
    });

    var infowindow = new google.maps.InfoWindow({
        content: $('.contact-details-map').html()
    });


    if($(window).width() > 450){
        map.panBy(200, -150);
    }

    google.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map,marker);
    });
}
$(function(){
    // Load projects
    if ($('body').hasClass('projects')){
        var url = './assets/json/content.bin';
        var hash = window.location.hash;

        $.ajaxSetup({
            scriptCharset: "utf-8",
            contentType: "application/json; charset=utf-8"
        });

        $.ajax({
            url: url,
            scriptCharset: "utf-8",
            type: "GET",
            success: function (data) {
                var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))))
                , loc = getCookie('lang')
                , homeproject = actual[loc].pages.homepage.content.projects
                , reviewLink = homeproject.reviewLink || ''
                , projectDetail = actual[loc].pages.projects
                , section = $('#projects .projects-wrapper');

                $.each(projectDetail, function (index, item) {
                    var imageArray = []
                        , imageContent = item.images
                        , count = parseInt(index) + 1
                        , review = item.review
                        , author = review.author || ''
                        , desc = review.description || ''
                        , reviewDate = review.date || ''
                        , identifier = author.replace(/[^A-Z0-9]+/ig, "-").toLowerCase()
                        , starCount = review.stars || '';

                    if (imageContent && imageContent.length > 0) {
                        $.each(imageContent, function (index, item) {
                            if(item){
                                imageArray.push('<div class="project-image" style="background-image: url('+item.src+')"></div>')
                            }
                        });
                    }

                    section.append('<div class="project" id="project'+count+'">\n' +
                                    '	<div class="project-close"></div>\n' +
                                    '	<div class="project-wrapper">\n' +
                                    '		<div class="project-images">\n' +
                                    '			<div class="slider">'+imageArray.join("")+'</div>\n' +
                                    '		</div>\n' +
                                    '		<div class="project-desc-wrapper">\n' +
                                    '			<div class="project-desc-content">\n' +
                                    '				<div class="project-header">\n' +
                                    '					<h2 class="project-title">'+item.header+'</h2>\n' +
                                    '					<div class="project-sub-title">'+item.subTitle+'</div>\n' +
                                    '				</div>\n' +
                                    '				<div class="project-desc"> \n' +
                                    '				   <span>'+item.description+'</span> \n' +
                                    '				   <a class="read-review" data-count="'+count+'">'+reviewLink+' '+item.header+'</a> \n' +
                                    '			   </div>\n' +
                                    '			</div>\n' +
                                    '		</div> \n' +
                                    '	</div>\n' +
                                    '	<div class="project-review">\n' +
                                    '		<div class="review-close"></div> \n' +
                                    '		<div class="review" id="'+identifier+'">\n' +
                                    '			<div class="review-author">'+author+'</div>\n' +
                                    '			<div class="review-date">'+reviewDate+'</div>\n' +
                                    '           <div class="review-stars"><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full fifth"></i></div>\n' +
                                    '			<div class="review-text">'+desc+'</div>\n' +
                                    '		</div>\n' +
                                    '	</div>\n' +
                                    '</div>');

                    if (starCount === 4) {
                        $('.review-stars').find('.fifth').remove();
                    }

                    if (review === undefined || desc === '' || desc === undefined){
                        $('#project'+count).find('.read-review').addClass('hidden');
                    }

                    $('.project-images').on('click', function(){
                        if(!$('body').hasClass('open')) {
                            $(this).parent().parent('.project').addClass('open');
                            var parentID = $(this).parent().parent('.project').attr('id');
                            document.location.href = "#" + parentID;
                            $('body').addClass('open');
                            sliderInit(parentID);
                        }
                    });

                    $('.project-title').on('click', function(){
                        if(!$('body').hasClass('open')){
                            var parentElem = $(this).parent().parent().parent().parent().parent();
                            parentElem.addClass('open');
                            var parentID = parentElem.attr('id');
                            document.location.href="#"+parentID;
                            $('body').addClass('open');
                            sliderInit(parentID);
                        }
                    });

                    $('.project-close').on('click', function() {
                        $('body').removeClass('open');
                        $(this).parent('.project').removeClass('open');
                        var parentID = $(this).parent('.project').attr('id');
                        $('#'+parentID+' .slider').slick("unslick");
                        window.location.hash="";
                        document.getElementById(parentID).scrollIntoView(true);
                    });

                    $('.read-review').on('click', function(e){
                        e.preventDefault();
                        var count = $(this).attr('data-count');
                        $("#project"+count).addClass('show-review').find('.project-review').addClass('show');
                    });

                    $('.review-close').on('click', function(){
                        $(this).parent().removeClass('show').parent('.project').removeClass('show-review');
                    });

                    if(hash && hash !== undefined){
                        hash = window.location.hash.substring(1);
                        var projectID = "project"+count;
                        if (projectID === hash) {
                            $('#'+hash).addClass('open');
                            $('body').addClass('open');
                            sliderInit(projectID);
                        }
                    }
                });
            }
        });
    }
});


function sliderInit(projectElem){
    if(typeof projectElem === 'string'){
        $('#'+projectElem+' .slider').not('.slick-initialized').slick({
            slidesToShow: 1,
            slidesToScroll: 1,
            autoplay: true,
            autoplaySpeed: 8000,
            arrows: true
        });
    }
}



var testimonial = $('#google-reviews');

$(function() {
    var url = './assets/json/content.bin';
    $.ajax({
        url: url,
        scriptCharset: "utf-8",
        type: "GET",
        success: function (data) {
            var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))));
            var loc = getCookie('lang');
            var projectDetail = actual[loc].pages.projects;

            $.each(projectDetail, function (index, item) {
                var review = item.review
                    , author = review.author || ''
                    , desc = review.description || ''
                    , reviewDate = review.date || ''
                    , identifier = author.replace(/[^A-Z0-9]+/ig, "-").toLowerCase()
                    , starCount = review.stars || '';

                if (review && review !== undefined && desc !== '' && desc !== undefined) {
                    testimonial.addClass('hidden');
                    if (testimonial.length > 0) {
                        testimonial.append('<div class="review" id="' + identifier + '">\n' +
                            '               <div class="review-author">' + author + '</div>\n' +
                            '               <div class="review-date">' + reviewDate + '</div>\n' +
                            '               <div class="review-stars"><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full fifth"></i></div>\n' +
                            '               <div class="review-text">' + review.description + '</div>\n' +
                            '            </div>');

                        if (starCount === 4) {
                            $('.review-stars').find('.fifth').remove();
                        }
                    }
                }
            });

            setTimeout(function () {
                reviewSlider();
            }, 1000);
        }
    });
});


function reviewSlider(){
    testimonial.removeClass('hidden');
    testimonial.not('.slick-initialized').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        autoplay: true,
        fade: true,
        infinite: true,
        autoplaySpeed: 8000,
        arrows: true
    });
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuaW1hdGlvbnMuanMiLCJib290c3RyYXAuanMiLCJjb29raWVzLmpzIiwiaGVhZGVyLmpzIiwiaW1hZ2VDb21wYXJpc29uLmpzIiwibG9jYWxlLmpzIiwibWFwc0luaXQuanMiLCJwcm9qZWN0LWJvb3RzdHJhcC5qcyIsInJldmlld3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGlzSG9tZVBhZ2UgPSAkKCdib2R5LmhvbWVwYWdlJyk7XHJcbmlmIChpc0hvbWVQYWdlKXtcclxuICAgICQuZm4uaXNJblZpZXdwb3J0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIHRoYXQgPSAkKHRoaXMpO1xyXG4gICAgICAgIGlmICh0aGF0ICE9PSAndW5kZWZpbmVkJyAmJiB0aGF0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICB2YXIgZWxlbWVudFRvcCA9ICQodGhpcykub2Zmc2V0KCkudG9wO1xyXG4gICAgICAgICAgICB2YXIgZWxlbWVudEJvdHRvbSA9IGVsZW1lbnRUb3AgKyAkKHRoaXMpLm91dGVySGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydFRvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcclxuICAgICAgICAgICAgdmFyIHZpZXdwb3J0Qm90dG9tID0gdmlld3BvcnRUb3AgKyAkKHdpbmRvdykuaGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50Qm90dG9tID4gdmlld3BvcnRUb3AgJiYgZWxlbWVudFRvcCA8IHZpZXdwb3J0Qm90dG9tO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuXHJcbnZhciBhYm91dEFuaW1hdGlvbkhhc1JhbiA9IGZhbHNlO1xyXG52YXIgYWJvdXRVc0FuaW1hdGlvbkhhc1JhbiA9IGZhbHNlO1xyXG52YXIgdmFsdWVzQW5pbWF0aW9uSGFzUmFuID0gZmFsc2U7XHJcbnZhciBoZWFkZXJBbmltYXRpb25IYXNSYW4gPSBmYWxzZTtcclxudmFyIGJyYW5kc0FuaW1hdGlvbkhhc1JhbiA9IGZhbHNlO1xyXG52YXIgaGVhZGVyRWxlbSA9ICQoJyNoZWFkZXInKTtcclxudmFyIGFib3V0RWxlbSA9ICQoJyNhYm91dCcpO1xyXG52YXIgYnJhbmRzRWxlbSA9ICQoJy5icmFuZGxpc3QnKTtcclxudmFyIGFib3V0VXNFbGVtID0gJCgnI2Fib3V0VXMnKTtcclxudmFyIHZhbHVlc0VsZW0gPSAkKCcjdmFsdWVzJyk7XHJcblxyXG5cclxuJChmdW5jdGlvbigpe1xyXG4gICAgaWYgKGlzSG9tZVBhZ2Upe1xyXG4gICAgICAgIGZpcmVBbmltYXRpb25zKCk7XHJcbiAgICAgICAgJCh3aW5kb3cpLm9uKCdyZXNpemUgc2Nyb2xsJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGZpcmVBbmltYXRpb25zKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gZmlyZUFuaW1hdGlvbnMoKXtcclxuICAgIGlmKGlzSG9tZVBhZ2UgJiYgaGVhZGVyRWxlbS5sZW5ndGggPiAwKXtcclxuICAgICAgICBpZihoZWFkZXJFbGVtLmlzSW5WaWV3cG9ydCgpKXtcclxuICAgICAgICAgICAgdmFyIGxvZ28gPSAkKCcjaGVhZGVyIC5sb2dvJyk7XHJcbiAgICAgICAgICAgIHZhciBjYXB0aW9uID0gJCgnI2hlYWRlciBoMScpO1xyXG4gICAgICAgICAgICB2YXIgcGxheUJ0biA9ICQoJyNoZWFkZXIgLmljb24tcGxheScpO1xyXG4gICAgICAgICAgICBpZiAoIWhlYWRlckFuaW1hdGlvbkhhc1Jhbikge1xyXG4gICAgICAgICAgICAgICAgVHdlZW5NYXguZnJvbVRvKGxvZ28sIC41LCB7Y3NzOiB7eTogXCItMzBcIiwgb3BhY2l0eTogMH19LCB7Y3NzOnt5OlwiMFwiLCBvcGFjaXR5OiBcIjFcIn19KTtcclxuICAgICAgICAgICAgICAgIFR3ZWVuTWF4LmZyb21UbyhjYXB0aW9uLCAuNSwge2Nzczoge3k6IFwiLTMwXCIsIG9wYWNpdHk6IDB9fSwge2Nzczp7eTpcIjBcIiwgb3BhY2l0eTogXCIxXCJ9LCBkZWxheTogLjN9KTtcclxuICAgICAgICAgICAgICAgIFR3ZWVuTWF4LmZyb21UbyhwbGF5QnRuLCAuNSwge29wYWNpdHk6IDAsIHNjYWxlOjEuNSwgZWFzZTpCb3VuY2UuZWFzZX0sIHtvcGFjaXR5OiAxLCBzY2FsZToxfSk7XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJBbmltYXRpb25IYXNSYW4gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmKGlzSG9tZVBhZ2UgJiYgaGVhZGVyRWxlbS5sZW5ndGggPiAwKXtcclxuICAgICAgICBpZihhYm91dEVsZW0uaXNJblZpZXdwb3J0KCkpe1xyXG4gICAgICAgICAgICB2YXIgbGVmdFNpZGVFbGVtID0gJCgnI2Fib3V0ID4gLmxlZnQtY29udGFpbmVyJyk7XHJcbiAgICAgICAgICAgIHZhciByaWdodFNpZGVFbGVtID0gJCgnI2Fib3V0ID4gLnJpZ2h0LWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICBpZiAoIWFib3V0QW5pbWF0aW9uSGFzUmFuKSB7XHJcbiAgICAgICAgICAgICAgICBUd2Vlbk1heC5mcm9tVG8obGVmdFNpZGVFbGVtLCAxLCB7Y3NzOiB7eDogXCItMTAwXCIsIG9wYWNpdHk6IDB9fSwge2Nzczp7eDpcIjBcIiwgb3BhY2l0eTogXCIxXCJ9LCBkZWxheTogMX0pO1xyXG4gICAgICAgICAgICAgICAgVHdlZW5NYXguZnJvbVRvKHJpZ2h0U2lkZUVsZW0sIDEsIHtjc3M6IHt4OiBcIjEwMFwiLCBvcGFjaXR5OiAwfX0sIHtjc3M6e3g6XCIwXCIsIG9wYWNpdHk6IFwiMVwifSwgZGVsYXk6IDF9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBhYm91dEFuaW1hdGlvbkhhc1JhbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaXNIb21lUGFnZSAmJiBhYm91dFVzRWxlbS5sZW5ndGggPiAwKXtcclxuICAgICAgICBpZihhYm91dFVzRWxlbS5pc0luVmlld3BvcnQoKSl7XHJcbiAgICAgICAgICAgIHZhciBlbXBsbyA9ICQoJy5lbXBsb3llZS13cmFwcGVyJyk7XHJcbiAgICAgICAgICAgIGlmICghYWJvdXRVc0FuaW1hdGlvbkhhc1Jhbikge1xyXG4gICAgICAgICAgICAgICAgVHdlZW5NYXguc3RhZ2dlckZyb21UbyhlbXBsbywgMSwge2Nzczoge3g6IFwiLTEwMFwiLCBvcGFjaXR5OiAwfX0sIHtjc3M6e3g6XCIwXCIsIG9wYWNpdHk6IFwiMVwifSwgZGVsYXk6IDF9LCAwLjUpO1xyXG4gICAgICAgICAgICAgICAgYWJvdXRVc0FuaW1hdGlvbkhhc1JhbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaXNIb21lUGFnZSAmJiBicmFuZHNFbGVtLmxlbmd0aCA+IDApe1xyXG4gICAgICAgIGlmKGJyYW5kc0VsZW0uaXNJblZpZXdwb3J0KCkpe1xyXG4gICAgICAgICAgICB2YXIgYnJhbmQgPSBicmFuZHNFbGVtLmZpbmQoJ2xpJyk7XHJcbiAgICAgICAgICAgIGlmICghYnJhbmRzQW5pbWF0aW9uSGFzUmFuKSB7XHJcbiAgICAgICAgICAgICAgICBUd2Vlbk1heC5zdGFnZ2VyRnJvbVRvKGJyYW5kLCAuNSwge2Nzczoge3g6IFwiLTQwXCIsIG9wYWNpdHk6IDB9fSwge2Nzczp7eDpcIjBcIiwgb3BhY2l0eTogXCIxXCJ9LCBkZWxheTogLjJ9LCAwLjIpO1xyXG4gICAgICAgICAgICAgICAgYnJhbmRzQW5pbWF0aW9uSGFzUmFuID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZihpc0hvbWVQYWdlICYmIHZhbHVlc0VsZW0ubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgaWYodmFsdWVzRWxlbS5pc0luVmlld3BvcnQoKSl7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZUl0ZW0gPSAkKCcudmFsdWVJdGVtJyk7XHJcbiAgICAgICAgICAgIGlmICghdmFsdWVzQW5pbWF0aW9uSGFzUmFuKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgJC5lYWNoKHZhbHVlSXRlbSwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dEVsZW0gPSAkKHRoaXMpLmZpbmQoJ3N0cm9uZycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5kb21OdW0gPSAoTWF0aC5yYW5kb20oKSAqICgwLjUgLSAyLjkpICsgMi45KS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIFR3ZWVuTWF4LmZyb21Ubyh0ZXh0RWxlbSwgMSwge2Nzczoge3g6IFwiLTEwXCIsIG9wYWNpdHk6IDB9fSwge2Nzczp7eDpcIjBcIiwgb3BhY2l0eTogXCIxXCJ9LCBkZWxheTogcmFuZG9tTnVtfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YWx1ZXNBbmltYXRpb25IYXNSYW4gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmKGlzSG9tZVBhZ2UgJiYgYWJvdXRVc0VsZW0ubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgaWYoYWJvdXRVc0VsZW0uaXNJblZpZXdwb3J0KCkpe1xyXG4gICAgICAgICAgICB2YXIgZW1wbG95ZWUgPSAkKCcuZW1wbG95ZWUtd3JhcHBlcicpO1xyXG4gICAgICAgICAgICBpZiAoIWFib3V0VXNBbmltYXRpb25IYXNSYW4pIHtcclxuICAgICAgICAgICAgICAgIFR3ZWVuTWF4LnN0YWdnZXJGcm9tVG8oZW1wbG95ZWUsIDEsIHtjc3M6IHt4OiBcIi0xMDBcIiwgb3BhY2l0eTogMH19LCB7Y3NzOnt4OlwiMFwiLCBvcGFjaXR5OiBcIjFcIn0sIGRlbGF5OiAxfSwgMC41KTtcclxuICAgICAgICAgICAgICAgIGFib3V0VXNBbmltYXRpb25IYXNSYW4gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5cclxuXHJcbiIsIlxyXG5cclxuLy8galF1ZXJ5IGJvb3RzdHJhcFxyXG5cclxuJChmdW5jdGlvbiAoKSB7XHJcbiAgICAvLyoqKioqKioqKiBDb25zdFxyXG4gICAgdmFyIGxhc3RTY3JvbGxUb3AgPSAwXHJcbiAgICAgICAgLCBoYXNTY3JvbGxlZCA9IGZhbHNlXHJcbiAgICAgICAgLCBoZWFkZXJFbGVtID0gJCgnI2hlYWRlcicpXHJcbiAgICAgICAgLCBpc0hvbWVQYWdlID0gJCgnYm9keS5ob21lcGFnZScpXHJcbiAgICAgICAgLCB2aWV3UG9ydEhlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKVxyXG4gICAgICAgICwgdmlld1BvcnRXaWR0aCA9ICQod2luZG93KS53aWR0aCgpXHJcbiAgICAgICAgLCBhbmltYXRpb25JbmNyZW1lbnRzID0gOTUwXHJcbiAgICAgICAgLCBzdGVwID0gMFxyXG4gICAgICAgICwgc2Nyb2xsID0gMFxyXG4gICAgICAgICwgaGFzU25hcHBlZCA9IGZhbHNlXHJcbiAgICAgICAgLCBtZXRob2RJdGVtID0gJCgnLm1ldGhvZC1pdGVtJylcclxuICAgICAgICAsIG1ldGhvZENvbnRlbnQgPSAkKCcuZmFkZUluJylcclxuICAgICAgICAsIGlzTW9iaWxlID0gd2luZG93Lm9yaWVudGF0aW9uID4gLTEgJiYgc2NyZWVuLndpZHRoIDw9IDY0MFxyXG4gICAgICAgICwgaXNfaVBhZCA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL2lQYWQvaSkgIT0gbnVsbFxyXG4gICAgICAgICwgcGxhY2Vob2xkZXIgPSAkKCdib2R5JykuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWhvdmVyTGFiZWwnXVwiKTtcclxuXHJcbiAgICAvLyoqKioqKioqKiBFdmVudCBIYW5kbGVyc1xyXG5cclxuICAgICQod2luZG93KS5vbignbW91c2V3aGVlbCBET01Nb3VzZVNjcm9sbCB0b3VjaG1vdmUnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBoYXNTY3JvbGxlZCA9IHRydWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmlld1BvcnRIZWlnaHQgPSAkKHRoaXMpLmhlaWdodCgpO1xyXG4gICAgICAgIHZpZXdQb3J0V2lkdGggPSAkKHRoaXMpLndpZHRoKCk7XHJcbiAgICAgICAgYW5pbWF0aW9uSW5jcmVtZW50cyA9ICQod2luZG93KS5oZWlnaHQoKSAvIDEwMCAqIDIwO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYoaXNIb21lUGFnZSAhPT0gdW5kZWZpbmVkICYmIGlzSG9tZVBhZ2UubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgdmFyIG1ldGhvZENvbnRhaW5lciA9ICQoJyNtZXRob2QnKVxyXG4gICAgICAgICAgICAsIG1ldGhvZFNjcm9sbENvbnRhaW5lciA9ICQoJy5tZXRob2Qtc2Nyb2xsLXdyYXBwZXInKVxyXG4gICAgICAgICAgICAsIG1ldGhvZENvbnRhaW5lckhlaWdodCA9IG1ldGhvZENvbnRhaW5lci5oZWlnaHQoKVxyXG4gICAgICAgICAgICAsIG1ldGhvZENvbnRhaW5lck9mZnNldCA9IG1ldGhvZENvbnRhaW5lci5vZmZzZXQoKS50b3BcclxuICAgICAgICAgICAgLCBDYXNlU3R1ZHlDb250YWluZXIgPSAkKCcjY2FzZS1zdHVkaWVzJylcclxuICAgICAgICAgICAgLCBDYXNlU3R1ZHlDb250YWluZXJPZmZzZXQgPSB+fkNhc2VTdHVkeUNvbnRhaW5lci5vZmZzZXQoKS50b3BcclxuICAgICAgICAgICAgLCBhYm91dENvbnRhaW5lciA9ICQoJyNhYm91dCcpXHJcbiAgICAgICAgICAgICwgcHJlQWJvdXRDb250YWluZXIgPSAkKCcjcHJlYWJvdXQnKVxyXG4gICAgICAgICAgICAsIHByZUFib3V0Q29udGFpbmVyT2Zmc2V0ID0gcHJlQWJvdXRDb250YWluZXIub2Zmc2V0KCkudG9wXHJcbiAgICAgICAgICAgICwgdG9nZ2xlQ2xhc3NOYW1lID0gJ2FjdGl2ZSdcclxuICAgICAgICAgICAgLCB2aXNpYmxlQ2xhc3NOYW1lID0gJ3Nob3cnO1xyXG5cclxuICAgICAgICBpZihpc01vYmlsZSB8fCBpc19pUGFkKSB7XHJcbiAgICAgICAgICAgIENhc2VTdHVkeUNvbnRhaW5lci5hZGRDbGFzcyh2aXNpYmxlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgbWV0aG9kQ29udGVudC5hZGRDbGFzcyh2aXNpYmxlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgYWJvdXRDb250YWluZXIuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKG1ldGhvZEl0ZW0pLm9uKCdtb3VzZWVudGVyJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpLmF0dHIoJ2RhdGEtaXRlbScpO1xyXG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJCgnLmRpYWdyYW0tbG9nbycpLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgaWYocGxhY2Vob2xkZXIubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlci5hZGRDbGFzcygnaGlkZGVuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJCgnLm1ldGhvZC1kZXNjLicrIGl0ZW0pLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJCgnI2RpYWdyYW0nKS5hZGRDbGFzcyhpdGVtKTtcclxuICAgICAgICB9KS5vbignbW91c2VsZWF2ZScsZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpLmF0dHIoJ2RhdGEtaXRlbScpO1xyXG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJCgnLmRpYWdyYW0tbG9nbycpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgaWYocGxhY2Vob2xkZXIubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlci5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJCgnLm1ldGhvZC1kZXNjLicrIGl0ZW0pLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJCgnI2RpYWdyYW0nKS5yZW1vdmVDbGFzcyhpdGVtKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCgnLmNsb3NlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICQoJ2JvZHknKS50b2dnbGVDbGFzcygnaXNQbGF5aW5nJyk7XHJcbiAgICAgICAgICAgIGhlYWRlckVsZW0ucmVtb3ZlQ2xhc3MoJ3BsYXknKTtcclxuICAgICAgICAgICAgaGVhZGVyRWxlbS5maW5kKCcudmlkZW8tY29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ3BsYXknKTtcclxuICAgICAgICAgICAgJCgnLnlvdXR1YmUtdmlkZW8tZW1iZWQgaWZyYW1lJykuYXR0cignaWQnLCAnJykuYXR0cignc3JjJywgJycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKCcucGxheS12aWRlby13cmFwcGVyJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgJCgnYm9keScpLnRvZ2dsZUNsYXNzKCdpc1BsYXlpbmcnKTtcclxuICAgICAgICAgICAgaGVhZGVyRWxlbS5hZGRDbGFzcygncGxheScpO1xyXG4gICAgICAgICAgICBoZWFkZXJFbGVtLmZpbmQoJy52aWRlby1jb250YWluZXInKS5hZGRDbGFzcygncGxheScpO1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gJy4vYXNzZXRzL2pzb24vY29udGVudC5qc29uJztcclxuICAgICAgICAgICAgJC5nZXRKU09OKHVybCwgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxvYyA9IGdldENvb2tpZSgnbGFuZycpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxvY0RhdGEgPSBkYXRhW2xvY107XHJcbiAgICAgICAgICAgICAgICB2YXIgaG9tZXBhZ2UgPSBsb2NEYXRhLnBhZ2VzLmhvbWVwYWdlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9IGhvbWVwYWdlLmhlYWRlci5jb250ZW50O1xyXG5cclxuICAgICAgICAgICAgICAgICQoJy55b3V0dWJlLXZpZGVvLWVtYmVkIGlmcmFtZScpLmF0dHIoJ2lkJywgaGVhZGVyLnlvdXR1YmVVUkwpLmF0dHIoJ3NyYycsICdodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8nICsgaGVhZGVyLnlvdXR1YmVVUkwgKyAnP2F1dG9wbGF5PTAmcmVsPTAmZnM9MSZlbmFibGVqc2FwaT0xJylcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQod2luZG93KS5vbignc2Nyb2xsJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgc2Nyb2xsID0gfn4kKHRoaXMpLnNjcm9sbFRvcCgpO1xyXG5cclxuICAgICAgICAgICAgaWYodmlld1BvcnRIZWlnaHQgPCAxMTAwKXtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbkluY3JlbWVudHMgPSAxMDUwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBtZXRob2RJdGVtLnJlbW92ZUNsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcblxyXG4gICAgICAgICAgICBnZXREaXJlY3Rpb24oc2Nyb2xsLCBsYXN0U2Nyb2xsVG9wLCBmdW5jdGlvbihkaXJlY3Rpb24sIHNjcm9sbCl7XHJcbiAgICAgICAgICAgICAgICBsYXN0U2Nyb2xsVG9wID0gc2Nyb2xsO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHNjcm9sbCAmJiBoYXNTY3JvbGxlZCAmJiAhaXNNb2JpbGUgJiYgdmlld1BvcnRXaWR0aCA+IDEyMDAgJiYgIWlzX2lQYWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihkaXJlY3Rpb24gPT09ICdkb3duJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL29uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGwgPj0gbWV0aG9kQ29udGFpbmVyT2Zmc2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc1NuYXBwZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RDb250ZW50LnJlbW92ZUNsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbWV0aG9kSXRlbS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtZXRob2RTY3JvbGxDb250YWluZXIuYWRkQ2xhc3MoJ2ZpeGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kU2Nyb2xsQ29udGFpbmVyLmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZU1ldGhvZFNjcm9sbCg1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaGFzU25hcHBlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGwgPj0gbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgbWV0aG9kQ29udGFpbmVySGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYXNlU3R1ZHlDb250YWluZXIuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RDb250ZW50LnJlbW92ZUNsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tZXRob2RJdGVtLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbWV0aG9kU2Nyb2xsQ29udGFpbmVyLnJlbW92ZUNsYXNzKCdmaXhlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kU2Nyb2xsQ29udGFpbmVyLnJlbW92ZUNsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9oYXNTbmFwcGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGwgPj0gcHJlQWJvdXRDb250YWluZXJPZmZzZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3V0Q29udGFpbmVyLmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ2FzZVN0dWR5Q29udGFpbmVyLmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RDb250ZW50LmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhYm91dENvbnRhaW5lci5hZGRDbGFzcyh2aXNpYmxlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGRpcmVjdGlvbiA9PT0gJ3VwJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL29uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGwgPCBDYXNlU3R1ZHlDb250YWluZXJPZmZzZXQgLSBhbmltYXRpb25JbmNyZW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc1NuYXBwZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21ldGhvZEl0ZW0ucmVtb3ZlQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21ldGhvZFNjcm9sbENvbnRhaW5lci5hZGRDbGFzcygnZml4ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RTY3JvbGxDb250YWluZXIuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlTWV0aG9kU2Nyb2xsKDUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9oYXNTbmFwcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjcm9sbCA8PSBtZXRob2RDb250YWluZXJPZmZzZXQgLSAxMDAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RDb250ZW50LnJlbW92ZUNsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21ldGhvZEl0ZW0ucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tZXRob2RTY3JvbGxDb250YWluZXIucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2hhc1NuYXBwZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaGFzU25hcHBlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Nyb2xsID4gbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICYmIHNjcm9sbCA8IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjcm9sbCA+IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMgJiYgc2Nyb2xsIDwgbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgYW5pbWF0aW9uSW5jcmVtZW50cyAqIDIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjcm9sbCA+IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMgKiAyICYmIHNjcm9sbCA8IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMgKiAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY3JvbGwgPiBtZXRob2RDb250YWluZXJPZmZzZXQgKyBhbmltYXRpb25JbmNyZW1lbnRzICogMyAmJiBzY3JvbGwgPCBtZXRob2RDb250YWluZXJPZmZzZXQgKyBhbmltYXRpb25JbmNyZW1lbnRzICogNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcCA9IDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2Nyb2xsID4gbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgYW5pbWF0aW9uSW5jcmVtZW50cyAqIDQgJiYgc2Nyb2xsIDwgQ2FzZVN0dWR5Q29udGFpbmVyT2Zmc2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwID0gNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlTWV0aG9kU2Nyb2xsKHN0ZXApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGdldERpcmVjdGlvbiAoc2Nyb2xsLCBsYXN0U2Nyb2xsVG9wLCBjYWxsYmFjayl7XHJcbiAgICB2YXIgZGlyZWN0aW9uID0gbnVsbFxyXG4gICAgICAgICwgZGVsdGEgPSA1O1xyXG5cclxuICAgIGlmKE1hdGguYWJzKGxhc3RTY3JvbGxUb3AgLSBzY3JvbGwpIDw9IGRlbHRhKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzY3JvbGwgPiBsYXN0U2Nyb2xsVG9wKXtcclxuICAgICAgICBkaXJlY3Rpb24gPSAnZG93bic7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRpcmVjdGlvbiA9ICd1cCc7XHJcbiAgICB9XHJcbiAgICBjYWxsYmFjayhkaXJlY3Rpb24sIHNjcm9sbCk7XHJcbn1cclxuXHJcbi8vIFRoaXMgZnVuY3Rpb24gc2hvd2VkIHRoZSBhcHByb3ByaWF0ZSBidWJibGVcclxuLy8gY3VycmVudGx5IG5vdCB1c2VkIGFzIHRoZSBzY3JvbGxpbmcgZnVuY3Rpb24gaXMgZGlzYWJsZWRcclxuZnVuY3Rpb24gaGFuZGxlTWV0aG9kU2Nyb2xsKHN0ZXApe1xyXG4gICAgdmFyIHRvZ2dsZUNsYXNzTmFtZSA9ICdtZXRob2QnXHJcbiAgICAgICAgLCBmYWRlSW5FbGVtQ2xhc3MgPSAnLmZhZGVJbidcclxuICAgICAgICAsIG1ldGhvZEVsZW0gPSAnLm1ldGhvZC1pdGVtJ1xyXG4gICAgICAgICwgaW50cm9FbGVtQ2xhc3MgPSAnLmludHJvJ1xyXG4gICAgICAgICwgZGVzaWduRWxlbUNsYXNzID0gJy5kZXNpZ24nXHJcbiAgICAgICAgLCB0dW5pbmdFbGVtQ2xhc3MgPSAnLnR1bmluZydcclxuICAgICAgICAsIGNvbnN0cnVjdGlvbkVsZW1DbGFzcyA9ICcuY29uc3RydWN0aW9uJ1xyXG4gICAgICAgICwgZXZhbEVsZW1DbGFzcyA9ICcuZXZhbCc7XHJcblxyXG4gICAgJChmYWRlSW5FbGVtQ2xhc3MpLnJlbW92ZUNsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAkKG1ldGhvZEVsZW0pLnJlbW92ZUNsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcblxyXG4gICAgaWYoc3RlcCA9PT0gMSl7XHJcbiAgICAgICAgJChmYWRlSW5FbGVtQ2xhc3MraW50cm9FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChtZXRob2RFbGVtK2ludHJvRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgfSBlbHNlIGlmKHN0ZXAgPT09IDIpIHtcclxuICAgICAgICAkKG1ldGhvZEVsZW0raW50cm9FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChmYWRlSW5FbGVtQ2xhc3MrZGVzaWduRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbStkZXNpZ25FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICB9IGVsc2UgaWYoc3RlcCA9PT0gMykge1xyXG4gICAgICAgICQobWV0aG9kRWxlbStpbnRyb0VsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rZGVzaWduRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQoZmFkZUluRWxlbUNsYXNzK3R1bmluZ0VsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rdHVuaW5nRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgfSBlbHNlIGlmKHN0ZXAgPT09IDQpIHtcclxuICAgICAgICAkKG1ldGhvZEVsZW0raW50cm9FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChtZXRob2RFbGVtK2Rlc2lnbkVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rdHVuaW5nRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQoZmFkZUluRWxlbUNsYXNzK2NvbnN0cnVjdGlvbkVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rY29uc3RydWN0aW9uRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgfSBlbHNlIGlmKHN0ZXAgPT09IDUpIHtcclxuICAgICAgICAkKG1ldGhvZEVsZW0raW50cm9FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChtZXRob2RFbGVtK2Rlc2lnbkVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rdHVuaW5nRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbStjb25zdHJ1Y3Rpb25FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChmYWRlSW5FbGVtQ2xhc3MrZXZhbEVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rZXZhbEVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgIH1cclxufSIsImNob29zZUNvb2tpZSgpO1xyXG5cclxuZnVuY3Rpb24gc2V0Q29va2llKG5hbWUsdmFsdWUsZGF5cykge1xyXG4gICAgdmFyIGV4cGlyZXMgPSBcIlwiO1xyXG4gICAgaWYgKGRheXMpIHtcclxuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgKGRheXMqMjQqNjAqNjAqMTAwMCkpO1xyXG4gICAgICAgIGV4cGlyZXMgPSBcIjsgZXhwaXJlcz1cIiArIGRhdGUudG9VVENTdHJpbmcoKTtcclxuICAgIH1cclxuICAgIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyBcIj1cIiArICh2YWx1ZSB8fCBcIlwiKSAgKyBleHBpcmVzICsgXCI7IHBhdGg9L1wiO1xyXG59XHJcbmZ1bmN0aW9uIGdldENvb2tpZShuYW1lKSB7XHJcbiAgICB2YXIgbmFtZUVRID0gbmFtZSArIFwiPVwiO1xyXG4gICAgdmFyIGNhID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7XHJcbiAgICBmb3IodmFyIGk9MDtpIDwgY2EubGVuZ3RoO2krKykge1xyXG4gICAgICAgIHZhciBjID0gY2FbaV07XHJcbiAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApPT0nICcpIGMgPSBjLnN1YnN0cmluZygxLGMubGVuZ3RoKTtcclxuICAgICAgICBpZiAoYy5pbmRleE9mKG5hbWVFUSkgPT0gMCkgcmV0dXJuIGMuc3Vic3RyaW5nKG5hbWVFUS5sZW5ndGgsYy5sZW5ndGgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn1cclxuZnVuY3Rpb24gZXJhc2VDb29raWUobmFtZSkge1xyXG4gICAgZG9jdW1lbnQuY29va2llID0gbmFtZSsnPTsgTWF4LUFnZT0tOTk5OTk5OTk7JztcclxufVxyXG5cclxuZnVuY3Rpb24gY2hvb3NlQ29va2llKCl7XHJcbiAgICB2YXIgdXNlckxhbmcgPSBuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgbmF2aWdhdG9yLnVzZXJMYW5ndWFnZTtcclxuICAgIHZhciBhY3RpdmVDb29raWUgPSBnZXRDb29raWUoJ2xhbmcnKTtcclxuICAgIGlmKGFjdGl2ZUNvb2tpZSA9PT0gdW5kZWZpbmVkIHx8IGFjdGl2ZUNvb2tpZSA9PT0gbnVsbCB8fCBhY3RpdmVDb29raWUgPT09ICcnKXtcclxuICAgICAgICBpZih1c2VyTGFuZy5tYXRjaCgvZGUvZykpe1xyXG4gICAgICAgICAgICBzZXRDb29raWUoJ2xhbmcnLCdlbicsNyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh1c2VyTGFuZy5tYXRjaCgvZW4vZykpe1xyXG4gICAgICAgICAgICBzZXRDb29raWUoJ2xhbmcnLCdlbicsNyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh1c2VyTGFuZy5tYXRjaCgvbmwvZykpIHtcclxuICAgICAgICAgICAgc2V0Q29va2llKCdsYW5nJywnbmwnLDcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNldENvb2tpZSgnbGFuZycsJ25sJyw3KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICQoJyNuYXYgLmFjdGl2ZS1sb2MnKS5odG1sKGdldENvb2tpZSgnbGFuZycpKTtcclxuICAgIH0sMjAwKTtcclxufVxyXG5cclxuIiwiJChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbmF2SXNPcGVuID0gZmFsc2VcclxuICAgICAgICAsIG1vYmlsZU5hdiA9ICQoJyNuYXYgdWwnKVxyXG4gICAgICAgICwgaGFtYnVyZ2VyRWxlbSA9ICQoJy5oYW1idXJnZXInKVxyXG4gICAgICAgICwgdmlld1BvcnRPZmZzZXQgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XHJcblxyXG4gICAgJCgnI25hdiBsaSBhJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHZhciBuYXZMaW5rID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XHJcbiAgICAgICAgaWYobmF2TGluay5pbmRleE9mKCcuJykgIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbmF2TGluaztcclxuICAgICAgICB9IGVsc2UgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2xvYycpKXtcclxuICAgICAgICAgICAgZXJhc2VDb29raWUoJ2xhbmcnKTtcclxuICAgICAgICAgICAgc2V0Q29va2llKCdsYW5nJyxuYXZMaW5rLDcpO1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgfSBlbHNlIGlmKG5hdkxpbmsuaW5kZXhPZignIycpICE9PSAtMSkge1xyXG4gICAgICAgICAgICB2YXIgbGlua1BvcyA9ICQobmF2TGluaykub2Zmc2V0KCkudG9wO1xyXG4gICAgICAgICAgICAkKFwiaHRtbCwgYm9keVwiKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiBsaW5rUG9zIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG5hdklzT3Blbikge1xyXG4gICAgICAgICAgICBoYW1idXJnZXJFbGVtLnJlbW92ZUNsYXNzKFwiaXMtYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICBtb2JpbGVOYXYucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xyXG4gICAgICAgICAgICBuYXZJc09wZW4gPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBoYW1idXJnZXJFbGVtLmNsaWNrKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcyhcImlzLWFjdGl2ZVwiKTtcclxuICAgICAgICBtb2JpbGVOYXYudG9nZ2xlQ2xhc3MoXCJvcGVuXCIpO1xyXG4gICAgICAgIG5hdklzT3BlbiA9IHRydWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIHNjcm9sbCA9IH5+JCh0aGlzKS5zY3JvbGxUb3AoKTtcclxuICAgICAgICBmaXhOYXYoc2Nyb2xsKTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoJy5jb250YWN0LWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIGZvb3Rlck9mZnNldCA9ICQoJ2Zvb3RlcicpLm9mZnNldCgpLnRvcDtcclxuICAgICAgICAkKFwiaHRtbCwgYm9keVwiKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiBmb290ZXJPZmZzZXQgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmaXhOYXYodmlld1BvcnRPZmZzZXQpO1xyXG59KTtcclxuXHJcblxyXG5mdW5jdGlvbiBmaXhOYXYoc2Nyb2xsKXtcclxuICAgIHZhciBuYXYgPSAkKFwiI25hdlwiKTtcclxuICAgIGlmIChzY3JvbGwgPj0gNTAwKSB7XHJcbiAgICAgICAgbmF2LmFkZENsYXNzKFwiZml4ZWRcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIG5hdi5yZW1vdmVDbGFzcyhcImZpeGVkXCIpO1xyXG4gICAgfVxyXG59IiwiJChmdW5jdGlvbigpe1xyXG4gICAgLy8gTG9hZCBwcm9qZWN0c1xyXG4gICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygnaG9tZXBhZ2UnKSl7XHJcbiAgICAgICAgdmFyIHVybCA9ICcuL2Fzc2V0cy9qc29uL2NvbnRlbnQuYmluJztcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgc2NyaXB0Q2hhcnNldDogXCJ1dGYtOFwiLFxyXG4gICAgICAgICAgICB0eXBlOiBcIkdFVFwiLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjdHVhbCA9IEpTT04ucGFyc2UoZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZSh3aW5kb3cuYXRvYihkYXRhKSkpKTtcclxuICAgICAgICAgICAgICAgIHZhciBsb2MgPSBnZXRDb29raWUoJ2xhbmcnKTtcclxuICAgICAgICAgICAgICAgIHZhciBsb2NEYXRhID0gYWN0dWFsW2xvY107XHJcbiAgICAgICAgICAgICAgICB2YXIgaG9tZXBhZ2UgPSBsb2NEYXRhLnBhZ2VzLmhvbWVwYWdlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbXBhcmlzb24gPSBob21lcGFnZS5jb250ZW50LmNvbXBhcmlzb247XHJcbiAgICAgICAgICAgICAgICB2YXIgY29tcGFyaXNvbldyYXBwZXIgPSAkKFwiI2NvbXBhcmlzb25cIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29tcGFyaXNvbkl0ZW0gPSBjb21wYXJpc29uLmNvbXBhcmlzb25zIHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgJC5lYWNoKGNvbXBhcmlzb25JdGVtLCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb21wYXJpc29uV3JhcHBlci5hcHBlbmQoJzxkaXYgY2xhc3M9XCJpdGVtXCI+PGltZyBkYXRhLWNvbnRlbnQ9XCJjb250ZW50LWNvbXBhcmlzb24tYmVmb3JlXCIgc3JjPVwiJyArIGl0ZW0uYmVmb3JlICsgJ1wiIGNsYXNzPVwiYmVmb3JlXCIgYWx0PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBkYXRhLWNvbnRlbnQ9XCJjb250ZW50LWNvbXBhcmlzb24tYWZ0ZXJcIiBjbGFzcz1cImFmdGVyXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJyArIGl0ZW0uYWZ0ZXIgKyAnKVwiPjwvZGl2PjwvZGl2PicpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2xpZGVySW5pdChjb21wYXJpc29uV3JhcHBlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSk7XHJcblxyXG5mdW5jdGlvbiBzbGlkZXJJbml0KHByb2plY3RFbGVtKXtcclxuICAgIHByb2plY3RFbGVtLm5vdCgnLnNsaWNrLWluaXRpYWxpemVkJykuc2xpY2soe1xyXG4gICAgICAgIHNsaWRlc1RvU2hvdzogMSxcclxuICAgICAgICBzbGlkZXNUb1Njcm9sbDogMSxcclxuICAgICAgICBhdXRvcGxheTogdHJ1ZSxcclxuICAgICAgICBhdXRvcGxheVNwZWVkOiAzMDAwLFxyXG4gICAgICAgIG5leHRBcnJvdzogJy5pY29uLWFycm93LXJpZ2h0JyxcclxuICAgICAgICBwcmV2QXJyb3c6ICcuaWNvbi1hcnJvdy1sZWZ0JyxcclxuICAgICAgICBzd2lwZVRvU2xpZGU6IGZhbHNlXHJcbiAgICB9KTtcclxuICAgIHByb2plY3RFbGVtLm9uKCdzZXRQb3NpdGlvbicsIGZ1bmN0aW9uKGV2ZW50LCBzbGljaywgY3VycmVudFNsaWRlLCBuZXh0U2xpZGUpe1xyXG4gICAgICAgIHZhciBpbmtib3ggPSBwcm9qZWN0RWxlbS5maW5kKCcuc2xpY2stYWN0aXZlJyk7XHJcbiAgICAgICAgaWYgKGlua2JveCkge1xyXG4gICAgICAgICAgICBpbmtib3gub24oXCJtb3VzZW1vdmVcIix0cmFja0xvY2F0aW9uKTtcclxuICAgICAgICAgICAgaW5rYm94Lm9uKFwidG91Y2hzdGFydFwiLHRyYWNrTG9jYXRpb24pO1xyXG4gICAgICAgICAgICBpbmtib3gub24oXCJ0b3VjaG1vdmVcIix0cmFja0xvY2F0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdHJhY2tMb2NhdGlvbihlKXtcclxuICAgIHZhciBjb2xvcmJveCA9ICQoJy5zbGljay1hY3RpdmUgLmFmdGVyJylcclxuICAgICAgICAsIGZpbGxlckltYWdlID0gJCgnLnNsaWNrLWFjdGl2ZSAuYmVmb3JlJylcclxuICAgICAgICAsIHJlY3QgPSBmaWxsZXJJbWFnZVswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxyXG4gICAgICAgICwgZmlsbGVySW1hZ2VPdyA9IGZpbGxlckltYWdlLm91dGVyV2lkdGgoKVxyXG4gICAgICAgICwgcG9zaXRpb24gPSAoKGUucGFnZVggLSByZWN0LmxlZnQpIC8gZmlsbGVySW1hZ2VPdykqMTAwO1xyXG5cclxuICAgIGlmKHBvc2l0aW9uIDw9IDEwMCl7XHJcbiAgICAgICAgY29sb3Jib3guY3NzKCd3aWR0aCcsIHBvc2l0aW9uK1wiJVwiKTtcclxuICAgIH1cclxufVxyXG5cclxuIiwiJChmdW5jdGlvbigpe1xyXG4gICAgdmFyIHVybCA9ICcuL2Fzc2V0cy9qc29uL2NvbnRlbnQuYmluJztcclxuICAgIHZhciAkYm9keSA9ICQoXCJib2R5XCIpO1xyXG5cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgc2NyaXB0Q2hhcnNldDogXCJ1dGYtOFwiLFxyXG4gICAgICAgIHR5cGU6IFwiR0VUXCIsXHJcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIGFjdHVhbCA9IEpTT04ucGFyc2UoZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZSh3aW5kb3cuYXRvYihkYXRhKSkpKTtcclxuICAgICAgICAgICAgdmFyIGxvYyA9IGdldENvb2tpZSgnbGFuZycpO1xyXG4gICAgICAgICAgICB2YXIgbG9jRGF0YSA9IGFjdHVhbFtsb2NdO1xyXG4gICAgICAgICAgICB2YXIgbmF2ID0gbG9jRGF0YS5uYXYubGFiZWxzO1xyXG4gICAgICAgICAgICB2YXIgaG9tZXBhZ2UgPSBsb2NEYXRhLnBhZ2VzLmhvbWVwYWdlO1xyXG4gICAgICAgICAgICB2YXIgaGVhZGVyID0gaG9tZXBhZ2UuaGVhZGVyLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgIHZhciBpbnRybyA9IGhvbWVwYWdlLmNvbnRlbnQuaW50cm87XHJcbiAgICAgICAgICAgIHZhciBicmFuZHMgPSBpbnRyby5pbWFnZXM7XHJcbiAgICAgICAgICAgIHZhciBhYm91dCA9IGhvbWVwYWdlLmNvbnRlbnQuYWJvdXQ7XHJcbiAgICAgICAgICAgIHZhciBhYm91dFVzID0gaG9tZXBhZ2UuY29udGVudC5hYm91dFVzO1xyXG4gICAgICAgICAgICB2YXIgdmFsdWVzID0gaG9tZXBhZ2UuY29udGVudC52YWx1ZXM7XHJcbiAgICAgICAgICAgIHZhciBjb21wYXJpc29uID0gaG9tZXBhZ2UuY29udGVudC5jb21wYXJpc29uO1xyXG4gICAgICAgICAgICB2YXIgbWV0aG9kID0gaG9tZXBhZ2UuY29udGVudC5tZXRob2Q7XHJcbiAgICAgICAgICAgIHZhciBtb2RlbCA9IGhvbWVwYWdlLmNvbnRlbnQubW9kZWw7XHJcbiAgICAgICAgICAgIHZhciBwcm9qZWN0cyA9IGhvbWVwYWdlLmNvbnRlbnQucHJvamVjdHM7XHJcbiAgICAgICAgICAgIHZhciBmb290ZXIgPSBob21lcGFnZS5mb290ZXI7XHJcblxyXG4gICAgICAgICAgICBpZiAobG9jRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJGJvZHkucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYobmF2KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmF2SXRlbSA9ICQoJyNuYXYgPiB1bCA+IGxpICcpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjcHJlYWJvdXRcIl0nKS5odG1sKG5hdi5hYm91dCk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cImluZGV4Lmh0bWwjcHJlYWJvdXRcIl0nKS5odG1sKG5hdi5hYm91dCk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiNtZXRob2RcIl0nKS5odG1sKG5hdi5tZXRob2QpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCJpbmRleC5odG1sI21ldGhvZFwiXScpLmh0bWwobmF2Lm1ldGhvZCk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiN2YWx1ZXNcIl0nKS5odG1sKG5hdi52YWx1ZXMpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCJpbmRleC5odG1sI3ZhbHVlc1wiXScpLmh0bWwobmF2LnZhbHVlcyk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiNhYm91dFVzXCJdJykuaHRtbChuYXYuYWJvdXRVcyk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cImluZGV4Lmh0bWwjYWJvdXRVc1wiXScpLmh0bWwobmF2LmFib3V0VXMpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCJwcm9qZWN0cy5odG1sXCJdJykuaHRtbChuYXYucHJvamVjdHMpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjZm9vdGVyXCJdJykuaHRtbChuYXYuY29udGFjdCk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiNmb290ZXJcIl0nKS5odG1sKG5hdi5jb250YWN0KTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI21pc3Npb25cIl0nKS5odG1sKG5hdi5taXNzaW9uKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiaW5kZXguaHRtbCNtaXNzaW9uXCJdJykuaHRtbChuYXYubWlzc2lvbik7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiNtb2RlbFwiXScpLmh0bWwobmF2Lm1vZGVsKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiaW5kZXguaHRtbCNtb2RlbFwiXScpLmh0bWwobmF2Lm1vZGVsKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI2ZvdW5kYXRpb25cIl0nKS5odG1sKG5hdi5mb3VuZGF0aW9uKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiaW5kZXguaHRtbCNmb3VuZGF0aW9uXCJdJykuaHRtbChuYXYuZm91bmRhdGlvbik7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiNjb21wYXJpc29uXCJdJykuaHRtbChuYXYuY29tcGFyaXNvbik7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cImluZGV4Lmh0bWwjY29tcGFyaXNvblwiXScpLmh0bWwobmF2LmNvbXBhcmlzb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaGVhZGVyKSB7XHJcbiAgICAgICAgICAgICAgICAkKCcuYmFja2dyb3VuZC12aWRlbycpLmNzcyh7J2JhY2tncm91bmRJbWFnZSc6IGhlYWRlci5iYWNrZ3JvdW5kSW1hZ2VTcmN9KTtcclxuICAgICAgICAgICAgICAgICQoJy55b3V0dWJlLXZpZGVvLWVtYmVkIGlmcmFtZScpLmF0dHIoJ2lkJywgaGVhZGVyLnlvdXR1YmVVUkwpLmF0dHIoJ3NyYycsICdodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8nICsgaGVhZGVyLnlvdXR1YmVVUkwgKyAnP2F1dG9wbGF5PTAmcmVsPTAmZnM9MSZlbmFibGVqc2FwaT0xJylcclxuICAgICAgICAgICAgICAgICQoJ3ZpZGVvIHNvdXJjZSNtcDQnKS5hdHRyKCdzcmMnLCBoZWFkZXIuYmFja2dyb3VuZFZpZGVvTXA0U3JjKTtcclxuICAgICAgICAgICAgICAgICQoJ3ZpZGVvIHNvdXJjZSN3ZWJtJykuYXR0cignc3JjJywgaGVhZGVyLmJhY2tncm91bmRWaWRlb1dlYk1TcmMpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2hlYWRlci1jb250ZW50LXRpdGxlJ11cIikuaHRtbChoZWFkZXIuaGVhZGVyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGludHJvKSB7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1pbnRyby10aXRsZSddXCIpLmh0bWwoaW50cm8uaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWludHJvLWRlc2MnXVwiKS5odG1sKGludHJvLmRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZigkKCcuYnJhbmRsaXN0JykubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGJyYW5kcywgZnVuY3Rpb24gKGluZGV4LCBicmFuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihicmFuZC5zcmMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJvZHkuZmluZCgnLmJyYW5kbGlzdCcpLmFwcGVuZCgnPGxpPjxpbWcgc3JjPVwiJyticmFuZC5zcmMrJ1wiIGFsdD1cIicrYnJhbmQuYWx0KydcIiAvPjwvbGk+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGFib3V0KSB7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1hYm91dC1yb3cxLXRpdGxlJ11cIikuaHRtbChhYm91dC5yb3cxLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1hYm91dC1yb3cxLWltYWdlJ11cIikuY3NzKHsnYmFja2dyb3VuZEltYWdlJzogYWJvdXQucm93MS5pbWFnZS5zcmN9KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWFib3V0LXJvdzEtZGVzYyddXCIpLmh0bWwoYWJvdXQucm93MS5kZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtYWJvdXQtcm93Mi10aXRsZSddXCIpLmh0bWwoYWJvdXQucm93Mi5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtYWJvdXQtcm93Mi1pbWFnZSddXCIpLmNzcyh7J2JhY2tncm91bmRJbWFnZSc6IGFib3V0LnJvdzIuaW1hZ2Uuc3JjfSk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1hYm91dC1yb3cyLWRlc2MnXVwiKS5odG1sKGFib3V0LnJvdzIuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoYWJvdXRVcykge1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtYWJvdXRVcy10aXRsZSddXCIpLmh0bWwoYWJvdXRVcy5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtYWJvdXRVcy1kZXNjcmlwdGlvbiddXCIpLmh0bWwoYWJvdXRVcy5kZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtZW1wbG95ZWUtbmllay1pbWFnZSddXCIpLmF0dHIoJ3NyYycsIGFib3V0VXMuZW1wbG95ZWVzLm5pZWsuaW1hZ2Uuc3JjKS5hdHRyKCdhbHQnLCBhYm91dFVzLmVtcGxveWVlcy5uaWVrLmltYWdlLmFsdCk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1lbXBsb3llZS1uaWVrLXRpdGxlJ11cIikuaHRtbChhYm91dFVzLmVtcGxveWVlcy5uaWVrLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1lbXBsb3llZS1uaWVrLWRlc2MnXVwiKS5odG1sKGFib3V0VXMuZW1wbG95ZWVzLm5pZWsuZGVzY3JpcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWVtcGxveWVlLWphbi1pbWFnZSddXCIpLmF0dHIoJ3NyYycsIGFib3V0VXMuZW1wbG95ZWVzLmphbi5pbWFnZS5zcmMpLmF0dHIoJ2FsdCcsIGFib3V0VXMuZW1wbG95ZWVzLmphbi5pbWFnZS5hbHQpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtZW1wbG95ZWUtamFuLXRpdGxlJ11cIikuaHRtbChhYm91dFVzLmVtcGxveWVlcy5qYW4uaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWVtcGxveWVlLWphbi1kZXNjJ11cIikuaHRtbChhYm91dFVzLmVtcGxveWVlcy5qYW4uZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC12YWx1ZXMtaW1hZ2UnXVwiKS5jc3MoeydiYWNrZ3JvdW5kSW1hZ2UnOiB2YWx1ZXMuaW1hZ2Uuc3JjfSk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC12YWx1ZXMtdGl0bGUnXVwiKS5odG1sKHZhbHVlcy5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtdmFsdWVzLWRlc2MnXVwiKS5odG1sKHZhbHVlcy5kZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtdmFsdWUxJ11cIikuaHRtbCh2YWx1ZXMudmFsdWVzLnZhbHVlMSk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC12YWx1ZTInXVwiKS5odG1sKHZhbHVlcy52YWx1ZXMudmFsdWUyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXZhbHVlMyddXCIpLmh0bWwodmFsdWVzLnZhbHVlcy52YWx1ZTMpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtdmFsdWU0J11cIikuaHRtbCh2YWx1ZXMudmFsdWVzLnZhbHVlNCk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC12YWx1ZTUnXVwiKS5odG1sKHZhbHVlcy52YWx1ZXMudmFsdWU1KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXZhbHVlNiddXCIpLmh0bWwodmFsdWVzLnZhbHVlcy52YWx1ZTYpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobWV0aG9kKSB7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtdGl0bGUnXVwiKS5odG1sKG1ldGhvZC5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWRlc2MnXVwiKS5odG1sKG1ldGhvZC5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtaG92ZXJMYWJlbCddXCIpLmh0bWwobWV0aG9kLmhvdmVyTGFiZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1pbnRyby10aXRsZSddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMuaW50cm8uaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1pbnRyby1kZXNjJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy5pbnRyby5kZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWRlc2lnbi10aXRsZSddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMuZGVzaWduLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtZGVzaWduLWRlc2MnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLmRlc2lnbi5kZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLXR1bmluZy10aXRsZSddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMudHVuaW5nLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtdHVuaW5nLWRlc2MnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLnR1bmluZy5kZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWNvbnN0cnVjdGlvbi10aXRsZSddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMuY29uc3RydWN0aW9uLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtY29uc3RydWN0aW9uLWRlc2MnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLmNvbnN0cnVjdGlvbi5kZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWV2YWwtdGl0bGUnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLmV2YWwuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1ldmFsLWRlc2MnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLmV2YWwuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobW9kZWwpIHtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1vZGVsLXRpdGxlJ11cIikuaHRtbChtb2RlbC5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbW9kZWwtaW1hZ2UnXVwiKS5jc3MoeydiYWNrZ3JvdW5kSW1hZ2UnOiBtb2RlbC5pbWFnZS5zcmN9KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1vZGVsLWRlc2MnXVwiKS5odG1sKG1vZGVsLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHByb2plY3RzKSB7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0cy10aXRsZSddXCIpLmh0bWwocHJvamVjdHMuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3RzLWRlc2MnXVwiKS5odG1sKHByb2plY3RzLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3RzLWJ1dHRvbiddXCIpLmh0bWwocHJvamVjdHMuYnV0dG9uLmxhYmVsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0MS1pbWFnZSddXCIpLmF0dHIoJ3NyYycsIHByb2plY3RzLnByb2plY3QxLmltYWdlLnNyYykuYXR0cignYWx0JywgcHJvamVjdHMucHJvamVjdDEuaW1hZ2UuYWx0KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3QxLXRpdGxlJ11cIikuaHRtbChwcm9qZWN0cy5wcm9qZWN0MS5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdDEtYnRuJ11cIikuaHRtbChwcm9qZWN0cy5wcm9qZWN0MS5idXR0b24pO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3QyLWltYWdlJ11cIikuYXR0cignc3JjJywgcHJvamVjdHMucHJvamVjdDIuaW1hZ2Uuc3JjKS5hdHRyKCdhbHQnLCBwcm9qZWN0cy5wcm9qZWN0Mi5pbWFnZS5hbHQpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdDItdGl0bGUnXVwiKS5odG1sKHByb2plY3RzLnByb2plY3QyLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0Mi1idG4nXVwiKS5odG1sKHByb2plY3RzLnByb2plY3QyLmJ1dHRvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKGNvbXBhcmlzb24pe1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdHMtY29tcGFyaXNvbi10aXRsZSddXCIpLmh0bWwoY29tcGFyaXNvbi5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdHMtY29tcGFyaXNvbi1kZXNjJ11cIikuaHRtbChjb21wYXJpc29uLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGZvb3Rlcikge1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci10ZXN0aW1vbmlhbHMtdGl0bGUnXVwiKS5odG1sKGZvb3Rlci50ZXN0aW1vbmlhbHMuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtaGVhZGVyJ11cIikuaHRtbChmb290ZXIuY29udGFjdHMuaGVhZGVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLWphbi10aXRsZSddXCIpLmh0bWwoZm9vdGVyLmNvbnRhY3RzLmphbi5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1qYW4tZW1haWwnXVwiKS5hdHRyKCdocmVmJywgZm9vdGVyLmNvbnRhY3RzLmphbi5saW5rcy5lbWFpbC5zcmMpLmh0bWwoZm9vdGVyLmNvbnRhY3RzLmphbi5saW5rcy5lbWFpbC5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1saW5rZWRpbi1qYW4nXVwiKS5hdHRyKCdocmVmJywgZm9vdGVyLmNvbnRhY3RzLmphbi5saW5rcy5saW5rZWRpbi5zcmMpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1saW5rZWRpbi1qYW4tdGl0bGUnXVwiKS5odG1sKCBmb290ZXIuY29udGFjdHMuamFuLmxpbmtzLmxpbmtlZGluLmhlYWRlcisnICcpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1jYWxsLWphbi1waG9uZSddXCIpLmF0dHIoJ2hyZWYnLCBmb290ZXIuY29udGFjdHMuamFuLnBob25lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLW5pZWstdGl0bGUnXVwiKS5odG1sKGZvb3Rlci5jb250YWN0cy5uaWVrLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLW5pZWstZW1haWwnXVwiKS5hdHRyKCdocmVmJywgZm9vdGVyLmNvbnRhY3RzLm5pZWsubGlua3MuZW1haWwuc3JjKS5odG1sKGZvb3Rlci5jb250YWN0cy5uaWVrLmxpbmtzLmVtYWlsLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLWxpbmtlZGluLW5pZWsnXVwiKS5hdHRyKCdocmVmJywgZm9vdGVyLmNvbnRhY3RzLm5pZWsubGlua3MubGlua2VkaW4uc3JjKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtbGlua2VkaW4tbmllay10aXRsZSddXCIpLmh0bWwoZm9vdGVyLmNvbnRhY3RzLm5pZWsubGlua3MubGlua2VkaW4uaGVhZGVyKycgJyk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLWNhbGwtbmllay1waG9uZSddXCIpLmF0dHIoJ2hyZWYnLCBmb290ZXIuY29udGFjdHMubmllay5waG9uZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1waG9uZS1oZWFkZXInXVwiKS5odG1sKGZvb3Rlci5waG9uZS5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy12aXNpdC1oZWFkZXInXVwiKS5odG1sKGZvb3Rlci52aXNpdC5oZWFkZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtdmlzaXQtZGVzYyddXCIpLmh0bWwoZm9vdGVyLnZpc2l0LmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29weXJpZ2h0LWRlc2MnXVwiKS5odG1sKGZvb3Rlci5jb3B5cmlnaHQuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG4iLCIvLyBHb29nbGUgbWFwcyBzZXR1cFxyXG5cclxudmFyIG1hcDtcclxuZ29vZ2xlLm1hcHMuZXZlbnQuYWRkRG9tTGlzdGVuZXIod2luZG93LCAnbG9hZCcsIGdvb2dsZU1hcHNJbml0KTtcclxuXHJcbmZ1bmN0aW9uIGdvb2dsZU1hcHNJbml0KCkge1xyXG4gICAgdmFyIG15TGF0bG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyg1MS4zNzIwMjcsIDYuMTYwNDc4KTtcclxuICAgIHZhciBtYXBPcHRpb25zID0ge1xyXG4gICAgICAgIHpvb206IDE1LFxyXG4gICAgICAgIGNlbnRlcjogbXlMYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlLFxyXG4gICAgICAgIG5hdmlnYXRpb25Db250cm9sOiBmYWxzZSxcclxuICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgc2NhbGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICBkaXNhYmxlRGVmYXVsdFVJOiB0cnVlLFxyXG4gICAgICAgIHN0eWxlczogW3tcImZlYXR1cmVUeXBlXCI6XCJsYW5kc2NhcGVcIixcInN0eWxlcnNcIjpbe1widmlzaWJpbGl0eVwiOlwic2ltcGxpZmllZFwifSx7XCJjb2xvclwiOlwiIzJiM2Y1N1wifSx7XCJ3ZWlnaHRcIjowLjF9XX0se1wiZmVhdHVyZVR5cGVcIjpcImFkbWluaXN0cmF0aXZlXCIsXCJzdHlsZXJzXCI6W3tcInZpc2liaWxpdHlcIjpcIm9uXCJ9LHtcImh1ZVwiOlwiI2ZmMDAwMFwifSx7XCJ3ZWlnaHRcIjowLjR9LHtcImNvbG9yXCI6XCIjZmZmZmZmXCJ9XX0se1wiZmVhdHVyZVR5cGVcIjpcInJvYWQuaGlnaHdheVwiLFwiZWxlbWVudFR5cGVcIjpcImxhYmVscy50ZXh0XCIsXCJzdHlsZXJzXCI6W3tcIndlaWdodFwiOjEuM30se1wiY29sb3JcIjpcIiNGRkZGRkZcIn1dfSx7XCJmZWF0dXJlVHlwZVwiOlwicm9hZC5oaWdod2F5XCIsXCJlbGVtZW50VHlwZVwiOlwiZ2VvbWV0cnlcIixcInN0eWxlcnNcIjpbe1wiY29sb3JcIjpcIiNmNTVmNzdcIn0se1wid2VpZ2h0XCI6M31dfSx7XCJmZWF0dXJlVHlwZVwiOlwicm9hZC5hcnRlcmlhbFwiLFwiZWxlbWVudFR5cGVcIjpcImdlb21ldHJ5XCIsXCJzdHlsZXJzXCI6W3tcImNvbG9yXCI6XCIjZjU1Zjc3XCJ9LHtcIndlaWdodFwiOjEuMX1dfSx7XCJmZWF0dXJlVHlwZVwiOlwicm9hZC5sb2NhbFwiLFwiZWxlbWVudFR5cGVcIjpcImdlb21ldHJ5XCIsXCJzdHlsZXJzXCI6W3tcImNvbG9yXCI6XCIjZjU1Zjc3XCJ9LHtcIndlaWdodFwiOjAuNH1dfSx7fSx7XCJmZWF0dXJlVHlwZVwiOlwicm9hZC5oaWdod2F5XCIsXCJlbGVtZW50VHlwZVwiOlwibGFiZWxzXCIsXCJzdHlsZXJzXCI6W3tcIndlaWdodFwiOjAuOH0se1wiY29sb3JcIjpcIiNmZmZmZmZcIn0se1widmlzaWJpbGl0eVwiOlwib25cIn1dfSx7XCJmZWF0dXJlVHlwZVwiOlwicm9hZC5sb2NhbFwiLFwiZWxlbWVudFR5cGVcIjpcImxhYmVsc1wiLFwic3R5bGVyc1wiOlt7XCJ2aXNpYmlsaXR5XCI6XCJvZmZcIn1dfSx7XCJmZWF0dXJlVHlwZVwiOlwicm9hZC5hcnRlcmlhbFwiLFwiZWxlbWVudFR5cGVcIjpcImxhYmVsc1wiLFwic3R5bGVyc1wiOlt7XCJjb2xvclwiOlwiI2ZmZmZmZlwifSx7XCJ3ZWlnaHRcIjowLjd9XX0se1wiZmVhdHVyZVR5cGVcIjpcInBvaVwiLFwiZWxlbWVudFR5cGVcIjpcImxhYmVsc1wiLFwic3R5bGVyc1wiOlt7XCJ2aXNpYmlsaXR5XCI6XCJvZmZcIn1dfSx7XCJmZWF0dXJlVHlwZVwiOlwicG9pXCIsXCJzdHlsZXJzXCI6W3tcImNvbG9yXCI6XCIjNmM1YjdiXCJ9XX0se1wiZmVhdHVyZVR5cGVcIjpcIndhdGVyXCIsXCJzdHlsZXJzXCI6W3tcImNvbG9yXCI6XCIjZjNiMTkxXCJ9XX0se1wiZmVhdHVyZVR5cGVcIjpcInRyYW5zaXQubGluZVwiLFwic3R5bGVyc1wiOlt7XCJ2aXNpYmlsaXR5XCI6XCJvblwifV19XVxyXG4gICAgfTtcclxuXHJcbiAgICBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY2FudmFzJyksIG1hcE9wdGlvbnMpO1xyXG5cclxuICAgIHZhciBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICBwb3NpdGlvbjogbXlMYXRsbmcsXHJcbiAgICAgICAgaWNvbjogJy8vZXhwby1tYXRlLmdpdGh1Yi5pby9hc3NldHMvaW1hZ2VzL21hcmtlci5wbmcnLFxyXG4gICAgICAgIG1hcDogbWFwXHJcbiAgICB9KTtcclxuXHJcbiAgICB2YXIgaW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHtcclxuICAgICAgICBjb250ZW50OiAkKCcuY29udGFjdC1kZXRhaWxzLW1hcCcpLmh0bWwoKVxyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIGlmKCQod2luZG93KS53aWR0aCgpID4gNDUwKXtcclxuICAgICAgICBtYXAucGFuQnkoMjAwLCAtMTUwKTtcclxuICAgIH1cclxuXHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGluZm93aW5kb3cub3BlbihtYXAsbWFya2VyKTtcclxuICAgIH0pO1xyXG59IiwiJChmdW5jdGlvbigpe1xyXG4gICAgLy8gTG9hZCBwcm9qZWN0c1xyXG4gICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygncHJvamVjdHMnKSl7XHJcbiAgICAgICAgdmFyIHVybCA9ICcuL2Fzc2V0cy9qc29uL2NvbnRlbnQuYmluJztcclxuICAgICAgICB2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xyXG5cclxuICAgICAgICAkLmFqYXhTZXR1cCh7XHJcbiAgICAgICAgICAgIHNjcmlwdENoYXJzZXQ6IFwidXRmLThcIixcclxuICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICBzY3JpcHRDaGFyc2V0OiBcInV0Zi04XCIsXHJcbiAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0dWFsID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKGRhdGEpKSkpXHJcbiAgICAgICAgICAgICAgICAsIGxvYyA9IGdldENvb2tpZSgnbGFuZycpXHJcbiAgICAgICAgICAgICAgICAsIGhvbWVwcm9qZWN0ID0gYWN0dWFsW2xvY10ucGFnZXMuaG9tZXBhZ2UuY29udGVudC5wcm9qZWN0c1xyXG4gICAgICAgICAgICAgICAgLCByZXZpZXdMaW5rID0gaG9tZXByb2plY3QucmV2aWV3TGluayB8fCAnJ1xyXG4gICAgICAgICAgICAgICAgLCBwcm9qZWN0RGV0YWlsID0gYWN0dWFsW2xvY10ucGFnZXMucHJvamVjdHNcclxuICAgICAgICAgICAgICAgICwgc2VjdGlvbiA9ICQoJyNwcm9qZWN0cyAucHJvamVjdHMtd3JhcHBlcicpO1xyXG5cclxuICAgICAgICAgICAgICAgICQuZWFjaChwcm9qZWN0RGV0YWlsLCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2VBcnJheSA9IFtdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICwgaW1hZ2VDb250ZW50ID0gaXRlbS5pbWFnZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLCBjb3VudCA9IHBhcnNlSW50KGluZGV4KSArIDFcclxuICAgICAgICAgICAgICAgICAgICAgICAgLCByZXZpZXcgPSBpdGVtLnJldmlld1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGF1dGhvciA9IHJldmlldy5hdXRob3IgfHwgJydcclxuICAgICAgICAgICAgICAgICAgICAgICAgLCBkZXNjID0gcmV2aWV3LmRlc2NyaXB0aW9uIHx8ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICwgcmV2aWV3RGF0ZSA9IHJldmlldy5kYXRlIHx8ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICwgaWRlbnRpZmllciA9IGF1dGhvci5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIi1cIikudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAsIHN0YXJDb3VudCA9IHJldmlldy5zdGFycyB8fCAnJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGltYWdlQ29udGVudCAmJiBpbWFnZUNvbnRlbnQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaW1hZ2VDb250ZW50LCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlQXJyYXkucHVzaCgnPGRpdiBjbGFzcz1cInByb2plY3QtaW1hZ2VcIiBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnK2l0ZW0uc3JjKycpXCI+PC9kaXY+JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uLmFwcGVuZCgnPGRpdiBjbGFzcz1cInByb2plY3RcIiBpZD1cInByb2plY3QnK2NvdW50KydcIj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0PGRpdiBjbGFzcz1cInByb2plY3QtY2xvc2VcIj48L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0PGRpdiBjbGFzcz1cInByb2plY3Qtd3JhcHBlclwiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdDxkaXYgY2xhc3M9XCJwcm9qZWN0LWltYWdlc1wiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0PGRpdiBjbGFzcz1cInNsaWRlclwiPicraW1hZ2VBcnJheS5qb2luKFwiXCIpKyc8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHQ8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHQ8ZGl2IGNsYXNzPVwicHJvamVjdC1kZXNjLXdyYXBwZXJcIj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdDxkaXYgY2xhc3M9XCJwcm9qZWN0LWRlc2MtY29udGVudFwiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHQ8ZGl2IGNsYXNzPVwicHJvamVjdC1oZWFkZXJcIj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdFx0XHQ8aDIgY2xhc3M9XCJwcm9qZWN0LXRpdGxlXCI+JytpdGVtLmhlYWRlcisnPC9oMj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwicHJvamVjdC1zdWItdGl0bGVcIj4nK2l0ZW0uc3ViVGl0bGUrJzwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHQ8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdFx0PGRpdiBjbGFzcz1cInByb2plY3QtZGVzY1wiPiBcXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdFx0ICAgPHNwYW4+JytpdGVtLmRlc2NyaXB0aW9uKyc8L3NwYW4+IFxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHQgICA8YSBjbGFzcz1cInJlYWQtcmV2aWV3XCIgZGF0YS1jb3VudD1cIicrY291bnQrJ1wiPicrcmV2aWV3TGluaysnICcraXRlbS5oZWFkZXIrJzwvYT4gXFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0XHQgICA8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdDwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdDwvZGl2PiBcXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0PC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdDxkaXYgY2xhc3M9XCJwcm9qZWN0LXJldmlld1wiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdDxkaXYgY2xhc3M9XCJyZXZpZXctY2xvc2VcIj48L2Rpdj4gXFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0PGRpdiBjbGFzcz1cInJldmlld1wiIGlkPVwiJytpZGVudGlmaWVyKydcIj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdDxkaXYgY2xhc3M9XCJyZXZpZXctYXV0aG9yXCI+JythdXRob3IrJzwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0PGRpdiBjbGFzcz1cInJldmlldy1kYXRlXCI+JytyZXZpZXdEYXRlKyc8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgPGRpdiBjbGFzcz1cInJldmlldy1zdGFyc1wiPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGxcIj48L2k+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbFwiPjwvaT48aSBjbGFzcz1cImljb24tc3Rhci1mdWxsXCI+PC9pPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGxcIj48L2k+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbCBmaWZ0aFwiPjwvaT48L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdDxkaXYgY2xhc3M9XCJyZXZpZXctdGV4dFwiPicrZGVzYysnPC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0PC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdDwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFyQ291bnQgPT09IDQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJldmlldy1zdGFycycpLmZpbmQoJy5maWZ0aCcpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJldmlldyA9PT0gdW5kZWZpbmVkIHx8IGRlc2MgPT09ICcnIHx8IGRlc2MgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwcm9qZWN0Jytjb3VudCkuZmluZCgnLnJlYWQtcmV2aWV3JykuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLnByb2plY3QtaW1hZ2VzJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoISQoJ2JvZHknKS5oYXNDbGFzcygnb3BlbicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgnLnByb2plY3QnKS5hZGRDbGFzcygnb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudElEID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoJy5wcm9qZWN0JykuYXR0cignaWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBcIiNcIiArIHBhcmVudElEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXJJbml0KHBhcmVudElEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKCcucHJvamVjdC10aXRsZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCEkKCdib2R5JykuaGFzQ2xhc3MoJ29wZW4nKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50RWxlbSA9ICQodGhpcykucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRFbGVtLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50SUQgPSBwYXJlbnRFbGVtLmF0dHIoJ2lkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmPVwiI1wiK3BhcmVudElEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXJJbml0KHBhcmVudElEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKCcucHJvamVjdC1jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoJy5wcm9qZWN0JykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudElEID0gJCh0aGlzKS5wYXJlbnQoJy5wcm9qZWN0JykuYXR0cignaWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycrcGFyZW50SUQrJyAuc2xpZGVyJykuc2xpY2soXCJ1bnNsaWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaD1cIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwYXJlbnRJRCkuc2Nyb2xsSW50b1ZpZXcodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoJy5yZWFkLXJldmlldycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3VudCA9ICQodGhpcykuYXR0cignZGF0YS1jb3VudCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiI3Byb2plY3RcIitjb3VudCkuYWRkQ2xhc3MoJ3Nob3ctcmV2aWV3JykuZmluZCgnLnByb2plY3QtcmV2aWV3JykuYWRkQ2xhc3MoJ3Nob3cnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLnJldmlldy1jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ3Nob3cnKS5wYXJlbnQoJy5wcm9qZWN0JykucmVtb3ZlQ2xhc3MoJ3Nob3ctcmV2aWV3Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGhhc2ggJiYgaGFzaCAhPT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2plY3RJRCA9IFwicHJvamVjdFwiK2NvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvamVjdElEID09PSBoYXNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjJytoYXNoKS5hZGRDbGFzcygnb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXJJbml0KHByb2plY3RJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG5mdW5jdGlvbiBzbGlkZXJJbml0KHByb2plY3RFbGVtKXtcclxuICAgIGlmKHR5cGVvZiBwcm9qZWN0RWxlbSA9PT0gJ3N0cmluZycpe1xyXG4gICAgICAgICQoJyMnK3Byb2plY3RFbGVtKycgLnNsaWRlcicpLm5vdCgnLnNsaWNrLWluaXRpYWxpemVkJykuc2xpY2soe1xyXG4gICAgICAgICAgICBzbGlkZXNUb1Nob3c6IDEsXHJcbiAgICAgICAgICAgIHNsaWRlc1RvU2Nyb2xsOiAxLFxyXG4gICAgICAgICAgICBhdXRvcGxheTogdHJ1ZSxcclxuICAgICAgICAgICAgYXV0b3BsYXlTcGVlZDogODAwMCxcclxuICAgICAgICAgICAgYXJyb3dzOiB0cnVlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiIsIlxyXG52YXIgdGVzdGltb25pYWwgPSAkKCcjZ29vZ2xlLXJldmlld3MnKTtcclxuXHJcbiQoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgdXJsID0gJy4vYXNzZXRzL2pzb24vY29udGVudC5iaW4nO1xyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICBzY3JpcHRDaGFyc2V0OiBcInV0Zi04XCIsXHJcbiAgICAgICAgdHlwZTogXCJHRVRcIixcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgYWN0dWFsID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKGRhdGEpKSkpO1xyXG4gICAgICAgICAgICB2YXIgbG9jID0gZ2V0Q29va2llKCdsYW5nJyk7XHJcbiAgICAgICAgICAgIHZhciBwcm9qZWN0RGV0YWlsID0gYWN0dWFsW2xvY10ucGFnZXMucHJvamVjdHM7XHJcblxyXG4gICAgICAgICAgICAkLmVhY2gocHJvamVjdERldGFpbCwgZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmV2aWV3ID0gaXRlbS5yZXZpZXdcclxuICAgICAgICAgICAgICAgICAgICAsIGF1dGhvciA9IHJldmlldy5hdXRob3IgfHwgJydcclxuICAgICAgICAgICAgICAgICAgICAsIGRlc2MgPSByZXZpZXcuZGVzY3JpcHRpb24gfHwgJydcclxuICAgICAgICAgICAgICAgICAgICAsIHJldmlld0RhdGUgPSByZXZpZXcuZGF0ZSB8fCAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICwgaWRlbnRpZmllciA9IGF1dGhvci5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIi1cIikudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICAgICAgICAgICAgICwgc3RhckNvdW50ID0gcmV2aWV3LnN0YXJzIHx8ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXZpZXcgJiYgcmV2aWV3ICE9PSB1bmRlZmluZWQgJiYgZGVzYyAhPT0gJycgJiYgZGVzYyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdGltb25pYWwuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZXN0aW1vbmlhbC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RpbW9uaWFsLmFwcGVuZCgnPGRpdiBjbGFzcz1cInJldmlld1wiIGlkPVwiJyArIGlkZW50aWZpZXIgKyAnXCI+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJldmlldy1hdXRob3JcIj4nICsgYXV0aG9yICsgJzwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZXZpZXctZGF0ZVwiPicgKyByZXZpZXdEYXRlICsgJzwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZXZpZXctc3RhcnNcIj48aSBjbGFzcz1cImljb24tc3Rhci1mdWxsXCI+PC9pPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGxcIj48L2k+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbFwiPjwvaT48aSBjbGFzcz1cImljb24tc3Rhci1mdWxsXCI+PC9pPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGwgZmlmdGhcIj48L2k+PC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJldmlldy10ZXh0XCI+JyArIHJldmlldy5kZXNjcmlwdGlvbiArICc8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgICA8L2Rpdj4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFyQ291bnQgPT09IDQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5yZXZpZXctc3RhcnMnKS5maW5kKCcuZmlmdGgnKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldmlld1NsaWRlcigpO1xyXG4gICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5cclxuZnVuY3Rpb24gcmV2aWV3U2xpZGVyKCl7XHJcbiAgICB0ZXN0aW1vbmlhbC5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XHJcbiAgICB0ZXN0aW1vbmlhbC5ub3QoJy5zbGljay1pbml0aWFsaXplZCcpLnNsaWNrKHtcclxuICAgICAgICBzbGlkZXNUb1Nob3c6IDEsXHJcbiAgICAgICAgc2xpZGVzVG9TY3JvbGw6IDEsXHJcbiAgICAgICAgYXV0b3BsYXk6IHRydWUsXHJcbiAgICAgICAgZmFkZTogdHJ1ZSxcclxuICAgICAgICBpbmZpbml0ZTogdHJ1ZSxcclxuICAgICAgICBhdXRvcGxheVNwZWVkOiA4MDAwLFxyXG4gICAgICAgIGFycm93czogdHJ1ZVxyXG4gICAgfSk7XHJcbn1cclxuIl19
