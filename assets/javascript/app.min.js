var isHomePage = $('body.homepage');
if (isHomePage){
    $.fn.isInViewport = function() {
        var that = $(this);
        if (that !== 'undefined' && that.length) {
            var elementTop = $(this).offset().top;
            var elementBottom = elementTop + $(this).outerHeight();
            var viewportTop = $(window).scrollTop();
            var viewportBottom = viewportTop + $(window).height();
            return elementBottom > viewportTop && elementTop < viewportBottom;
        }
    };
}

var aboutAnimationHasRan = false;
var aboutUsAnimationHasRan = false;
var valuesAnimationHasRan = false;
var headerAnimationHasRan = false;
var brandsAnimationHasRan = false;
var headerElem = $('#header');
var aboutElem = $('#about');
var brandsElem = $('.brandlist');
var aboutUsElem = $('#aboutUs');
var valuesElem = $('#values');


$(function(){
    if (isHomePage){
        fireAnimations();
        $(window).on('resize scroll', function() {
            fireAnimations();
        });
    }
});

function fireAnimations(){
    if(isHomePage && headerElem.length > 0){
        if(headerElem.isInViewport()){
            var logo = $('#header .logo');
            var caption = $('#header h1');
            var playBtn = $('#header .icon-play');
            if (!headerAnimationHasRan) {
                TweenMax.fromTo(logo, .5, {css: {y: "-30", opacity: 0}}, {css:{y:"0", opacity: "1"}});
                TweenMax.fromTo(caption, .5, {css: {y: "-30", opacity: 0}}, {css:{y:"0", opacity: "1"}, delay: .3});
                TweenMax.fromTo(playBtn, .5, {opacity: 0, scale:1.5, ease:Bounce.ease}, {opacity: 1, scale:1});
                headerAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && headerElem.length > 0){
        if(aboutElem.isInViewport()){
            var leftSideElem = $('#about > .left-container');
            var rightSideElem = $('#about > .right-container');
            if (!aboutAnimationHasRan) {
                TweenMax.fromTo(leftSideElem, 1, {css: {x: "-100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1});
                TweenMax.fromTo(rightSideElem, 1, {css: {x: "100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1});

                aboutAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && aboutUsElem.length > 0){
        if(aboutUsElem.isInViewport()){
            var emplo = $('.employee-wrapper');
            if (!aboutUsAnimationHasRan) {
                TweenMax.staggerFromTo(emplo, 1, {css: {x: "-100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1}, 0.5);
                aboutUsAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && brandsElem.length > 0){
        if(brandsElem.isInViewport()){
            var brand = brandsElem.find('li');
            if (!brandsAnimationHasRan) {
                TweenMax.staggerFromTo(brand, .5, {css: {x: "-40", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: .2}, 0.2);
                brandsAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && valuesElem.length > 0){
        if(valuesElem.isInViewport()){
            var valueItem = $('.valueItem');
            if (!valuesAnimationHasRan) {

                $.each(valueItem, function(){
                    var textElem = $(this).find('strong');
                    var randomNum = (Math.random() * (0.5 - 2.9) + 2.9).toFixed(2);
                    TweenMax.fromTo(textElem, 1, {css: {x: "-10", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: randomNum});
                });

                valuesAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && aboutUsElem.length > 0){
        if(aboutUsElem.isInViewport()){
            var employee = $('.employee-wrapper');
            if (!aboutUsAnimationHasRan) {
                TweenMax.staggerFromTo(employee, 1, {css: {x: "-100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1}, 0.5);
                aboutUsAnimationHasRan = true;
            }
        }
    }
}




$(function () {
    //********* Const
    var lastScrollTop = 0
        , hasScrolled = false
        , headerElem = $('#header')
        , isHomePage = $('body.homepage')
        , viewPortHeight = $(window).height()
        , viewPortWidth = $(window).width()
        , animationIncrements = 950
        , step = 0
        , scroll = 0
        , hasSnapped = false
        , methodItem = $('.method-item')
        , methodContent = $('.fadeIn')
        , isMobile = window.orientation > -1 && screen.width <= 640
        , is_iPad = navigator.userAgent.match(/iPad/i) != null
        , placeholder = $('body').find("[data-content='content-method-hoverLabel']");

    //********* Event Handlers

    $(window).on('mousewheel DOMMouseScroll touchmove', function() {
        hasScrolled = true;
    });

    $(window).on('resize', function(){
        viewPortHeight = $(this).height();
        viewPortWidth = $(this).width();
        animationIncrements = $(window).height() / 100 * 20;
    });

    if(isHomePage !== undefined && isHomePage.length > 0){
        var methodContainer = $('#method')
            , methodScrollContainer = $('.method-scroll-wrapper')
            , methodContainerHeight = methodContainer.height()
            , methodContainerOffset = methodContainer.offset().top
            , CaseStudyContainer = $('#case-studies')
            , CaseStudyContainerOffset = ~~CaseStudyContainer.offset().top
            , aboutContainer = $('#about')
            , preAboutContainer = $('#preabout')
            , preAboutContainerOffset = preAboutContainer.offset().top
            , toggleClassName = 'active'
            , visibleClassName = 'show';

        if(isMobile || is_iPad) {
            CaseStudyContainer.addClass(visibleClassName);
            methodContent.addClass(visibleClassName);
            aboutContainer.addClass(visibleClassName);
        }

        $(methodItem).on('mouseenter', function(){
            var item = $(this).attr('data-item');
            $(this).addClass('active');
            $('.diagram-logo').addClass('hidden');
            if(placeholder.length > 0){
                placeholder.addClass('hidden');
            }
            $('.method-desc.'+ item).addClass('active');
            $('#diagram').addClass(item);
        }).on('mouseleave',function(){
            var item = $(this).attr('data-item');
            $(this).removeClass('active');
            $('.diagram-logo').removeClass('hidden');
            if(placeholder.length > 0){
                placeholder.removeClass('hidden');
            }
            $('.method-desc.'+ item).removeClass('active');
            $('#diagram').removeClass(item);
        });

        $('.close-btn').on('click', function(){
            $('body').toggleClass('isPlaying');
            headerElem.removeClass('play');
            headerElem.find('.video-container').removeClass('play');
            $('.youtube-video-embed iframe').attr('id', '').attr('src', '');
        });

        $('.play-video-wrapper').on('click', function(){
            $('body').toggleClass('isPlaying');
            headerElem.addClass('play');
            headerElem.find('.video-container').addClass('play');
            var url = './assets/json/content.json';
            $.getJSON(url, function(data) {
                var loc = getCookie('lang');
                var locData = data[loc];
                var homepage = locData.pages.homepage;
                var header = homepage.header.content;

                $('.youtube-video-embed iframe').attr('id', header.youtubeURL).attr('src', 'https://www.youtube.com/embed/' + header.youtubeURL + '?autoplay=0&rel=0&fs=1&enablejsapi=1')
            });
        });

        $(window).on('scroll', function(){
            scroll = ~~$(this).scrollTop();

            if(viewPortHeight < 1100){
                animationIncrements = 1050;
            }

            methodItem.removeClass(toggleClassName);

            getDirection(scroll, lastScrollTop, function(direction, scroll){
                lastScrollTop = scroll;

                if(scroll && hasScrolled && !isMobile && viewPortWidth > 1200 && !is_iPad) {
                    if(direction === 'down') {
                        //on
                        if (scroll >= methodContainerOffset) {
                            if (!hasSnapped) {
                                methodContent.removeClass(visibleClassName);
                                //methodItem.removeClass('active');
                               // methodScrollContainer.addClass('fixed');
                                methodScrollContainer.addClass(visibleClassName);
                                handleMethodScroll(5);
                            }
                            //hasSnapped = true;
                        }

                        if (scroll >= methodContainerOffset + methodContainerHeight) {
                            CaseStudyContainer.addClass(visibleClassName);
                            methodContent.removeClass(visibleClassName);
                            //methodItem.removeClass('active');
                            //methodScrollContainer.removeClass('fixed');
                            methodScrollContainer.removeClass(visibleClassName);
                            //hasSnapped = false;
                        }

                        if (scroll >= preAboutContainerOffset) {
                            aboutContainer.addClass(visibleClassName);
                        }
                    } else {
                        CaseStudyContainer.addClass(visibleClassName);
                        methodContent.addClass(visibleClassName);
                        aboutContainer.addClass(visibleClassName);
                    }

                    if(direction === 'up') {
                        //on
                        if (scroll < CaseStudyContainerOffset - animationIncrements) {
                            if (!hasSnapped) {
                                //methodItem.removeClass(toggleClassName);
                                //methodScrollContainer.addClass('fixed');
                                methodScrollContainer.addClass(visibleClassName);
                                handleMethodScroll(5);
                            }
                            //hasSnapped = true;
                        }

                        if (scroll <= methodContainerOffset - 100 ) {
                            methodContent.removeClass(toggleClassName);
                            //methodItem.removeClass('active');
                            //methodScrollContainer.removeClass('fixed');
                            //hasSnapped = false;
                        }
                    }

                    if(hasSnapped) {
                        if (scroll > methodContainerOffset && scroll < methodContainerOffset + animationIncrements) {
                            step = 1;
                        } else if (scroll > methodContainerOffset + animationIncrements && scroll < methodContainerOffset + animationIncrements * 2) {
                            step = 2;
                        } else if (scroll > methodContainerOffset + animationIncrements * 2 && scroll < methodContainerOffset + animationIncrements * 3) {
                            step = 3;
                        } else if (scroll > methodContainerOffset + animationIncrements * 3 && scroll < methodContainerOffset + animationIncrements * 4) {
                            step = 4;
                        } else if (scroll > methodContainerOffset + animationIncrements * 4 && scroll < CaseStudyContainerOffset) {
                            step = 5;
                        }

                        handleMethodScroll(step);
                    }

                }
            });
        });
    }
});

function getDirection (scroll, lastScrollTop, callback){
    var direction = null
        , delta = 5;

    if(Math.abs(lastScrollTop - scroll) <= delta) {
        return;
    }

    if (scroll > lastScrollTop){
        direction = 'down';
    } else {
        direction = 'up';
    }
    callback(direction, scroll);
}

// This function showed the appropriate bubble
// currently not used as the scrolling function is disabled
function handleMethodScroll(step){
    var toggleClassName = 'method'
        , fadeInElemClass = '.fadeIn'
        , methodElem = '.method-item'
        , introElemClass = '.intro'
        , designElemClass = '.design'
        , tuningElemClass = '.tuning'
        , constructionElemClass = '.construction'
        , evalElemClass = '.eval';

    $(fadeInElemClass).removeClass(toggleClassName);
    $(methodElem).removeClass(toggleClassName);

    if(step === 1){
        $(fadeInElemClass+introElemClass).addClass(toggleClassName);
        $(methodElem+introElemClass).addClass(toggleClassName);
    } else if(step === 2) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(fadeInElemClass+designElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
    } else if(step === 3) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
        $(fadeInElemClass+tuningElemClass).addClass(toggleClassName);
        $(methodElem+tuningElemClass).addClass(toggleClassName);
    } else if(step === 4) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
        $(methodElem+tuningElemClass).addClass(toggleClassName);
        $(fadeInElemClass+constructionElemClass).addClass(toggleClassName);
        $(methodElem+constructionElemClass).addClass(toggleClassName);
    } else if(step === 5) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
        $(methodElem+tuningElemClass).addClass(toggleClassName);
        $(methodElem+constructionElemClass).addClass(toggleClassName);
        $(fadeInElemClass+evalElemClass).addClass(toggleClassName);
        $(methodElem+evalElemClass).addClass(toggleClassName);
    }
}
chooseCookie();

function setCookie(name,value,days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
}
function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}
function eraseCookie(name) {
    document.cookie = name+'=; Max-Age=-99999999;';
}

function chooseCookie(){
    var userLang = navigator.language || navigator.userLanguage;
    var activeCookie = getCookie('lang');
    var queryParam = getParameterByName('lang');
    if(activeCookie === undefined || activeCookie === null || activeCookie === ''){
        if(userLang.match(/de/g)){
            setCookie('lang','en',7);
        } else if (userLang.match(/en/g)){
            setCookie('lang','en',7);
        } else if (userLang.match(/nl/g)) {
            setCookie('lang','nl',7);
        } else {
            setCookie('lang','nl',7);
        }

        setTimeout(function(){
            window.location.reload();
        },20);
    } else {
        $('body').addClass(activeCookie);
    }

    if (queryParam !== undefined && queryParam === 'de'){
        setCookie('lang','de',7);
    }

    setTimeout(function(){
        $('#nav .active-loc').html(getCookie('lang'));
    },200);
    
}

function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

$(function () {
    var navIsOpen = false
        , mobileNav = $('#nav ul')
        , hamburgerElem = $('.hamburger')
        , viewPortOffset = $(window).scrollTop();

    $('#nav li a').on('click', function(e){
        e.preventDefault();
        var navLink = $(this).attr('href');
        if(navLink.indexOf('.') !== -1) {
            window.location.href = navLink;
        } else if ($(this).hasClass('loc')){
            eraseCookie('lang');
            setCookie('lang',navLink,7);
            setTimeout(function(){
                window.location.reload();
            },20);
        } else if(navLink.indexOf('#') !== -1) {
            var linkPos = $(navLink).offset().top;
            if (navLink === '#footer') {
                linkPos = $('#contact-info').offset().top;
            } else if (navLink === '#comparison') {
                linkPos = $('#comparison-wrapper').offset().top;
            }
            $("html, body").animate({ scrollTop: linkPos });
        }

        if (navIsOpen) {
            hamburgerElem.removeClass("is-active");
            mobileNav.removeClass("open");
            navIsOpen = false;
        }
    });

    hamburgerElem.click(function(){
        $(this).toggleClass("is-active");
        mobileNav.toggleClass("open");
        navIsOpen = true;
    });

    $(window).on('scroll', function(){
        var scroll = ~~$(this).scrollTop();
        fixNav(scroll);
    });

    $('.contact-btn').on('click', function(){
        var footerOffset = $('footer').offset().top;
        $("html, body").animate({ scrollTop: footerOffset });
    });

    fixNav(viewPortOffset);
});


function fixNav(scroll){
    var nav = $("#nav");
    if (scroll >= 500) {
        nav.addClass("fixed");
    } else {
        nav.removeClass("fixed");
    }
}
$(function(){
    // Load projects
    if ($('body').hasClass('homepage')){
        var url = './assets/json/content.bin';
        $.ajax({
            url: url,
            scriptCharset: "utf-8",
            type: "GET",
            success: function (data) {
                var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))));
                var loc = getCookie('lang');
                var locData = actual[loc];
                var homepage = locData.pages.homepage;
                var comparison = homepage.content.comparison;
                var comparisonWrapper = $("#comparison");
                var comparisonItem = comparison.comparisons || '';
                $.each(comparisonItem, function (index, item) {
                    comparisonWrapper.append('<div class="item"><img data-content="content-comparison-before" src="' + item.before + '" class="before" alt>\n' +
                        '<div data-content="content-comparison-after" class="after" style="background-image: url(' + item.after + ')"></div></div>');
                });

                setTimeout(function (){
                    comparisonWrapper.not('.slick-initialized').slick({
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        autoplay: true,
                        autoplaySpeed: 3000,
                        nextArrow: '.icon-arrow-right',
                        prevArrow: '.icon-arrow-left',
                        swipeToSlide: false
                    });
                    comparisonWrapper.on('setPosition', function(event, slick, currentSlide, nextSlide){
                        var inkbox = comparisonWrapper.find('.slick-active');
                        if (inkbox) {
                            inkbox.on("mousemove",trackLocation);
                            inkbox.on("touchstart",trackLocation);
                            inkbox.on("touchmove",trackLocation);
                        }
                    });
                },200);
                
            }
        });
    }
});

function trackLocation(e){
    var colorbox = $('.slick-active .after')
        , fillerImage = $('.slick-active .before')
        , rect = fillerImage[0].getBoundingClientRect()
        , fillerImageOw = fillerImage.outerWidth()
        , position = ((e.pageX - rect.left) / fillerImageOw)*100;

    if(position <= 100){
        colorbox.css('width', position+"%");
    }
}


$(function(){
    var url = './assets/json/content.bin';
    var $body = $("body");

    $.ajax({
        url: url,
        scriptCharset: "utf-8",
        type: "GET",
        success: function (data) {
            var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))));
            var loc = getCookie('lang');
            var locData = actual[loc];
            var nav = locData.nav.labels;
            var homepage = locData.pages.homepage;
            var header = homepage.header.content;
            var intro = homepage.content.intro;
            var brands = intro.images;
            var about = homepage.content.about;
            var aboutUs = homepage.content.aboutUs;
            var values = homepage.content.values;
            var comparison = homepage.content.comparison;
            var method = homepage.content.method;
            var model = homepage.content.model;
            var projects = homepage.content.projects;
            var footer = homepage.footer;

            if (locData) {
                $body.removeClass('loading');
            }

            if (loc === undefined) {
                chooseCookie();
            }

            if(nav) {
                var navItem = $('#nav > ul > li ');
                navItem.find('a[href="#preabout"]').html(nav.about);
                navItem.find('a[href="index.html#preabout"]').html(nav.about);
                navItem.find('a[href="#method"]').html(nav.method);
                navItem.find('a[href="index.html#method"]').html(nav.method);
                navItem.find('a[href="#values"]').html(nav.values);
                navItem.find('a[href="index.html#values"]').html(nav.values);
                navItem.find('a[href="#aboutUs"]').html(nav.aboutUs);
                navItem.find('a[href="index.html#aboutUs"]').html(nav.aboutUs);
                navItem.find('a[href="projects.html"]').html(nav.projects);
                navItem.find('a[href="#footer"]').html(nav.contact);
                navItem.find('a[href="#footer"]').html(nav.contact);
                navItem.find('a[href="#mission"]').html(nav.mission);
                navItem.find('a[href="index.html#mission"]').html(nav.mission);
                navItem.find('a[href="#model"]').html(nav.model);
                navItem.find('a[href="index.html#model"]').html(nav.model);
                navItem.find('a[href="#foundation"]').html(nav.foundation);
                navItem.find('a[href="index.html#foundation"]').html(nav.foundation);
                navItem.find('a[href="#comparison"]').html(nav.comparison);
                navItem.find('a[href="index.html#comparison"]').html(nav.comparison);
            }

            if (header) {
                $('.background-video').css({'backgroundImage': header.backgroundImageSrc});
                $('.youtube-video-embed iframe').attr('id', header.youtubeURL).attr('src', 'https://www.youtube.com/embed/' + header.youtubeURL + '?autoplay=0&rel=0&fs=1&enablejsapi=1')
                $('video source#mp4').attr('src', header.backgroundVideoMp4Src);
                $('video source#webm').attr('src', header.backgroundVideoWebMSrc);
                $body.find("[data-content='header-content-title']").html(header.header);
            }

            if (intro) {
                $body.find("[data-content='content-intro-title']").html(intro.header);
                $body.find("[data-content='content-intro-desc']").html(intro.description);

                if($('.brandlist').length > 0){
                    $.each(brands, function (index, brand) {
                        if(brand.src){
                            $body.find('.brandlist').append('<li><img src="'+brand.src+'" alt="'+brand.alt+'" /></li>');
                        }
                    });
                }
            }

            if (about) {
                $body.find("[data-content='content-about-row1-title']").html(about.row1.header);
                $body.find("[data-content='content-about-row1-image']").css({'backgroundImage': about.row1.image.src});
                $body.find("[data-content='content-about-row1-desc']").html(about.row1.description);

                $body.find("[data-content='content-about-row2-title']").html(about.row2.header);
                $body.find("[data-content='content-about-row2-image']").css({'backgroundImage': about.row2.image.src});
                $body.find("[data-content='content-about-row2-desc']").html(about.row2.description);
            }

            if (aboutUs) {
                $body.find("[data-content='content-aboutUs-title']").html(aboutUs.header);
                $body.find("[data-content='content-aboutUs-description']").html(aboutUs.description);

                $body.find("[data-content='content-employee-niek-image']").attr('src', aboutUs.employees.niek.image.src).attr('alt', aboutUs.employees.niek.image.alt);
                $body.find("[data-content='content-employee-niek-title']").html(aboutUs.employees.niek.header);
                $body.find("[data-content='content-employee-niek-desc']").html(aboutUs.employees.niek.description);

                $body.find("[data-content='content-employee-jan-image']").attr('src', aboutUs.employees.jan.image.src).attr('alt', aboutUs.employees.jan.image.alt);
                $body.find("[data-content='content-employee-jan-title']").html(aboutUs.employees.jan.header);
                $body.find("[data-content='content-employee-jan-desc']").html(aboutUs.employees.jan.description);
            }

            if (values) {
                $body.find("[data-content='content-values-image']").css({'backgroundImage': values.image.src});
                $body.find("[data-content='content-values-title']").html(values.header);
                $body.find("[data-content='content-values-desc']").html(values.description);

                $body.find("[data-content='content-value1']").html(values.values.value1);
                $body.find("[data-content='content-value2']").html(values.values.value2);
                $body.find("[data-content='content-value3']").html(values.values.value3);
                $body.find("[data-content='content-value4']").html(values.values.value4);
                $body.find("[data-content='content-value5']").html(values.values.value5);
                $body.find("[data-content='content-value6']").html(values.values.value6);
            }

            if (method) {
                $body.find("[data-content='content-method-title']").html(method.header);
                $body.find("[data-content='content-method-desc']").html(method.description);
                $body.find("[data-content='content-method-hoverLabel']").html(method.hoverLabel);

                $body.find("[data-content='content-method-intro-title']").html(method.methods.intro.header);
                $body.find("[data-content='content-method-intro-desc']").html(method.methods.intro.description);

                $body.find("[data-content='content-method-design-title']").html(method.methods.design.header);
                $body.find("[data-content='content-method-design-desc']").html(method.methods.design.description);

                $body.find("[data-content='content-method-tuning-title']").html(method.methods.tuning.header);
                $body.find("[data-content='content-method-tuning-desc']").html(method.methods.tuning.description);

                $body.find("[data-content='content-method-construction-title']").html(method.methods.construction.header);
                $body.find("[data-content='content-method-construction-desc']").html(method.methods.construction.description);

                $body.find("[data-content='content-method-eval-title']").html(method.methods.eval.header);
                $body.find("[data-content='content-method-eval-desc']").html(method.methods.eval.description);
            }

            if (model) {
                $body.find("[data-content='content-model-title']").html(model.header);
                $body.find("[data-content='content-model-image']").css({'backgroundImage': model.image.src});
                $body.find("[data-content='content-model-desc']").html(model.description);
            }

            if (projects) {
                $body.find("[data-content='content-projects-title']").html(projects.header);
                $body.find("[data-content='content-projects-desc']").html(projects.description);
                $body.find("[data-content='content-projects-button']").html(projects.button.label);

                $body.find("[data-content='content-project1-image']").attr('src', projects.project1.image.src).attr('alt', projects.project1.image.alt);
                $body.find("[data-content='content-project1-title']").html(projects.project1.header);
                $body.find("[data-content='content-project1-btn']").html(projects.project1.button);

                $body.find("[data-content='content-project2-image']").attr('src', projects.project2.image.src).attr('alt', projects.project2.image.alt);
                $body.find("[data-content='content-project2-title']").html(projects.project2.header);
                $body.find("[data-content='content-project2-btn']").html(projects.project2.button);
            }

            if(comparison){
                $body.find("[data-content='content-projects-comparison-title']").html(comparison.header);
                $body.find("[data-content='content-projects-comparison-desc']").html(comparison.description);
            }

            if (footer) {
                $body.find("[data-content='footer-testimonials-title']").html(footer.testimonials.header);
                $body.find("[data-content='footer-contacts-header']").html(footer.contacts.header);

                $body.find("[data-content='footer-contacts-jan-title']").html(footer.contacts.jan.header);
                $body.find("[data-content='footer-contacts-jan-email']").attr('href', footer.contacts.jan.links.email.src).html(footer.contacts.jan.links.email.header);
                $body.find("[data-content='footer-contacts-linkedin-jan']").attr('href', footer.contacts.jan.links.linkedin.src);
                $body.find("[data-content='footer-contacts-linkedin-jan-title']").html( footer.contacts.jan.links.linkedin.header+' ');
                $body.find("[data-content='footer-contacts-call-jan-phone']").attr('href', footer.contacts.jan.phone);

                $body.find("[data-content='footer-contacts-niek-title']").html(footer.contacts.niek.header);
                $body.find("[data-content='footer-contacts-niek-email']").attr('href', footer.contacts.niek.links.email.src).html(footer.contacts.niek.links.email.header);
                $body.find("[data-content='footer-contacts-linkedin-niek']").attr('href', footer.contacts.niek.links.linkedin.src);
                $body.find("[data-content='footer-contacts-linkedin-niek-title']").html(footer.contacts.niek.links.linkedin.header+' ');
                $body.find("[data-content='footer-contacts-call-niek-phone']").attr('href', footer.contacts.niek.phone);

                $body.find("[data-content='footer-contacts-phone-header']").html(footer.phone.header);
                $body.find("[data-content='footer-contacts-visit-header']").html(footer.visit.header);

                $body.find("[data-content='footer-contacts-visit-desc']").html(footer.visit.description);
                $body.find("[data-content='footer-copyright-desc']").html(footer.copyright.description);
            }
        }
    });
});

// Google maps setup

var map;
google.maps.event.addDomListener(window, 'load', googleMapsInit);

function googleMapsInit() {
    var myLatlng = new google.maps.LatLng(51.372027, 6.160478);
    var mapOptions = {
        zoom: 15,
        center: myLatlng,
        scrollwheel: false,
        navigationControl: false,
        mapTypeControl: false,
        scaleControl: false,
        disableDefaultUI: true,
        styles: [{"featureType":"landscape","stylers":[{"visibility":"simplified"},{"color":"#2b3f57"},{"weight":0.1}]},{"featureType":"administrative","stylers":[{"visibility":"on"},{"hue":"#ff0000"},{"weight":0.4},{"color":"#ffffff"}]},{"featureType":"road.highway","elementType":"labels.text","stylers":[{"weight":1.3},{"color":"#FFFFFF"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"color":"#f55f77"},{"weight":3}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#f55f77"},{"weight":1.1}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#f55f77"},{"weight":0.4}]},{},{"featureType":"road.highway","elementType":"labels","stylers":[{"weight":0.8},{"color":"#ffffff"},{"visibility":"on"}]},{"featureType":"road.local","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"road.arterial","elementType":"labels","stylers":[{"color":"#ffffff"},{"weight":0.7}]},{"featureType":"poi","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi","stylers":[{"color":"#6c5b7b"}]},{"featureType":"water","stylers":[{"color":"#f3b191"}]},{"featureType":"transit.line","stylers":[{"visibility":"on"}]}]
    };

    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

    var marker = new google.maps.Marker({
        position: myLatlng,
        icon: '//expo-mate.github.io/assets/images/marker.png',
        map: map
    });

    var infowindow = new google.maps.InfoWindow({
        content: $('.contact-details-map').html()
    });


    if($(window).width() > 450){
        map.panBy(200, -150);
    }

    google.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map,marker);
    });
}
$(function(){
    // Load projects
    if ($('body').hasClass('projects')){
        var url = './assets/json/content.bin';
        var hash = window.location.hash;

        $.ajax({
            url: url,
            scriptCharset: "utf-8",
            type: "GET",
            success: function (data) {
                var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))))
                , loc = getCookie('lang')
                , homeproject = actual[loc].pages.homepage.content.projects
                , reviewLink = homeproject.reviewLink || ''
                , projectDetail = actual[loc].pages.projects
                , section = $('#projects .projects-wrapper');

                if (loc === undefined) {
                    chooseCookie();
                }

                $.each(projectDetail, function (index, item) {
                    var imageArray = []
                        , imageContent = item.images
                        , count = parseInt(index) + 1
                        , review = item.review
                        , author = review.author || ''
                        , desc = review.description || ''
                        , reviewDate = review.date || ''
                        , identifier = author.replace(/[^A-Z0-9]+/ig, "-").toLowerCase()
                        , starCount = review.stars || '';

                    if (imageContent && imageContent.length > 0) {
                        $.each(imageContent, function (index, item) {
                            if(item){
                                imageArray.push('<div class="project-image" style="background-image: url('+item.src+')"></div>')
                            }
                        });
                    }

                    section.append('<div class="project" id="project'+count+'">\n' +
                                    '	<div class="project-close"></div>\n' +
                                    '	<div class="project-wrapper">\n' +
                                    '		<div class="project-images">\n' +
                                    '			<div class="slider">'+imageArray.join("")+'</div>\n' +
                                    '		</div>\n' +
                                    '		<div class="project-desc-wrapper">\n' +
                                    '			<div class="project-desc-content">\n' +
                                    '				<div class="project-header">\n' +
                                    '					<h2 class="project-title">'+item.header+'</h2>\n' +
                                    '					<div class="project-sub-title">'+item.subTitle+'</div>\n' +
                                    '				</div>\n' +
                                    '				<div class="project-desc"> \n' +
                                    '				   <span>'+item.description+'</span> \n' +
                                    '				   <a class="read-review" data-count="'+count+'">'+reviewLink+' '+item.header+'</a> \n' +
                                    '			   </div>\n' +
                                    '			</div>\n' +
                                    '		</div> \n' +
                                    '	</div>\n' +
                                    '	<div class="project-review">\n' +
                                    '		<div class="review-close"></div> \n' +
                                    '		<div class="review" id="'+identifier+'">\n' +
                                    '			<div class="review-author">'+author+'</div>\n' +
                                    '			<div class="review-date">'+reviewDate+'</div>\n' +
                                    '           <div class="review-stars"><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full fifth"></i></div>\n' +
                                    '			<div class="review-text">'+desc+'</div>\n' +
                                    '		</div>\n' +
                                    '	</div>\n' +
                                    '</div>');

                    if (starCount === 4) {
                        $('.review-stars').find('.fifth').remove();
                    }

                    if (review === undefined || desc === '' || desc === undefined){
                        $('#project'+count).find('.read-review').addClass('hidden');
                    }

                    $('.project-images').on('click', function(){
                        if(!$('body').hasClass('open')) {
                            $(this).parent().parent('.project').addClass('open');
                            var parentID = $(this).parent().parent('.project').attr('id');
                            document.location.href = "#" + parentID;
                            $('body').addClass('open');
                            sliderInit(parentID);
                        }
                    });

                    $('.project-title').on('click', function(){
                        if(!$('body').hasClass('open')){
                            var parentElem = $(this).parent().parent().parent().parent().parent();
                            parentElem.addClass('open');
                            var parentID = parentElem.attr('id');
                            document.location.href="#"+parentID;
                            $('body').addClass('open');
                            sliderInit(parentID);
                        }
                    });

                    $('.project-close').on('click', function() {
                        $('body').removeClass('open');
                        $(this).parent('.project').removeClass('open');
                        var parentID = $(this).parent('.project').attr('id');
                        $('#'+parentID+' .slider').slick("unslick");
                        window.location.hash="";
                        document.getElementById(parentID).scrollIntoView(true);
                    });

                    $('.read-review').on('click', function(e){
                        e.preventDefault();
                        var count = $(this).attr('data-count');
                        $("#project"+count).addClass('show-review').find('.project-review').addClass('show');
                    });

                    $('.review-close').on('click', function(){
                        $(this).parent().removeClass('show').parent('.project').removeClass('show-review');
                    });

                    if(hash && hash !== undefined){
                        hash = window.location.hash.substring(1);
                        var projectID = "project"+count;
                        if (projectID === hash) {
                            $('#'+hash).addClass('open');
                            $('body').addClass('open');
                            sliderInit(projectID);
                        }
                    }
                });
            }, 
            error: function (err) {
                chooseCookie();
            }
        });
    }
});


function sliderInit(projectElem){
    setTimeout(function(){
        if(typeof projectElem === 'string'){
            $('#'+projectElem+' .slider').slick({
                slidesToShow: 1,
                slidesToScroll: 1,
                accessibility: true,
                autoplay: true,
                autoplaySpeed: 3000,
                adaptiveHeight: true,
                arrows: true,
                lazyLoad: 'onDemand',
                swip: true,
                cssEase: 'ease'
            });
        }
    },100);
    
}



var testimonial = $('#google-reviews');

$(function() {
    var url = './assets/json/content.bin';
    $.ajax({
        url: url,
        scriptCharset: "utf-8",
        type: "GET",
        success: function (data) {
            var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))));
            var loc = getCookie('lang');
            var projectDetail = actual[loc].pages.projects;

            $.each(projectDetail, function (index, item) {
                var review = item.review
                    , author = review.author || ''
                    , desc = review.description || ''
                    , reviewDate = review.date || ''
                    , identifier = author.replace(/[^A-Z0-9]+/ig, "-").toLowerCase()
                    , starCount = review.stars || '';

                if (review && review !== undefined && desc !== '' && desc !== undefined || starCount !== '' && starCount !== undefined) {
                    testimonial.addClass('hidden');
                    if (testimonial.length > 0) {
                        testimonial.append('<div class="review" id="' + identifier + '">\n' +
                            '               <div class="review-author">' + author + '</div>\n' +
                            '               <div class="review-date">' + reviewDate + '</div>\n' +
                            '               <div class="review-stars"><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full fifth"></i></div>\n' +
                            '               <div class="review-text">' + review.description + '</div>\n' +
                            '            </div>');

                        if (starCount === 4) {
                            $('.review-stars').find('.fifth').remove();
                        }
                    }
                }
            });

            setTimeout(function () {
                reviewSlider();
            }, 1000);
        }
    });
});


function reviewSlider(){
    testimonial.removeClass('hidden');
    testimonial.not('.slick-initialized').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        autoplay: true,
        fade: true,
        infinite: true,
        autoplaySpeed: 8000,
        arrows: true
    });
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuaW1hdGlvbnMuanMiLCJib290c3RyYXAuanMiLCJjb29raWVzLmpzIiwiaGVhZGVyLmpzIiwiaW1hZ2VDb21wYXJpc29uLmpzIiwibG9jYWxlLmpzIiwibWFwc0luaXQuanMiLCJwcm9qZWN0LWJvb3RzdHJhcC5qcyIsInJldmlld3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaXNIb21lUGFnZSA9ICQoJ2JvZHkuaG9tZXBhZ2UnKTtcclxuaWYgKGlzSG9tZVBhZ2Upe1xyXG4gICAgJC5mbi5pc0luVmlld3BvcnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgdGhhdCA9ICQodGhpcyk7XHJcbiAgICAgICAgaWYgKHRoYXQgIT09ICd1bmRlZmluZWQnICYmIHRoYXQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50VG9wID0gJCh0aGlzKS5vZmZzZXQoKS50b3A7XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50Qm90dG9tID0gZWxlbWVudFRvcCArICQodGhpcykub3V0ZXJIZWlnaHQoKTtcclxuICAgICAgICAgICAgdmFyIHZpZXdwb3J0VG9wID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xyXG4gICAgICAgICAgICB2YXIgdmlld3BvcnRCb3R0b20gPSB2aWV3cG9ydFRvcCArICQod2luZG93KS5oZWlnaHQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRCb3R0b20gPiB2aWV3cG9ydFRvcCAmJiBlbGVtZW50VG9wIDwgdmlld3BvcnRCb3R0b207XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG5cclxudmFyIGFib3V0QW5pbWF0aW9uSGFzUmFuID0gZmFsc2U7XHJcbnZhciBhYm91dFVzQW5pbWF0aW9uSGFzUmFuID0gZmFsc2U7XHJcbnZhciB2YWx1ZXNBbmltYXRpb25IYXNSYW4gPSBmYWxzZTtcclxudmFyIGhlYWRlckFuaW1hdGlvbkhhc1JhbiA9IGZhbHNlO1xyXG52YXIgYnJhbmRzQW5pbWF0aW9uSGFzUmFuID0gZmFsc2U7XHJcbnZhciBoZWFkZXJFbGVtID0gJCgnI2hlYWRlcicpO1xyXG52YXIgYWJvdXRFbGVtID0gJCgnI2Fib3V0Jyk7XHJcbnZhciBicmFuZHNFbGVtID0gJCgnLmJyYW5kbGlzdCcpO1xyXG52YXIgYWJvdXRVc0VsZW0gPSAkKCcjYWJvdXRVcycpO1xyXG52YXIgdmFsdWVzRWxlbSA9ICQoJyN2YWx1ZXMnKTtcclxuXHJcblxyXG4kKGZ1bmN0aW9uKCl7XHJcbiAgICBpZiAoaXNIb21lUGFnZSl7XHJcbiAgICAgICAgZmlyZUFuaW1hdGlvbnMoKTtcclxuICAgICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZSBzY3JvbGwnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgZmlyZUFuaW1hdGlvbnMoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSk7XHJcblxyXG5mdW5jdGlvbiBmaXJlQW5pbWF0aW9ucygpe1xyXG4gICAgaWYoaXNIb21lUGFnZSAmJiBoZWFkZXJFbGVtLmxlbmd0aCA+IDApe1xyXG4gICAgICAgIGlmKGhlYWRlckVsZW0uaXNJblZpZXdwb3J0KCkpe1xyXG4gICAgICAgICAgICB2YXIgbG9nbyA9ICQoJyNoZWFkZXIgLmxvZ28nKTtcclxuICAgICAgICAgICAgdmFyIGNhcHRpb24gPSAkKCcjaGVhZGVyIGgxJyk7XHJcbiAgICAgICAgICAgIHZhciBwbGF5QnRuID0gJCgnI2hlYWRlciAuaWNvbi1wbGF5Jyk7XHJcbiAgICAgICAgICAgIGlmICghaGVhZGVyQW5pbWF0aW9uSGFzUmFuKSB7XHJcbiAgICAgICAgICAgICAgICBUd2Vlbk1heC5mcm9tVG8obG9nbywgLjUsIHtjc3M6IHt5OiBcIi0zMFwiLCBvcGFjaXR5OiAwfX0sIHtjc3M6e3k6XCIwXCIsIG9wYWNpdHk6IFwiMVwifX0pO1xyXG4gICAgICAgICAgICAgICAgVHdlZW5NYXguZnJvbVRvKGNhcHRpb24sIC41LCB7Y3NzOiB7eTogXCItMzBcIiwgb3BhY2l0eTogMH19LCB7Y3NzOnt5OlwiMFwiLCBvcGFjaXR5OiBcIjFcIn0sIGRlbGF5OiAuM30pO1xyXG4gICAgICAgICAgICAgICAgVHdlZW5NYXguZnJvbVRvKHBsYXlCdG4sIC41LCB7b3BhY2l0eTogMCwgc2NhbGU6MS41LCBlYXNlOkJvdW5jZS5lYXNlfSwge29wYWNpdHk6IDEsIHNjYWxlOjF9KTtcclxuICAgICAgICAgICAgICAgIGhlYWRlckFuaW1hdGlvbkhhc1JhbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaXNIb21lUGFnZSAmJiBoZWFkZXJFbGVtLmxlbmd0aCA+IDApe1xyXG4gICAgICAgIGlmKGFib3V0RWxlbS5pc0luVmlld3BvcnQoKSl7XHJcbiAgICAgICAgICAgIHZhciBsZWZ0U2lkZUVsZW0gPSAkKCcjYWJvdXQgPiAubGVmdC1jb250YWluZXInKTtcclxuICAgICAgICAgICAgdmFyIHJpZ2h0U2lkZUVsZW0gPSAkKCcjYWJvdXQgPiAucmlnaHQtY29udGFpbmVyJyk7XHJcbiAgICAgICAgICAgIGlmICghYWJvdXRBbmltYXRpb25IYXNSYW4pIHtcclxuICAgICAgICAgICAgICAgIFR3ZWVuTWF4LmZyb21UbyhsZWZ0U2lkZUVsZW0sIDEsIHtjc3M6IHt4OiBcIi0xMDBcIiwgb3BhY2l0eTogMH19LCB7Y3NzOnt4OlwiMFwiLCBvcGFjaXR5OiBcIjFcIn0sIGRlbGF5OiAxfSk7XHJcbiAgICAgICAgICAgICAgICBUd2Vlbk1heC5mcm9tVG8ocmlnaHRTaWRlRWxlbSwgMSwge2Nzczoge3g6IFwiMTAwXCIsIG9wYWNpdHk6IDB9fSwge2Nzczp7eDpcIjBcIiwgb3BhY2l0eTogXCIxXCJ9LCBkZWxheTogMX0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGFib3V0QW5pbWF0aW9uSGFzUmFuID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZihpc0hvbWVQYWdlICYmIGFib3V0VXNFbGVtLmxlbmd0aCA+IDApe1xyXG4gICAgICAgIGlmKGFib3V0VXNFbGVtLmlzSW5WaWV3cG9ydCgpKXtcclxuICAgICAgICAgICAgdmFyIGVtcGxvID0gJCgnLmVtcGxveWVlLXdyYXBwZXInKTtcclxuICAgICAgICAgICAgaWYgKCFhYm91dFVzQW5pbWF0aW9uSGFzUmFuKSB7XHJcbiAgICAgICAgICAgICAgICBUd2Vlbk1heC5zdGFnZ2VyRnJvbVRvKGVtcGxvLCAxLCB7Y3NzOiB7eDogXCItMTAwXCIsIG9wYWNpdHk6IDB9fSwge2Nzczp7eDpcIjBcIiwgb3BhY2l0eTogXCIxXCJ9LCBkZWxheTogMX0sIDAuNSk7XHJcbiAgICAgICAgICAgICAgICBhYm91dFVzQW5pbWF0aW9uSGFzUmFuID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZihpc0hvbWVQYWdlICYmIGJyYW5kc0VsZW0ubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgaWYoYnJhbmRzRWxlbS5pc0luVmlld3BvcnQoKSl7XHJcbiAgICAgICAgICAgIHZhciBicmFuZCA9IGJyYW5kc0VsZW0uZmluZCgnbGknKTtcclxuICAgICAgICAgICAgaWYgKCFicmFuZHNBbmltYXRpb25IYXNSYW4pIHtcclxuICAgICAgICAgICAgICAgIFR3ZWVuTWF4LnN0YWdnZXJGcm9tVG8oYnJhbmQsIC41LCB7Y3NzOiB7eDogXCItNDBcIiwgb3BhY2l0eTogMH19LCB7Y3NzOnt4OlwiMFwiLCBvcGFjaXR5OiBcIjFcIn0sIGRlbGF5OiAuMn0sIDAuMik7XHJcbiAgICAgICAgICAgICAgICBicmFuZHNBbmltYXRpb25IYXNSYW4gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmKGlzSG9tZVBhZ2UgJiYgdmFsdWVzRWxlbS5sZW5ndGggPiAwKXtcclxuICAgICAgICBpZih2YWx1ZXNFbGVtLmlzSW5WaWV3cG9ydCgpKXtcclxuICAgICAgICAgICAgdmFyIHZhbHVlSXRlbSA9ICQoJy52YWx1ZUl0ZW0nKTtcclxuICAgICAgICAgICAgaWYgKCF2YWx1ZXNBbmltYXRpb25IYXNSYW4pIHtcclxuXHJcbiAgICAgICAgICAgICAgICAkLmVhY2godmFsdWVJdGVtLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0RWxlbSA9ICQodGhpcykuZmluZCgnc3Ryb25nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmRvbU51bSA9IChNYXRoLnJhbmRvbSgpICogKDAuNSAtIDIuOSkgKyAyLjkpLnRvRml4ZWQoMik7XHJcbiAgICAgICAgICAgICAgICAgICAgVHdlZW5NYXguZnJvbVRvKHRleHRFbGVtLCAxLCB7Y3NzOiB7eDogXCItMTBcIiwgb3BhY2l0eTogMH19LCB7Y3NzOnt4OlwiMFwiLCBvcGFjaXR5OiBcIjFcIn0sIGRlbGF5OiByYW5kb21OdW19KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhbHVlc0FuaW1hdGlvbkhhc1JhbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaXNIb21lUGFnZSAmJiBhYm91dFVzRWxlbS5sZW5ndGggPiAwKXtcclxuICAgICAgICBpZihhYm91dFVzRWxlbS5pc0luVmlld3BvcnQoKSl7XHJcbiAgICAgICAgICAgIHZhciBlbXBsb3llZSA9ICQoJy5lbXBsb3llZS13cmFwcGVyJyk7XHJcbiAgICAgICAgICAgIGlmICghYWJvdXRVc0FuaW1hdGlvbkhhc1Jhbikge1xyXG4gICAgICAgICAgICAgICAgVHdlZW5NYXguc3RhZ2dlckZyb21UbyhlbXBsb3llZSwgMSwge2Nzczoge3g6IFwiLTEwMFwiLCBvcGFjaXR5OiAwfX0sIHtjc3M6e3g6XCIwXCIsIG9wYWNpdHk6IFwiMVwifSwgZGVsYXk6IDF9LCAwLjUpO1xyXG4gICAgICAgICAgICAgICAgYWJvdXRVc0FuaW1hdGlvbkhhc1JhbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5cclxuIiwiJChmdW5jdGlvbiAoKSB7XHJcbiAgICAvLyoqKioqKioqKiBDb25zdFxyXG4gICAgdmFyIGxhc3RTY3JvbGxUb3AgPSAwXHJcbiAgICAgICAgLCBoYXNTY3JvbGxlZCA9IGZhbHNlXHJcbiAgICAgICAgLCBoZWFkZXJFbGVtID0gJCgnI2hlYWRlcicpXHJcbiAgICAgICAgLCBpc0hvbWVQYWdlID0gJCgnYm9keS5ob21lcGFnZScpXHJcbiAgICAgICAgLCB2aWV3UG9ydEhlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKVxyXG4gICAgICAgICwgdmlld1BvcnRXaWR0aCA9ICQod2luZG93KS53aWR0aCgpXHJcbiAgICAgICAgLCBhbmltYXRpb25JbmNyZW1lbnRzID0gOTUwXHJcbiAgICAgICAgLCBzdGVwID0gMFxyXG4gICAgICAgICwgc2Nyb2xsID0gMFxyXG4gICAgICAgICwgaGFzU25hcHBlZCA9IGZhbHNlXHJcbiAgICAgICAgLCBtZXRob2RJdGVtID0gJCgnLm1ldGhvZC1pdGVtJylcclxuICAgICAgICAsIG1ldGhvZENvbnRlbnQgPSAkKCcuZmFkZUluJylcclxuICAgICAgICAsIGlzTW9iaWxlID0gd2luZG93Lm9yaWVudGF0aW9uID4gLTEgJiYgc2NyZWVuLndpZHRoIDw9IDY0MFxyXG4gICAgICAgICwgaXNfaVBhZCA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL2lQYWQvaSkgIT0gbnVsbFxyXG4gICAgICAgICwgcGxhY2Vob2xkZXIgPSAkKCdib2R5JykuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWhvdmVyTGFiZWwnXVwiKTtcclxuXHJcbiAgICAvLyoqKioqKioqKiBFdmVudCBIYW5kbGVyc1xyXG5cclxuICAgICQod2luZG93KS5vbignbW91c2V3aGVlbCBET01Nb3VzZVNjcm9sbCB0b3VjaG1vdmUnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBoYXNTY3JvbGxlZCA9IHRydWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmlld1BvcnRIZWlnaHQgPSAkKHRoaXMpLmhlaWdodCgpO1xyXG4gICAgICAgIHZpZXdQb3J0V2lkdGggPSAkKHRoaXMpLndpZHRoKCk7XHJcbiAgICAgICAgYW5pbWF0aW9uSW5jcmVtZW50cyA9ICQod2luZG93KS5oZWlnaHQoKSAvIDEwMCAqIDIwO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYoaXNIb21lUGFnZSAhPT0gdW5kZWZpbmVkICYmIGlzSG9tZVBhZ2UubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgdmFyIG1ldGhvZENvbnRhaW5lciA9ICQoJyNtZXRob2QnKVxyXG4gICAgICAgICAgICAsIG1ldGhvZFNjcm9sbENvbnRhaW5lciA9ICQoJy5tZXRob2Qtc2Nyb2xsLXdyYXBwZXInKVxyXG4gICAgICAgICAgICAsIG1ldGhvZENvbnRhaW5lckhlaWdodCA9IG1ldGhvZENvbnRhaW5lci5oZWlnaHQoKVxyXG4gICAgICAgICAgICAsIG1ldGhvZENvbnRhaW5lck9mZnNldCA9IG1ldGhvZENvbnRhaW5lci5vZmZzZXQoKS50b3BcclxuICAgICAgICAgICAgLCBDYXNlU3R1ZHlDb250YWluZXIgPSAkKCcjY2FzZS1zdHVkaWVzJylcclxuICAgICAgICAgICAgLCBDYXNlU3R1ZHlDb250YWluZXJPZmZzZXQgPSB+fkNhc2VTdHVkeUNvbnRhaW5lci5vZmZzZXQoKS50b3BcclxuICAgICAgICAgICAgLCBhYm91dENvbnRhaW5lciA9ICQoJyNhYm91dCcpXHJcbiAgICAgICAgICAgICwgcHJlQWJvdXRDb250YWluZXIgPSAkKCcjcHJlYWJvdXQnKVxyXG4gICAgICAgICAgICAsIHByZUFib3V0Q29udGFpbmVyT2Zmc2V0ID0gcHJlQWJvdXRDb250YWluZXIub2Zmc2V0KCkudG9wXHJcbiAgICAgICAgICAgICwgdG9nZ2xlQ2xhc3NOYW1lID0gJ2FjdGl2ZSdcclxuICAgICAgICAgICAgLCB2aXNpYmxlQ2xhc3NOYW1lID0gJ3Nob3cnO1xyXG5cclxuICAgICAgICBpZihpc01vYmlsZSB8fCBpc19pUGFkKSB7XHJcbiAgICAgICAgICAgIENhc2VTdHVkeUNvbnRhaW5lci5hZGRDbGFzcyh2aXNpYmxlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgbWV0aG9kQ29udGVudC5hZGRDbGFzcyh2aXNpYmxlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgYWJvdXRDb250YWluZXIuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKG1ldGhvZEl0ZW0pLm9uKCdtb3VzZWVudGVyJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpLmF0dHIoJ2RhdGEtaXRlbScpO1xyXG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJCgnLmRpYWdyYW0tbG9nbycpLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgaWYocGxhY2Vob2xkZXIubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlci5hZGRDbGFzcygnaGlkZGVuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJCgnLm1ldGhvZC1kZXNjLicrIGl0ZW0pLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJCgnI2RpYWdyYW0nKS5hZGRDbGFzcyhpdGVtKTtcclxuICAgICAgICB9KS5vbignbW91c2VsZWF2ZScsZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpLmF0dHIoJ2RhdGEtaXRlbScpO1xyXG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJCgnLmRpYWdyYW0tbG9nbycpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgaWYocGxhY2Vob2xkZXIubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlci5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJCgnLm1ldGhvZC1kZXNjLicrIGl0ZW0pLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJCgnI2RpYWdyYW0nKS5yZW1vdmVDbGFzcyhpdGVtKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCgnLmNsb3NlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICQoJ2JvZHknKS50b2dnbGVDbGFzcygnaXNQbGF5aW5nJyk7XHJcbiAgICAgICAgICAgIGhlYWRlckVsZW0ucmVtb3ZlQ2xhc3MoJ3BsYXknKTtcclxuICAgICAgICAgICAgaGVhZGVyRWxlbS5maW5kKCcudmlkZW8tY29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ3BsYXknKTtcclxuICAgICAgICAgICAgJCgnLnlvdXR1YmUtdmlkZW8tZW1iZWQgaWZyYW1lJykuYXR0cignaWQnLCAnJykuYXR0cignc3JjJywgJycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKCcucGxheS12aWRlby13cmFwcGVyJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgJCgnYm9keScpLnRvZ2dsZUNsYXNzKCdpc1BsYXlpbmcnKTtcclxuICAgICAgICAgICAgaGVhZGVyRWxlbS5hZGRDbGFzcygncGxheScpO1xyXG4gICAgICAgICAgICBoZWFkZXJFbGVtLmZpbmQoJy52aWRlby1jb250YWluZXInKS5hZGRDbGFzcygncGxheScpO1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gJy4vYXNzZXRzL2pzb24vY29udGVudC5qc29uJztcclxuICAgICAgICAgICAgJC5nZXRKU09OKHVybCwgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxvYyA9IGdldENvb2tpZSgnbGFuZycpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxvY0RhdGEgPSBkYXRhW2xvY107XHJcbiAgICAgICAgICAgICAgICB2YXIgaG9tZXBhZ2UgPSBsb2NEYXRhLnBhZ2VzLmhvbWVwYWdlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9IGhvbWVwYWdlLmhlYWRlci5jb250ZW50O1xyXG5cclxuICAgICAgICAgICAgICAgICQoJy55b3V0dWJlLXZpZGVvLWVtYmVkIGlmcmFtZScpLmF0dHIoJ2lkJywgaGVhZGVyLnlvdXR1YmVVUkwpLmF0dHIoJ3NyYycsICdodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8nICsgaGVhZGVyLnlvdXR1YmVVUkwgKyAnP2F1dG9wbGF5PTAmcmVsPTAmZnM9MSZlbmFibGVqc2FwaT0xJylcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQod2luZG93KS5vbignc2Nyb2xsJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgc2Nyb2xsID0gfn4kKHRoaXMpLnNjcm9sbFRvcCgpO1xyXG5cclxuICAgICAgICAgICAgaWYodmlld1BvcnRIZWlnaHQgPCAxMTAwKXtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbkluY3JlbWVudHMgPSAxMDUwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBtZXRob2RJdGVtLnJlbW92ZUNsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcblxyXG4gICAgICAgICAgICBnZXREaXJlY3Rpb24oc2Nyb2xsLCBsYXN0U2Nyb2xsVG9wLCBmdW5jdGlvbihkaXJlY3Rpb24sIHNjcm9sbCl7XHJcbiAgICAgICAgICAgICAgICBsYXN0U2Nyb2xsVG9wID0gc2Nyb2xsO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHNjcm9sbCAmJiBoYXNTY3JvbGxlZCAmJiAhaXNNb2JpbGUgJiYgdmlld1BvcnRXaWR0aCA+IDEyMDAgJiYgIWlzX2lQYWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihkaXJlY3Rpb24gPT09ICdkb3duJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL29uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGwgPj0gbWV0aG9kQ29udGFpbmVyT2Zmc2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc1NuYXBwZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RDb250ZW50LnJlbW92ZUNsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbWV0aG9kSXRlbS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtZXRob2RTY3JvbGxDb250YWluZXIuYWRkQ2xhc3MoJ2ZpeGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kU2Nyb2xsQ29udGFpbmVyLmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZU1ldGhvZFNjcm9sbCg1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaGFzU25hcHBlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGwgPj0gbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgbWV0aG9kQ29udGFpbmVySGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYXNlU3R1ZHlDb250YWluZXIuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RDb250ZW50LnJlbW92ZUNsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tZXRob2RJdGVtLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbWV0aG9kU2Nyb2xsQ29udGFpbmVyLnJlbW92ZUNsYXNzKCdmaXhlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kU2Nyb2xsQ29udGFpbmVyLnJlbW92ZUNsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9oYXNTbmFwcGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGwgPj0gcHJlQWJvdXRDb250YWluZXJPZmZzZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3V0Q29udGFpbmVyLmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ2FzZVN0dWR5Q29udGFpbmVyLmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RDb250ZW50LmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhYm91dENvbnRhaW5lci5hZGRDbGFzcyh2aXNpYmxlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGRpcmVjdGlvbiA9PT0gJ3VwJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL29uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGwgPCBDYXNlU3R1ZHlDb250YWluZXJPZmZzZXQgLSBhbmltYXRpb25JbmNyZW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc1NuYXBwZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21ldGhvZEl0ZW0ucmVtb3ZlQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21ldGhvZFNjcm9sbENvbnRhaW5lci5hZGRDbGFzcygnZml4ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RTY3JvbGxDb250YWluZXIuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlTWV0aG9kU2Nyb2xsKDUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9oYXNTbmFwcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjcm9sbCA8PSBtZXRob2RDb250YWluZXJPZmZzZXQgLSAxMDAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RDb250ZW50LnJlbW92ZUNsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21ldGhvZEl0ZW0ucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tZXRob2RTY3JvbGxDb250YWluZXIucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2hhc1NuYXBwZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaGFzU25hcHBlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Nyb2xsID4gbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICYmIHNjcm9sbCA8IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjcm9sbCA+IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMgJiYgc2Nyb2xsIDwgbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgYW5pbWF0aW9uSW5jcmVtZW50cyAqIDIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjcm9sbCA+IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMgKiAyICYmIHNjcm9sbCA8IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMgKiAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY3JvbGwgPiBtZXRob2RDb250YWluZXJPZmZzZXQgKyBhbmltYXRpb25JbmNyZW1lbnRzICogMyAmJiBzY3JvbGwgPCBtZXRob2RDb250YWluZXJPZmZzZXQgKyBhbmltYXRpb25JbmNyZW1lbnRzICogNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcCA9IDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2Nyb2xsID4gbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgYW5pbWF0aW9uSW5jcmVtZW50cyAqIDQgJiYgc2Nyb2xsIDwgQ2FzZVN0dWR5Q29udGFpbmVyT2Zmc2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwID0gNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlTWV0aG9kU2Nyb2xsKHN0ZXApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGdldERpcmVjdGlvbiAoc2Nyb2xsLCBsYXN0U2Nyb2xsVG9wLCBjYWxsYmFjayl7XHJcbiAgICB2YXIgZGlyZWN0aW9uID0gbnVsbFxyXG4gICAgICAgICwgZGVsdGEgPSA1O1xyXG5cclxuICAgIGlmKE1hdGguYWJzKGxhc3RTY3JvbGxUb3AgLSBzY3JvbGwpIDw9IGRlbHRhKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzY3JvbGwgPiBsYXN0U2Nyb2xsVG9wKXtcclxuICAgICAgICBkaXJlY3Rpb24gPSAnZG93bic7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRpcmVjdGlvbiA9ICd1cCc7XHJcbiAgICB9XHJcbiAgICBjYWxsYmFjayhkaXJlY3Rpb24sIHNjcm9sbCk7XHJcbn1cclxuXHJcbi8vIFRoaXMgZnVuY3Rpb24gc2hvd2VkIHRoZSBhcHByb3ByaWF0ZSBidWJibGVcclxuLy8gY3VycmVudGx5IG5vdCB1c2VkIGFzIHRoZSBzY3JvbGxpbmcgZnVuY3Rpb24gaXMgZGlzYWJsZWRcclxuZnVuY3Rpb24gaGFuZGxlTWV0aG9kU2Nyb2xsKHN0ZXApe1xyXG4gICAgdmFyIHRvZ2dsZUNsYXNzTmFtZSA9ICdtZXRob2QnXHJcbiAgICAgICAgLCBmYWRlSW5FbGVtQ2xhc3MgPSAnLmZhZGVJbidcclxuICAgICAgICAsIG1ldGhvZEVsZW0gPSAnLm1ldGhvZC1pdGVtJ1xyXG4gICAgICAgICwgaW50cm9FbGVtQ2xhc3MgPSAnLmludHJvJ1xyXG4gICAgICAgICwgZGVzaWduRWxlbUNsYXNzID0gJy5kZXNpZ24nXHJcbiAgICAgICAgLCB0dW5pbmdFbGVtQ2xhc3MgPSAnLnR1bmluZydcclxuICAgICAgICAsIGNvbnN0cnVjdGlvbkVsZW1DbGFzcyA9ICcuY29uc3RydWN0aW9uJ1xyXG4gICAgICAgICwgZXZhbEVsZW1DbGFzcyA9ICcuZXZhbCc7XHJcblxyXG4gICAgJChmYWRlSW5FbGVtQ2xhc3MpLnJlbW92ZUNsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAkKG1ldGhvZEVsZW0pLnJlbW92ZUNsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcblxyXG4gICAgaWYoc3RlcCA9PT0gMSl7XHJcbiAgICAgICAgJChmYWRlSW5FbGVtQ2xhc3MraW50cm9FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChtZXRob2RFbGVtK2ludHJvRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgfSBlbHNlIGlmKHN0ZXAgPT09IDIpIHtcclxuICAgICAgICAkKG1ldGhvZEVsZW0raW50cm9FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChmYWRlSW5FbGVtQ2xhc3MrZGVzaWduRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbStkZXNpZ25FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICB9IGVsc2UgaWYoc3RlcCA9PT0gMykge1xyXG4gICAgICAgICQobWV0aG9kRWxlbStpbnRyb0VsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rZGVzaWduRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQoZmFkZUluRWxlbUNsYXNzK3R1bmluZ0VsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rdHVuaW5nRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgfSBlbHNlIGlmKHN0ZXAgPT09IDQpIHtcclxuICAgICAgICAkKG1ldGhvZEVsZW0raW50cm9FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChtZXRob2RFbGVtK2Rlc2lnbkVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rdHVuaW5nRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQoZmFkZUluRWxlbUNsYXNzK2NvbnN0cnVjdGlvbkVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rY29uc3RydWN0aW9uRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgfSBlbHNlIGlmKHN0ZXAgPT09IDUpIHtcclxuICAgICAgICAkKG1ldGhvZEVsZW0raW50cm9FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChtZXRob2RFbGVtK2Rlc2lnbkVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rdHVuaW5nRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbStjb25zdHJ1Y3Rpb25FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChmYWRlSW5FbGVtQ2xhc3MrZXZhbEVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rZXZhbEVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgIH1cclxufSIsImNob29zZUNvb2tpZSgpO1xyXG5cclxuZnVuY3Rpb24gc2V0Q29va2llKG5hbWUsdmFsdWUsZGF5cykge1xyXG4gICAgdmFyIGV4cGlyZXMgPSBcIlwiO1xyXG4gICAgaWYgKGRheXMpIHtcclxuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgKGRheXMqMjQqNjAqNjAqMTAwMCkpO1xyXG4gICAgICAgIGV4cGlyZXMgPSBcIjsgZXhwaXJlcz1cIiArIGRhdGUudG9VVENTdHJpbmcoKTtcclxuICAgIH1cclxuICAgIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyBcIj1cIiArICh2YWx1ZSB8fCBcIlwiKSAgKyBleHBpcmVzICsgXCI7IHBhdGg9L1wiO1xyXG59XHJcbmZ1bmN0aW9uIGdldENvb2tpZShuYW1lKSB7XHJcbiAgICB2YXIgbmFtZUVRID0gbmFtZSArIFwiPVwiO1xyXG4gICAgdmFyIGNhID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7XHJcbiAgICBmb3IodmFyIGk9MDtpIDwgY2EubGVuZ3RoO2krKykge1xyXG4gICAgICAgIHZhciBjID0gY2FbaV07XHJcbiAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApPT0nICcpIGMgPSBjLnN1YnN0cmluZygxLGMubGVuZ3RoKTtcclxuICAgICAgICBpZiAoYy5pbmRleE9mKG5hbWVFUSkgPT0gMCkgcmV0dXJuIGMuc3Vic3RyaW5nKG5hbWVFUS5sZW5ndGgsYy5sZW5ndGgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn1cclxuZnVuY3Rpb24gZXJhc2VDb29raWUobmFtZSkge1xyXG4gICAgZG9jdW1lbnQuY29va2llID0gbmFtZSsnPTsgTWF4LUFnZT0tOTk5OTk5OTk7JztcclxufVxyXG5cclxuZnVuY3Rpb24gY2hvb3NlQ29va2llKCl7XHJcbiAgICB2YXIgdXNlckxhbmcgPSBuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgbmF2aWdhdG9yLnVzZXJMYW5ndWFnZTtcclxuICAgIHZhciBhY3RpdmVDb29raWUgPSBnZXRDb29raWUoJ2xhbmcnKTtcclxuICAgIHZhciBxdWVyeVBhcmFtID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdsYW5nJyk7XHJcbiAgICBpZihhY3RpdmVDb29raWUgPT09IHVuZGVmaW5lZCB8fCBhY3RpdmVDb29raWUgPT09IG51bGwgfHwgYWN0aXZlQ29va2llID09PSAnJyl7XHJcbiAgICAgICAgaWYodXNlckxhbmcubWF0Y2goL2RlL2cpKXtcclxuICAgICAgICAgICAgc2V0Q29va2llKCdsYW5nJywnZW4nLDcpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodXNlckxhbmcubWF0Y2goL2VuL2cpKXtcclxuICAgICAgICAgICAgc2V0Q29va2llKCdsYW5nJywnZW4nLDcpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodXNlckxhbmcubWF0Y2goL25sL2cpKSB7XHJcbiAgICAgICAgICAgIHNldENvb2tpZSgnbGFuZycsJ25sJyw3KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZXRDb29raWUoJ2xhbmcnLCdubCcsNyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICB9LDIwKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKGFjdGl2ZUNvb2tpZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHF1ZXJ5UGFyYW0gIT09IHVuZGVmaW5lZCAmJiBxdWVyeVBhcmFtID09PSAnZGUnKXtcclxuICAgICAgICBzZXRDb29raWUoJ2xhbmcnLCdkZScsNyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICQoJyNuYXYgLmFjdGl2ZS1sb2MnKS5odG1sKGdldENvb2tpZSgnbGFuZycpKTtcclxuICAgIH0sMjAwKTtcclxuICAgIFxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUobmFtZSwgdXJsKSB7XHJcbiAgICBpZiAoIXVybCkgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XHJcbiAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XHJcbiAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKCdbPyZdJyArIG5hbWUgKyAnKD0oW14mI10qKXwmfCN8JCknKSxcclxuICAgICAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xyXG4gICAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcclxuICAgIGlmICghcmVzdWx0c1syXSkgcmV0dXJuICcnO1xyXG4gICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcclxufVxyXG4iLCIkKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBuYXZJc09wZW4gPSBmYWxzZVxyXG4gICAgICAgICwgbW9iaWxlTmF2ID0gJCgnI25hdiB1bCcpXHJcbiAgICAgICAgLCBoYW1idXJnZXJFbGVtID0gJCgnLmhhbWJ1cmdlcicpXHJcbiAgICAgICAgLCB2aWV3UG9ydE9mZnNldCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcclxuXHJcbiAgICAkKCcjbmF2IGxpIGEnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgdmFyIG5hdkxpbmsgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcclxuICAgICAgICBpZihuYXZMaW5rLmluZGV4T2YoJy4nKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBuYXZMaW5rO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoJCh0aGlzKS5oYXNDbGFzcygnbG9jJykpe1xyXG4gICAgICAgICAgICBlcmFzZUNvb2tpZSgnbGFuZycpO1xyXG4gICAgICAgICAgICBzZXRDb29raWUoJ2xhbmcnLG5hdkxpbmssNyk7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICAgICAgfSwyMCk7XHJcbiAgICAgICAgfSBlbHNlIGlmKG5hdkxpbmsuaW5kZXhPZignIycpICE9PSAtMSkge1xyXG4gICAgICAgICAgICB2YXIgbGlua1BvcyA9ICQobmF2TGluaykub2Zmc2V0KCkudG9wO1xyXG4gICAgICAgICAgICBpZiAobmF2TGluayA9PT0gJyNmb290ZXInKSB7XHJcbiAgICAgICAgICAgICAgICBsaW5rUG9zID0gJCgnI2NvbnRhY3QtaW5mbycpLm9mZnNldCgpLnRvcDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChuYXZMaW5rID09PSAnI2NvbXBhcmlzb24nKSB7XHJcbiAgICAgICAgICAgICAgICBsaW5rUG9zID0gJCgnI2NvbXBhcmlzb24td3JhcHBlcicpLm9mZnNldCgpLnRvcDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKFwiaHRtbCwgYm9keVwiKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiBsaW5rUG9zIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG5hdklzT3Blbikge1xyXG4gICAgICAgICAgICBoYW1idXJnZXJFbGVtLnJlbW92ZUNsYXNzKFwiaXMtYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICBtb2JpbGVOYXYucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xyXG4gICAgICAgICAgICBuYXZJc09wZW4gPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBoYW1idXJnZXJFbGVtLmNsaWNrKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcyhcImlzLWFjdGl2ZVwiKTtcclxuICAgICAgICBtb2JpbGVOYXYudG9nZ2xlQ2xhc3MoXCJvcGVuXCIpO1xyXG4gICAgICAgIG5hdklzT3BlbiA9IHRydWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIHNjcm9sbCA9IH5+JCh0aGlzKS5zY3JvbGxUb3AoKTtcclxuICAgICAgICBmaXhOYXYoc2Nyb2xsKTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoJy5jb250YWN0LWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIGZvb3Rlck9mZnNldCA9ICQoJ2Zvb3RlcicpLm9mZnNldCgpLnRvcDtcclxuICAgICAgICAkKFwiaHRtbCwgYm9keVwiKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiBmb290ZXJPZmZzZXQgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmaXhOYXYodmlld1BvcnRPZmZzZXQpO1xyXG59KTtcclxuXHJcblxyXG5mdW5jdGlvbiBmaXhOYXYoc2Nyb2xsKXtcclxuICAgIHZhciBuYXYgPSAkKFwiI25hdlwiKTtcclxuICAgIGlmIChzY3JvbGwgPj0gNTAwKSB7XHJcbiAgICAgICAgbmF2LmFkZENsYXNzKFwiZml4ZWRcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIG5hdi5yZW1vdmVDbGFzcyhcImZpeGVkXCIpO1xyXG4gICAgfVxyXG59IiwiJChmdW5jdGlvbigpe1xyXG4gICAgLy8gTG9hZCBwcm9qZWN0c1xyXG4gICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygnaG9tZXBhZ2UnKSl7XHJcbiAgICAgICAgdmFyIHVybCA9ICcuL2Fzc2V0cy9qc29uL2NvbnRlbnQuYmluJztcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgc2NyaXB0Q2hhcnNldDogXCJ1dGYtOFwiLFxyXG4gICAgICAgICAgICB0eXBlOiBcIkdFVFwiLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjdHVhbCA9IEpTT04ucGFyc2UoZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZSh3aW5kb3cuYXRvYihkYXRhKSkpKTtcclxuICAgICAgICAgICAgICAgIHZhciBsb2MgPSBnZXRDb29raWUoJ2xhbmcnKTtcclxuICAgICAgICAgICAgICAgIHZhciBsb2NEYXRhID0gYWN0dWFsW2xvY107XHJcbiAgICAgICAgICAgICAgICB2YXIgaG9tZXBhZ2UgPSBsb2NEYXRhLnBhZ2VzLmhvbWVwYWdlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbXBhcmlzb24gPSBob21lcGFnZS5jb250ZW50LmNvbXBhcmlzb247XHJcbiAgICAgICAgICAgICAgICB2YXIgY29tcGFyaXNvbldyYXBwZXIgPSAkKFwiI2NvbXBhcmlzb25cIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29tcGFyaXNvbkl0ZW0gPSBjb21wYXJpc29uLmNvbXBhcmlzb25zIHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgJC5lYWNoKGNvbXBhcmlzb25JdGVtLCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb21wYXJpc29uV3JhcHBlci5hcHBlbmQoJzxkaXYgY2xhc3M9XCJpdGVtXCI+PGltZyBkYXRhLWNvbnRlbnQ9XCJjb250ZW50LWNvbXBhcmlzb24tYmVmb3JlXCIgc3JjPVwiJyArIGl0ZW0uYmVmb3JlICsgJ1wiIGNsYXNzPVwiYmVmb3JlXCIgYWx0PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBkYXRhLWNvbnRlbnQ9XCJjb250ZW50LWNvbXBhcmlzb24tYWZ0ZXJcIiBjbGFzcz1cImFmdGVyXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJyArIGl0ZW0uYWZ0ZXIgKyAnKVwiPjwvZGl2PjwvZGl2PicpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKXtcclxuICAgICAgICAgICAgICAgICAgICBjb21wYXJpc29uV3JhcHBlci5ub3QoJy5zbGljay1pbml0aWFsaXplZCcpLnNsaWNrKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzVG9TaG93OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNUb1Njcm9sbDogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3BsYXk6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9wbGF5U3BlZWQ6IDMwMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRBcnJvdzogJy5pY29uLWFycm93LXJpZ2h0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJldkFycm93OiAnLmljb24tYXJyb3ctbGVmdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXBlVG9TbGlkZTogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBjb21wYXJpc29uV3JhcHBlci5vbignc2V0UG9zaXRpb24nLCBmdW5jdGlvbihldmVudCwgc2xpY2ssIGN1cnJlbnRTbGlkZSwgbmV4dFNsaWRlKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlua2JveCA9IGNvbXBhcmlzb25XcmFwcGVyLmZpbmQoJy5zbGljay1hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlua2JveCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5rYm94Lm9uKFwibW91c2Vtb3ZlXCIsdHJhY2tMb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmtib3gub24oXCJ0b3VjaHN0YXJ0XCIsdHJhY2tMb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmtib3gub24oXCJ0b3VjaG1vdmVcIix0cmFja0xvY2F0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSwyMDApO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSk7XHJcblxyXG5mdW5jdGlvbiB0cmFja0xvY2F0aW9uKGUpe1xyXG4gICAgdmFyIGNvbG9yYm94ID0gJCgnLnNsaWNrLWFjdGl2ZSAuYWZ0ZXInKVxyXG4gICAgICAgICwgZmlsbGVySW1hZ2UgPSAkKCcuc2xpY2stYWN0aXZlIC5iZWZvcmUnKVxyXG4gICAgICAgICwgcmVjdCA9IGZpbGxlckltYWdlWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXHJcbiAgICAgICAgLCBmaWxsZXJJbWFnZU93ID0gZmlsbGVySW1hZ2Uub3V0ZXJXaWR0aCgpXHJcbiAgICAgICAgLCBwb3NpdGlvbiA9ICgoZS5wYWdlWCAtIHJlY3QubGVmdCkgLyBmaWxsZXJJbWFnZU93KSoxMDA7XHJcblxyXG4gICAgaWYocG9zaXRpb24gPD0gMTAwKXtcclxuICAgICAgICBjb2xvcmJveC5jc3MoJ3dpZHRoJywgcG9zaXRpb24rXCIlXCIpO1xyXG4gICAgfVxyXG59XHJcblxyXG4iLCIkKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgdXJsID0gJy4vYXNzZXRzL2pzb24vY29udGVudC5iaW4nO1xyXG4gICAgdmFyICRib2R5ID0gJChcImJvZHlcIik7XHJcblxyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICBzY3JpcHRDaGFyc2V0OiBcInV0Zi04XCIsXHJcbiAgICAgICAgdHlwZTogXCJHRVRcIixcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgYWN0dWFsID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKGRhdGEpKSkpO1xyXG4gICAgICAgICAgICB2YXIgbG9jID0gZ2V0Q29va2llKCdsYW5nJyk7XHJcbiAgICAgICAgICAgIHZhciBsb2NEYXRhID0gYWN0dWFsW2xvY107XHJcbiAgICAgICAgICAgIHZhciBuYXYgPSBsb2NEYXRhLm5hdi5sYWJlbHM7XHJcbiAgICAgICAgICAgIHZhciBob21lcGFnZSA9IGxvY0RhdGEucGFnZXMuaG9tZXBhZ2U7XHJcbiAgICAgICAgICAgIHZhciBoZWFkZXIgPSBob21lcGFnZS5oZWFkZXIuY29udGVudDtcclxuICAgICAgICAgICAgdmFyIGludHJvID0gaG9tZXBhZ2UuY29udGVudC5pbnRybztcclxuICAgICAgICAgICAgdmFyIGJyYW5kcyA9IGludHJvLmltYWdlcztcclxuICAgICAgICAgICAgdmFyIGFib3V0ID0gaG9tZXBhZ2UuY29udGVudC5hYm91dDtcclxuICAgICAgICAgICAgdmFyIGFib3V0VXMgPSBob21lcGFnZS5jb250ZW50LmFib3V0VXM7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBob21lcGFnZS5jb250ZW50LnZhbHVlcztcclxuICAgICAgICAgICAgdmFyIGNvbXBhcmlzb24gPSBob21lcGFnZS5jb250ZW50LmNvbXBhcmlzb247XHJcbiAgICAgICAgICAgIHZhciBtZXRob2QgPSBob21lcGFnZS5jb250ZW50Lm1ldGhvZDtcclxuICAgICAgICAgICAgdmFyIG1vZGVsID0gaG9tZXBhZ2UuY29udGVudC5tb2RlbDtcclxuICAgICAgICAgICAgdmFyIHByb2plY3RzID0gaG9tZXBhZ2UuY29udGVudC5wcm9qZWN0cztcclxuICAgICAgICAgICAgdmFyIGZvb3RlciA9IGhvbWVwYWdlLmZvb3RlcjtcclxuXHJcbiAgICAgICAgICAgIGlmIChsb2NEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobG9jID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNob29zZUNvb2tpZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZihuYXYpIHtcclxuICAgICAgICAgICAgICAgIHZhciBuYXZJdGVtID0gJCgnI25hdiA+IHVsID4gbGkgJyk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiNwcmVhYm91dFwiXScpLmh0bWwobmF2LmFib3V0KTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiaW5kZXguaHRtbCNwcmVhYm91dFwiXScpLmh0bWwobmF2LmFib3V0KTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI21ldGhvZFwiXScpLmh0bWwobmF2Lm1ldGhvZCk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cImluZGV4Lmh0bWwjbWV0aG9kXCJdJykuaHRtbChuYXYubWV0aG9kKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI3ZhbHVlc1wiXScpLmh0bWwobmF2LnZhbHVlcyk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cImluZGV4Lmh0bWwjdmFsdWVzXCJdJykuaHRtbChuYXYudmFsdWVzKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI2Fib3V0VXNcIl0nKS5odG1sKG5hdi5hYm91dFVzKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiaW5kZXguaHRtbCNhYm91dFVzXCJdJykuaHRtbChuYXYuYWJvdXRVcyk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cInByb2plY3RzLmh0bWxcIl0nKS5odG1sKG5hdi5wcm9qZWN0cyk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiNmb290ZXJcIl0nKS5odG1sKG5hdi5jb250YWN0KTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI2Zvb3RlclwiXScpLmh0bWwobmF2LmNvbnRhY3QpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjbWlzc2lvblwiXScpLmh0bWwobmF2Lm1pc3Npb24pO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCJpbmRleC5odG1sI21pc3Npb25cIl0nKS5odG1sKG5hdi5taXNzaW9uKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI21vZGVsXCJdJykuaHRtbChuYXYubW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCJpbmRleC5odG1sI21vZGVsXCJdJykuaHRtbChuYXYubW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjZm91bmRhdGlvblwiXScpLmh0bWwobmF2LmZvdW5kYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCJpbmRleC5odG1sI2ZvdW5kYXRpb25cIl0nKS5odG1sKG5hdi5mb3VuZGF0aW9uKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI2NvbXBhcmlzb25cIl0nKS5odG1sKG5hdi5jb21wYXJpc29uKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiaW5kZXguaHRtbCNjb21wYXJpc29uXCJdJykuaHRtbChuYXYuY29tcGFyaXNvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChoZWFkZXIpIHtcclxuICAgICAgICAgICAgICAgICQoJy5iYWNrZ3JvdW5kLXZpZGVvJykuY3NzKHsnYmFja2dyb3VuZEltYWdlJzogaGVhZGVyLmJhY2tncm91bmRJbWFnZVNyY30pO1xyXG4gICAgICAgICAgICAgICAgJCgnLnlvdXR1YmUtdmlkZW8tZW1iZWQgaWZyYW1lJykuYXR0cignaWQnLCBoZWFkZXIueW91dHViZVVSTCkuYXR0cignc3JjJywgJ2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLycgKyBoZWFkZXIueW91dHViZVVSTCArICc/YXV0b3BsYXk9MCZyZWw9MCZmcz0xJmVuYWJsZWpzYXBpPTEnKVxyXG4gICAgICAgICAgICAgICAgJCgndmlkZW8gc291cmNlI21wNCcpLmF0dHIoJ3NyYycsIGhlYWRlci5iYWNrZ3JvdW5kVmlkZW9NcDRTcmMpO1xyXG4gICAgICAgICAgICAgICAgJCgndmlkZW8gc291cmNlI3dlYm0nKS5hdHRyKCdzcmMnLCBoZWFkZXIuYmFja2dyb3VuZFZpZGVvV2ViTVNyYyk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0naGVhZGVyLWNvbnRlbnQtdGl0bGUnXVwiKS5odG1sKGhlYWRlci5oZWFkZXIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaW50cm8pIHtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWludHJvLXRpdGxlJ11cIikuaHRtbChpbnRyby5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtaW50cm8tZGVzYyddXCIpLmh0bWwoaW50cm8uZGVzY3JpcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKCQoJy5icmFuZGxpc3QnKS5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goYnJhbmRzLCBmdW5jdGlvbiAoaW5kZXgsIGJyYW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGJyYW5kLnNyYyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYm9keS5maW5kKCcuYnJhbmRsaXN0JykuYXBwZW5kKCc8bGk+PGltZyBzcmM9XCInK2JyYW5kLnNyYysnXCIgYWx0PVwiJyticmFuZC5hbHQrJ1wiIC8+PC9saT4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoYWJvdXQpIHtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWFib3V0LXJvdzEtdGl0bGUnXVwiKS5odG1sKGFib3V0LnJvdzEuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWFib3V0LXJvdzEtaW1hZ2UnXVwiKS5jc3MoeydiYWNrZ3JvdW5kSW1hZ2UnOiBhYm91dC5yb3cxLmltYWdlLnNyY30pO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtYWJvdXQtcm93MS1kZXNjJ11cIikuaHRtbChhYm91dC5yb3cxLmRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1hYm91dC1yb3cyLXRpdGxlJ11cIikuaHRtbChhYm91dC5yb3cyLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1hYm91dC1yb3cyLWltYWdlJ11cIikuY3NzKHsnYmFja2dyb3VuZEltYWdlJzogYWJvdXQucm93Mi5pbWFnZS5zcmN9KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWFib3V0LXJvdzItZGVzYyddXCIpLmh0bWwoYWJvdXQucm93Mi5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChhYm91dFVzKSB7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1hYm91dFVzLXRpdGxlJ11cIikuaHRtbChhYm91dFVzLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1hYm91dFVzLWRlc2NyaXB0aW9uJ11cIikuaHRtbChhYm91dFVzLmRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1lbXBsb3llZS1uaWVrLWltYWdlJ11cIikuYXR0cignc3JjJywgYWJvdXRVcy5lbXBsb3llZXMubmllay5pbWFnZS5zcmMpLmF0dHIoJ2FsdCcsIGFib3V0VXMuZW1wbG95ZWVzLm5pZWsuaW1hZ2UuYWx0KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWVtcGxveWVlLW5pZWstdGl0bGUnXVwiKS5odG1sKGFib3V0VXMuZW1wbG95ZWVzLm5pZWsuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWVtcGxveWVlLW5pZWstZGVzYyddXCIpLmh0bWwoYWJvdXRVcy5lbXBsb3llZXMubmllay5kZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtZW1wbG95ZWUtamFuLWltYWdlJ11cIikuYXR0cignc3JjJywgYWJvdXRVcy5lbXBsb3llZXMuamFuLmltYWdlLnNyYykuYXR0cignYWx0JywgYWJvdXRVcy5lbXBsb3llZXMuamFuLmltYWdlLmFsdCk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1lbXBsb3llZS1qYW4tdGl0bGUnXVwiKS5odG1sKGFib3V0VXMuZW1wbG95ZWVzLmphbi5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtZW1wbG95ZWUtamFuLWRlc2MnXVwiKS5odG1sKGFib3V0VXMuZW1wbG95ZWVzLmphbi5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh2YWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXZhbHVlcy1pbWFnZSddXCIpLmNzcyh7J2JhY2tncm91bmRJbWFnZSc6IHZhbHVlcy5pbWFnZS5zcmN9KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXZhbHVlcy10aXRsZSddXCIpLmh0bWwodmFsdWVzLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC12YWx1ZXMtZGVzYyddXCIpLmh0bWwodmFsdWVzLmRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC12YWx1ZTEnXVwiKS5odG1sKHZhbHVlcy52YWx1ZXMudmFsdWUxKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXZhbHVlMiddXCIpLmh0bWwodmFsdWVzLnZhbHVlcy52YWx1ZTIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtdmFsdWUzJ11cIikuaHRtbCh2YWx1ZXMudmFsdWVzLnZhbHVlMyk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC12YWx1ZTQnXVwiKS5odG1sKHZhbHVlcy52YWx1ZXMudmFsdWU0KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXZhbHVlNSddXCIpLmh0bWwodmFsdWVzLnZhbHVlcy52YWx1ZTUpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtdmFsdWU2J11cIikuaHRtbCh2YWx1ZXMudmFsdWVzLnZhbHVlNik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChtZXRob2QpIHtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC10aXRsZSddXCIpLmh0bWwobWV0aG9kLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtZGVzYyddXCIpLmh0bWwobWV0aG9kLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1ob3ZlckxhYmVsJ11cIikuaHRtbChtZXRob2QuaG92ZXJMYWJlbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWludHJvLXRpdGxlJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy5pbnRyby5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWludHJvLWRlc2MnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLmludHJvLmRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtZGVzaWduLXRpdGxlJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy5kZXNpZ24uaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1kZXNpZ24tZGVzYyddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMuZGVzaWduLmRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtdHVuaW5nLXRpdGxlJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy50dW5pbmcuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC10dW5pbmctZGVzYyddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMudHVuaW5nLmRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtY29uc3RydWN0aW9uLXRpdGxlJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy5jb25zdHJ1Y3Rpb24uaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1jb25zdHJ1Y3Rpb24tZGVzYyddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMuY29uc3RydWN0aW9uLmRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtZXZhbC10aXRsZSddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMuZXZhbC5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWV2YWwtZGVzYyddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMuZXZhbC5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChtb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbW9kZWwtdGl0bGUnXVwiKS5odG1sKG1vZGVsLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tb2RlbC1pbWFnZSddXCIpLmNzcyh7J2JhY2tncm91bmRJbWFnZSc6IG1vZGVsLmltYWdlLnNyY30pO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbW9kZWwtZGVzYyddXCIpLmh0bWwobW9kZWwuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocHJvamVjdHMpIHtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3RzLXRpdGxlJ11cIikuaHRtbChwcm9qZWN0cy5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdHMtZGVzYyddXCIpLmh0bWwocHJvamVjdHMuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdHMtYnV0dG9uJ11cIikuaHRtbChwcm9qZWN0cy5idXR0b24ubGFiZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3QxLWltYWdlJ11cIikuYXR0cignc3JjJywgcHJvamVjdHMucHJvamVjdDEuaW1hZ2Uuc3JjKS5hdHRyKCdhbHQnLCBwcm9qZWN0cy5wcm9qZWN0MS5pbWFnZS5hbHQpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdDEtdGl0bGUnXVwiKS5odG1sKHByb2plY3RzLnByb2plY3QxLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0MS1idG4nXVwiKS5odG1sKHByb2plY3RzLnByb2plY3QxLmJ1dHRvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdDItaW1hZ2UnXVwiKS5hdHRyKCdzcmMnLCBwcm9qZWN0cy5wcm9qZWN0Mi5pbWFnZS5zcmMpLmF0dHIoJ2FsdCcsIHByb2plY3RzLnByb2plY3QyLmltYWdlLmFsdCk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0Mi10aXRsZSddXCIpLmh0bWwocHJvamVjdHMucHJvamVjdDIuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3QyLWJ0biddXCIpLmh0bWwocHJvamVjdHMucHJvamVjdDIuYnV0dG9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoY29tcGFyaXNvbil7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0cy1jb21wYXJpc29uLXRpdGxlJ11cIikuaHRtbChjb21wYXJpc29uLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0cy1jb21wYXJpc29uLWRlc2MnXVwiKS5odG1sKGNvbXBhcmlzb24uZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZm9vdGVyKSB7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLXRlc3RpbW9uaWFscy10aXRsZSddXCIpLmh0bWwoZm9vdGVyLnRlc3RpbW9uaWFscy5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1oZWFkZXInXVwiKS5odG1sKGZvb3Rlci5jb250YWN0cy5oZWFkZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtamFuLXRpdGxlJ11cIikuaHRtbChmb290ZXIuY29udGFjdHMuamFuLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLWphbi1lbWFpbCddXCIpLmF0dHIoJ2hyZWYnLCBmb290ZXIuY29udGFjdHMuamFuLmxpbmtzLmVtYWlsLnNyYykuaHRtbChmb290ZXIuY29udGFjdHMuamFuLmxpbmtzLmVtYWlsLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLWxpbmtlZGluLWphbiddXCIpLmF0dHIoJ2hyZWYnLCBmb290ZXIuY29udGFjdHMuamFuLmxpbmtzLmxpbmtlZGluLnNyYyk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLWxpbmtlZGluLWphbi10aXRsZSddXCIpLmh0bWwoIGZvb3Rlci5jb250YWN0cy5qYW4ubGlua3MubGlua2VkaW4uaGVhZGVyKycgJyk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLWNhbGwtamFuLXBob25lJ11cIikuYXR0cignaHJlZicsIGZvb3Rlci5jb250YWN0cy5qYW4ucGhvbmUpO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtbmllay10aXRsZSddXCIpLmh0bWwoZm9vdGVyLmNvbnRhY3RzLm5pZWsuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtbmllay1lbWFpbCddXCIpLmF0dHIoJ2hyZWYnLCBmb290ZXIuY29udGFjdHMubmllay5saW5rcy5lbWFpbC5zcmMpLmh0bWwoZm9vdGVyLmNvbnRhY3RzLm5pZWsubGlua3MuZW1haWwuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtbGlua2VkaW4tbmllayddXCIpLmF0dHIoJ2hyZWYnLCBmb290ZXIuY29udGFjdHMubmllay5saW5rcy5saW5rZWRpbi5zcmMpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1saW5rZWRpbi1uaWVrLXRpdGxlJ11cIikuaHRtbChmb290ZXIuY29udGFjdHMubmllay5saW5rcy5saW5rZWRpbi5oZWFkZXIrJyAnKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtY2FsbC1uaWVrLXBob25lJ11cIikuYXR0cignaHJlZicsIGZvb3Rlci5jb250YWN0cy5uaWVrLnBob25lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLXBob25lLWhlYWRlciddXCIpLmh0bWwoZm9vdGVyLnBob25lLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLXZpc2l0LWhlYWRlciddXCIpLmh0bWwoZm9vdGVyLnZpc2l0LmhlYWRlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy12aXNpdC1kZXNjJ11cIikuaHRtbChmb290ZXIudmlzaXQuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb3B5cmlnaHQtZGVzYyddXCIpLmh0bWwoZm9vdGVyLmNvcHlyaWdodC5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufSk7XHJcbiIsIi8vIEdvb2dsZSBtYXBzIHNldHVwXHJcblxyXG52YXIgbWFwO1xyXG5nb29nbGUubWFwcy5ldmVudC5hZGREb21MaXN0ZW5lcih3aW5kb3csICdsb2FkJywgZ29vZ2xlTWFwc0luaXQpO1xyXG5cclxuZnVuY3Rpb24gZ29vZ2xlTWFwc0luaXQoKSB7XHJcbiAgICB2YXIgbXlMYXRsbmcgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDUxLjM3MjAyNywgNi4xNjA0NzgpO1xyXG4gICAgdmFyIG1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgem9vbTogMTUsXHJcbiAgICAgICAgY2VudGVyOiBteUxhdGxuZyxcclxuICAgICAgICBzY3JvbGx3aGVlbDogZmFsc2UsXHJcbiAgICAgICAgbmF2aWdhdGlvbkNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICBzY2FsZUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgIGRpc2FibGVEZWZhdWx0VUk6IHRydWUsXHJcbiAgICAgICAgc3R5bGVzOiBbe1wiZmVhdHVyZVR5cGVcIjpcImxhbmRzY2FwZVwiLFwic3R5bGVyc1wiOlt7XCJ2aXNpYmlsaXR5XCI6XCJzaW1wbGlmaWVkXCJ9LHtcImNvbG9yXCI6XCIjMmIzZjU3XCJ9LHtcIndlaWdodFwiOjAuMX1dfSx7XCJmZWF0dXJlVHlwZVwiOlwiYWRtaW5pc3RyYXRpdmVcIixcInN0eWxlcnNcIjpbe1widmlzaWJpbGl0eVwiOlwib25cIn0se1wiaHVlXCI6XCIjZmYwMDAwXCJ9LHtcIndlaWdodFwiOjAuNH0se1wiY29sb3JcIjpcIiNmZmZmZmZcIn1dfSx7XCJmZWF0dXJlVHlwZVwiOlwicm9hZC5oaWdod2F5XCIsXCJlbGVtZW50VHlwZVwiOlwibGFiZWxzLnRleHRcIixcInN0eWxlcnNcIjpbe1wid2VpZ2h0XCI6MS4zfSx7XCJjb2xvclwiOlwiI0ZGRkZGRlwifV19LHtcImZlYXR1cmVUeXBlXCI6XCJyb2FkLmhpZ2h3YXlcIixcImVsZW1lbnRUeXBlXCI6XCJnZW9tZXRyeVwiLFwic3R5bGVyc1wiOlt7XCJjb2xvclwiOlwiI2Y1NWY3N1wifSx7XCJ3ZWlnaHRcIjozfV19LHtcImZlYXR1cmVUeXBlXCI6XCJyb2FkLmFydGVyaWFsXCIsXCJlbGVtZW50VHlwZVwiOlwiZ2VvbWV0cnlcIixcInN0eWxlcnNcIjpbe1wiY29sb3JcIjpcIiNmNTVmNzdcIn0se1wid2VpZ2h0XCI6MS4xfV19LHtcImZlYXR1cmVUeXBlXCI6XCJyb2FkLmxvY2FsXCIsXCJlbGVtZW50VHlwZVwiOlwiZ2VvbWV0cnlcIixcInN0eWxlcnNcIjpbe1wiY29sb3JcIjpcIiNmNTVmNzdcIn0se1wid2VpZ2h0XCI6MC40fV19LHt9LHtcImZlYXR1cmVUeXBlXCI6XCJyb2FkLmhpZ2h3YXlcIixcImVsZW1lbnRUeXBlXCI6XCJsYWJlbHNcIixcInN0eWxlcnNcIjpbe1wid2VpZ2h0XCI6MC44fSx7XCJjb2xvclwiOlwiI2ZmZmZmZlwifSx7XCJ2aXNpYmlsaXR5XCI6XCJvblwifV19LHtcImZlYXR1cmVUeXBlXCI6XCJyb2FkLmxvY2FsXCIsXCJlbGVtZW50VHlwZVwiOlwibGFiZWxzXCIsXCJzdHlsZXJzXCI6W3tcInZpc2liaWxpdHlcIjpcIm9mZlwifV19LHtcImZlYXR1cmVUeXBlXCI6XCJyb2FkLmFydGVyaWFsXCIsXCJlbGVtZW50VHlwZVwiOlwibGFiZWxzXCIsXCJzdHlsZXJzXCI6W3tcImNvbG9yXCI6XCIjZmZmZmZmXCJ9LHtcIndlaWdodFwiOjAuN31dfSx7XCJmZWF0dXJlVHlwZVwiOlwicG9pXCIsXCJlbGVtZW50VHlwZVwiOlwibGFiZWxzXCIsXCJzdHlsZXJzXCI6W3tcInZpc2liaWxpdHlcIjpcIm9mZlwifV19LHtcImZlYXR1cmVUeXBlXCI6XCJwb2lcIixcInN0eWxlcnNcIjpbe1wiY29sb3JcIjpcIiM2YzViN2JcIn1dfSx7XCJmZWF0dXJlVHlwZVwiOlwid2F0ZXJcIixcInN0eWxlcnNcIjpbe1wiY29sb3JcIjpcIiNmM2IxOTFcIn1dfSx7XCJmZWF0dXJlVHlwZVwiOlwidHJhbnNpdC5saW5lXCIsXCJzdHlsZXJzXCI6W3tcInZpc2liaWxpdHlcIjpcIm9uXCJ9XX1dXHJcbiAgICB9O1xyXG5cclxuICAgIG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jYW52YXMnKSwgbWFwT3B0aW9ucyk7XHJcblxyXG4gICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgIHBvc2l0aW9uOiBteUxhdGxuZyxcclxuICAgICAgICBpY29uOiAnLy9leHBvLW1hdGUuZ2l0aHViLmlvL2Fzc2V0cy9pbWFnZXMvbWFya2VyLnBuZycsXHJcbiAgICAgICAgbWFwOiBtYXBcclxuICAgIH0pO1xyXG5cclxuICAgIHZhciBpbmZvd2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coe1xyXG4gICAgICAgIGNvbnRlbnQ6ICQoJy5jb250YWN0LWRldGFpbHMtbWFwJykuaHRtbCgpXHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgaWYoJCh3aW5kb3cpLndpZHRoKCkgPiA0NTApe1xyXG4gICAgICAgIG1hcC5wYW5CeSgyMDAsIC0xNTApO1xyXG4gICAgfVxyXG5cclxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaW5mb3dpbmRvdy5vcGVuKG1hcCxtYXJrZXIpO1xyXG4gICAgfSk7XHJcbn0iLCIkKGZ1bmN0aW9uKCl7XHJcbiAgICAvLyBMb2FkIHByb2plY3RzXHJcbiAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdwcm9qZWN0cycpKXtcclxuICAgICAgICB2YXIgdXJsID0gJy4vYXNzZXRzL2pzb24vY29udGVudC5iaW4nO1xyXG4gICAgICAgIHZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XHJcblxyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICBzY3JpcHRDaGFyc2V0OiBcInV0Zi04XCIsXHJcbiAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0dWFsID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKGRhdGEpKSkpXHJcbiAgICAgICAgICAgICAgICAsIGxvYyA9IGdldENvb2tpZSgnbGFuZycpXHJcbiAgICAgICAgICAgICAgICAsIGhvbWVwcm9qZWN0ID0gYWN0dWFsW2xvY10ucGFnZXMuaG9tZXBhZ2UuY29udGVudC5wcm9qZWN0c1xyXG4gICAgICAgICAgICAgICAgLCByZXZpZXdMaW5rID0gaG9tZXByb2plY3QucmV2aWV3TGluayB8fCAnJ1xyXG4gICAgICAgICAgICAgICAgLCBwcm9qZWN0RGV0YWlsID0gYWN0dWFsW2xvY10ucGFnZXMucHJvamVjdHNcclxuICAgICAgICAgICAgICAgICwgc2VjdGlvbiA9ICQoJyNwcm9qZWN0cyAucHJvamVjdHMtd3JhcHBlcicpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChsb2MgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNob29zZUNvb2tpZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICQuZWFjaChwcm9qZWN0RGV0YWlsLCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2VBcnJheSA9IFtdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICwgaW1hZ2VDb250ZW50ID0gaXRlbS5pbWFnZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLCBjb3VudCA9IHBhcnNlSW50KGluZGV4KSArIDFcclxuICAgICAgICAgICAgICAgICAgICAgICAgLCByZXZpZXcgPSBpdGVtLnJldmlld1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGF1dGhvciA9IHJldmlldy5hdXRob3IgfHwgJydcclxuICAgICAgICAgICAgICAgICAgICAgICAgLCBkZXNjID0gcmV2aWV3LmRlc2NyaXB0aW9uIHx8ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICwgcmV2aWV3RGF0ZSA9IHJldmlldy5kYXRlIHx8ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICwgaWRlbnRpZmllciA9IGF1dGhvci5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIi1cIikudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAsIHN0YXJDb3VudCA9IHJldmlldy5zdGFycyB8fCAnJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGltYWdlQ29udGVudCAmJiBpbWFnZUNvbnRlbnQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaW1hZ2VDb250ZW50LCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlQXJyYXkucHVzaCgnPGRpdiBjbGFzcz1cInByb2plY3QtaW1hZ2VcIiBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnK2l0ZW0uc3JjKycpXCI+PC9kaXY+JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uLmFwcGVuZCgnPGRpdiBjbGFzcz1cInByb2plY3RcIiBpZD1cInByb2plY3QnK2NvdW50KydcIj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0PGRpdiBjbGFzcz1cInByb2plY3QtY2xvc2VcIj48L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0PGRpdiBjbGFzcz1cInByb2plY3Qtd3JhcHBlclwiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdDxkaXYgY2xhc3M9XCJwcm9qZWN0LWltYWdlc1wiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0PGRpdiBjbGFzcz1cInNsaWRlclwiPicraW1hZ2VBcnJheS5qb2luKFwiXCIpKyc8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHQ8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHQ8ZGl2IGNsYXNzPVwicHJvamVjdC1kZXNjLXdyYXBwZXJcIj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdDxkaXYgY2xhc3M9XCJwcm9qZWN0LWRlc2MtY29udGVudFwiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHQ8ZGl2IGNsYXNzPVwicHJvamVjdC1oZWFkZXJcIj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdFx0XHQ8aDIgY2xhc3M9XCJwcm9qZWN0LXRpdGxlXCI+JytpdGVtLmhlYWRlcisnPC9oMj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwicHJvamVjdC1zdWItdGl0bGVcIj4nK2l0ZW0uc3ViVGl0bGUrJzwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHQ8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdFx0PGRpdiBjbGFzcz1cInByb2plY3QtZGVzY1wiPiBcXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdFx0ICAgPHNwYW4+JytpdGVtLmRlc2NyaXB0aW9uKyc8L3NwYW4+IFxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHQgICA8YSBjbGFzcz1cInJlYWQtcmV2aWV3XCIgZGF0YS1jb3VudD1cIicrY291bnQrJ1wiPicrcmV2aWV3TGluaysnICcraXRlbS5oZWFkZXIrJzwvYT4gXFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0XHQgICA8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdDwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdDwvZGl2PiBcXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0PC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdDxkaXYgY2xhc3M9XCJwcm9qZWN0LXJldmlld1wiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdDxkaXYgY2xhc3M9XCJyZXZpZXctY2xvc2VcIj48L2Rpdj4gXFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0PGRpdiBjbGFzcz1cInJldmlld1wiIGlkPVwiJytpZGVudGlmaWVyKydcIj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdDxkaXYgY2xhc3M9XCJyZXZpZXctYXV0aG9yXCI+JythdXRob3IrJzwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0PGRpdiBjbGFzcz1cInJldmlldy1kYXRlXCI+JytyZXZpZXdEYXRlKyc8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgPGRpdiBjbGFzcz1cInJldmlldy1zdGFyc1wiPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGxcIj48L2k+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbFwiPjwvaT48aSBjbGFzcz1cImljb24tc3Rhci1mdWxsXCI+PC9pPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGxcIj48L2k+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbCBmaWZ0aFwiPjwvaT48L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdDxkaXYgY2xhc3M9XCJyZXZpZXctdGV4dFwiPicrZGVzYysnPC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0PC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdDwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFyQ291bnQgPT09IDQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJldmlldy1zdGFycycpLmZpbmQoJy5maWZ0aCcpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJldmlldyA9PT0gdW5kZWZpbmVkIHx8IGRlc2MgPT09ICcnIHx8IGRlc2MgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwcm9qZWN0Jytjb3VudCkuZmluZCgnLnJlYWQtcmV2aWV3JykuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLnByb2plY3QtaW1hZ2VzJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoISQoJ2JvZHknKS5oYXNDbGFzcygnb3BlbicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgnLnByb2plY3QnKS5hZGRDbGFzcygnb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudElEID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoJy5wcm9qZWN0JykuYXR0cignaWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBcIiNcIiArIHBhcmVudElEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXJJbml0KHBhcmVudElEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKCcucHJvamVjdC10aXRsZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCEkKCdib2R5JykuaGFzQ2xhc3MoJ29wZW4nKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50RWxlbSA9ICQodGhpcykucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRFbGVtLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50SUQgPSBwYXJlbnRFbGVtLmF0dHIoJ2lkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmPVwiI1wiK3BhcmVudElEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXJJbml0KHBhcmVudElEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKCcucHJvamVjdC1jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoJy5wcm9qZWN0JykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudElEID0gJCh0aGlzKS5wYXJlbnQoJy5wcm9qZWN0JykuYXR0cignaWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycrcGFyZW50SUQrJyAuc2xpZGVyJykuc2xpY2soXCJ1bnNsaWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaD1cIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwYXJlbnRJRCkuc2Nyb2xsSW50b1ZpZXcodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoJy5yZWFkLXJldmlldycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3VudCA9ICQodGhpcykuYXR0cignZGF0YS1jb3VudCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiI3Byb2plY3RcIitjb3VudCkuYWRkQ2xhc3MoJ3Nob3ctcmV2aWV3JykuZmluZCgnLnByb2plY3QtcmV2aWV3JykuYWRkQ2xhc3MoJ3Nob3cnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLnJldmlldy1jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ3Nob3cnKS5wYXJlbnQoJy5wcm9qZWN0JykucmVtb3ZlQ2xhc3MoJ3Nob3ctcmV2aWV3Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGhhc2ggJiYgaGFzaCAhPT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2plY3RJRCA9IFwicHJvamVjdFwiK2NvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvamVjdElEID09PSBoYXNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjJytoYXNoKS5hZGRDbGFzcygnb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXJJbml0KHByb2plY3RJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSwgXHJcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjaG9vc2VDb29raWUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG5mdW5jdGlvbiBzbGlkZXJJbml0KHByb2plY3RFbGVtKXtcclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICBpZih0eXBlb2YgcHJvamVjdEVsZW0gPT09ICdzdHJpbmcnKXtcclxuICAgICAgICAgICAgJCgnIycrcHJvamVjdEVsZW0rJyAuc2xpZGVyJykuc2xpY2soe1xyXG4gICAgICAgICAgICAgICAgc2xpZGVzVG9TaG93OiAxLFxyXG4gICAgICAgICAgICAgICAgc2xpZGVzVG9TY3JvbGw6IDEsXHJcbiAgICAgICAgICAgICAgICBhY2Nlc3NpYmlsaXR5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYXV0b3BsYXk6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBhdXRvcGxheVNwZWVkOiAzMDAwLFxyXG4gICAgICAgICAgICAgICAgYWRhcHRpdmVIZWlnaHQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBhcnJvd3M6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBsYXp5TG9hZDogJ29uRGVtYW5kJyxcclxuICAgICAgICAgICAgICAgIHN3aXA6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBjc3NFYXNlOiAnZWFzZSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSwxMDApO1xyXG4gICAgXHJcbn1cclxuXHJcbiIsIlxyXG52YXIgdGVzdGltb25pYWwgPSAkKCcjZ29vZ2xlLXJldmlld3MnKTtcclxuXHJcbiQoZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgdXJsID0gJy4vYXNzZXRzL2pzb24vY29udGVudC5iaW4nO1xyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICBzY3JpcHRDaGFyc2V0OiBcInV0Zi04XCIsXHJcbiAgICAgICAgdHlwZTogXCJHRVRcIixcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgYWN0dWFsID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKGRhdGEpKSkpO1xyXG4gICAgICAgICAgICB2YXIgbG9jID0gZ2V0Q29va2llKCdsYW5nJyk7XHJcbiAgICAgICAgICAgIHZhciBwcm9qZWN0RGV0YWlsID0gYWN0dWFsW2xvY10ucGFnZXMucHJvamVjdHM7XHJcblxyXG4gICAgICAgICAgICAkLmVhY2gocHJvamVjdERldGFpbCwgZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmV2aWV3ID0gaXRlbS5yZXZpZXdcclxuICAgICAgICAgICAgICAgICAgICAsIGF1dGhvciA9IHJldmlldy5hdXRob3IgfHwgJydcclxuICAgICAgICAgICAgICAgICAgICAsIGRlc2MgPSByZXZpZXcuZGVzY3JpcHRpb24gfHwgJydcclxuICAgICAgICAgICAgICAgICAgICAsIHJldmlld0RhdGUgPSByZXZpZXcuZGF0ZSB8fCAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICwgaWRlbnRpZmllciA9IGF1dGhvci5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIi1cIikudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICAgICAgICAgICAgICwgc3RhckNvdW50ID0gcmV2aWV3LnN0YXJzIHx8ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXZpZXcgJiYgcmV2aWV3ICE9PSB1bmRlZmluZWQgJiYgZGVzYyAhPT0gJycgJiYgZGVzYyAhPT0gdW5kZWZpbmVkIHx8IHN0YXJDb3VudCAhPT0gJycgJiYgc3RhckNvdW50ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXN0aW1vbmlhbC5hZGRDbGFzcygnaGlkZGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlc3RpbW9uaWFsLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVzdGltb25pYWwuYXBwZW5kKCc8ZGl2IGNsYXNzPVwicmV2aWV3XCIgaWQ9XCInICsgaWRlbnRpZmllciArICdcIj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmV2aWV3LWF1dGhvclwiPicgKyBhdXRob3IgKyAnPC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJldmlldy1kYXRlXCI+JyArIHJldmlld0RhdGUgKyAnPC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJldmlldy1zdGFyc1wiPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGxcIj48L2k+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbFwiPjwvaT48aSBjbGFzcz1cImljb24tc3Rhci1mdWxsXCI+PC9pPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGxcIj48L2k+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbCBmaWZ0aFwiPjwvaT48L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmV2aWV3LXRleHRcIj4nICsgcmV2aWV3LmRlc2NyaXB0aW9uICsgJzwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIDwvZGl2PicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJDb3VudCA9PT0gNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJldmlldy1zdGFycycpLmZpbmQoJy5maWZ0aCcpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV2aWV3U2xpZGVyKCk7XHJcbiAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuXHJcblxyXG5mdW5jdGlvbiByZXZpZXdTbGlkZXIoKXtcclxuICAgIHRlc3RpbW9uaWFsLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuICAgIHRlc3RpbW9uaWFsLm5vdCgnLnNsaWNrLWluaXRpYWxpemVkJykuc2xpY2soe1xyXG4gICAgICAgIHNsaWRlc1RvU2hvdzogMSxcclxuICAgICAgICBzbGlkZXNUb1Njcm9sbDogMSxcclxuICAgICAgICBhdXRvcGxheTogdHJ1ZSxcclxuICAgICAgICBmYWRlOiB0cnVlLFxyXG4gICAgICAgIGluZmluaXRlOiB0cnVlLFxyXG4gICAgICAgIGF1dG9wbGF5U3BlZWQ6IDgwMDAsXHJcbiAgICAgICAgYXJyb3dzOiB0cnVlXHJcbiAgICB9KTtcclxufVxyXG4iXX0=
