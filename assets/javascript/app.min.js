var isHomePage = $('body.homepage');
if (isHomePage){
    $.fn.isInViewport = function() {
        var that = $(this);
        if (that !== 'undefined' && that.length) {
            var elementTop = $(this).offset().top;
            var elementBottom = elementTop + $(this).outerHeight();
            var viewportTop = $(window).scrollTop();
            var viewportBottom = viewportTop + $(window).height();
            return elementBottom > viewportTop && elementTop < viewportBottom;
        }
    };
}

var aboutAnimationHasRan = false;
var aboutUsAnimationHasRan = false;
var valuesAnimationHasRan = false;
var headerAnimationHasRan = false;
var brandsAnimationHasRan = false;
var headerElem = $('#header');
var aboutElem = $('#about');
var brandsElem = $('.brandlist');
var aboutUsElem = $('#aboutUs');
var valuesElem = $('#values');


$(function(){
    if (isHomePage){
        fireAnimations();
        $(window).on('resize scroll', function() {
            fireAnimations();
        });
    }
});

function fireAnimations(){
    if(isHomePage && headerElem.length > 0){
        if(headerElem.isInViewport()){
            var logo = $('#header .logo');
            var caption = $('#header h1');
            var playBtn = $('#header .icon-play');
            if (!headerAnimationHasRan) {
                TweenMax.fromTo(logo, .5, {css: {y: "-30", opacity: 0}}, {css:{y:"0", opacity: "1"}});
                TweenMax.fromTo(caption, .5, {css: {y: "-30", opacity: 0}}, {css:{y:"0", opacity: "1"}, delay: .3});
                TweenMax.fromTo(playBtn, .5, {opacity: 0, scale:1.5, ease:Bounce.ease}, {opacity: 1, scale:1});
                headerAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && headerElem.length > 0){
        if(aboutElem.isInViewport()){
            var leftSideElem = $('#about > .left-container');
            var rightSideElem = $('#about > .right-container');
            if (!aboutAnimationHasRan) {
                TweenMax.fromTo(leftSideElem, 1, {css: {x: "-100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1});
                TweenMax.fromTo(rightSideElem, 1, {css: {x: "100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1});

                aboutAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && aboutUsElem.length > 0){
        if(aboutUsElem.isInViewport()){
            var emplo = $('.employee-wrapper');
            if (!aboutUsAnimationHasRan) {
                TweenMax.staggerFromTo(emplo, 1, {css: {x: "-100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1}, 0.5);
                aboutUsAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && brandsElem.length > 0){
        if(brandsElem.isInViewport()){
            var brand = brandsElem.find('li');
            if (!brandsAnimationHasRan) {
                TweenMax.staggerFromTo(brand, .5, {css: {x: "-40", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: .2}, 0.2);
                brandsAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && valuesElem.length > 0){
        if(valuesElem.isInViewport()){
            var valueItem = $('.valueItem');
            if (!valuesAnimationHasRan) {

                $.each(valueItem, function(){
                    var textElem = $(this).find('strong');
                    var randomNum = (Math.random() * (0.5 - 2.9) + 2.9).toFixed(2);
                    TweenMax.fromTo(textElem, 1, {css: {x: "-10", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: randomNum});
                });

                valuesAnimationHasRan = true;
            }
        }
    }

    if(isHomePage && aboutUsElem.length > 0){
        if(aboutUsElem.isInViewport()){
            var employee = $('.employee-wrapper');
            if (!aboutUsAnimationHasRan) {
                TweenMax.staggerFromTo(employee, 1, {css: {x: "-100", opacity: 0}}, {css:{x:"0", opacity: "1"}, delay: 1}, 0.5);
                aboutUsAnimationHasRan = true;
            }
        }
    }
}




$(function () {
    //********* Const
    var lastScrollTop = 0
        , hasScrolled = false
        , headerElem = $('#header')
        , isHomePage = $('body.homepage')
        , viewPortHeight = $(window).height()
        , viewPortWidth = $(window).width()
        , animationIncrements = 950
        , step = 0
        , scroll = 0
        , hasSnapped = false
        , methodItem = $('.method-item')
        , methodContent = $('.fadeIn')
        , isMobile = window.orientation > -1 && screen.width <= 640
        , is_iPad = navigator.userAgent.match(/iPad/i) != null
        , placeholder = $('body').find("[data-content='content-method-hoverLabel']");

    //********* Event Handlers

    $(window).on('mousewheel DOMMouseScroll touchmove', function() {
        hasScrolled = true;
    });

    $(window).on('resize', function(){
        viewPortHeight = $(this).height();
        viewPortWidth = $(this).width();
        animationIncrements = $(window).height() / 100 * 20;
    });

    if(isHomePage !== undefined && isHomePage.length > 0){
        var methodContainer = $('#method')
            , methodScrollContainer = $('.method-scroll-wrapper')
            , methodContainerHeight = methodContainer.height()
            , methodContainerOffset = methodContainer.offset().top
            , CaseStudyContainer = $('#case-studies')
            , CaseStudyContainerOffset = ~~CaseStudyContainer.offset().top
            , aboutContainer = $('#about')
            , preAboutContainer = $('#preabout')
            , preAboutContainerOffset = preAboutContainer.offset().top
            , toggleClassName = 'active'
            , visibleClassName = 'show';

        if(isMobile || is_iPad) {
            CaseStudyContainer.addClass(visibleClassName);
            methodContent.addClass(visibleClassName);
            aboutContainer.addClass(visibleClassName);
        }

        $(methodItem).on('mouseenter', function(){
            var item = $(this).attr('data-item');
            $(this).addClass('active');
            $('.diagram-logo').addClass('hidden');
            if(placeholder.length > 0){
                placeholder.addClass('hidden');
            }
            $('.method-desc.'+ item).addClass('active');
            $('#diagram').addClass(item);
        }).on('mouseleave',function(){
            var item = $(this).attr('data-item');
            $(this).removeClass('active');
            $('.diagram-logo').removeClass('hidden');
            if(placeholder.length > 0){
                placeholder.removeClass('hidden');
            }
            $('.method-desc.'+ item).removeClass('active');
            $('#diagram').removeClass(item);
        });

        $('.close-btn').on('click', function(){
            $('body').toggleClass('isPlaying');
            headerElem.removeClass('play');
            headerElem.find('.video-container').removeClass('play');
            $('.youtube-video-embed iframe').attr('id', '').attr('src', '');
        });

        $('.play-video-wrapper').on('click', function(){
            $('body').toggleClass('isPlaying');
            headerElem.addClass('play');
            headerElem.find('.video-container').addClass('play');
            var url = './assets/json/content.json';
            $.getJSON(url, function(data) {
                var loc = getCookie('lang');
                var locData = data[loc];
                var homepage = locData.pages.homepage;
                var header = homepage.header.content;

                $('.youtube-video-embed iframe').attr('id', header.youtubeURL).attr('src', 'https://www.youtube.com/embed/' + header.youtubeURL + '?autoplay=0&rel=0&fs=1&enablejsapi=1')
            });
        });

        $(window).on('scroll', function(){
            scroll = ~~$(this).scrollTop();

            if(viewPortHeight < 1100){
                animationIncrements = 1050;
            }

            methodItem.removeClass(toggleClassName);

            getDirection(scroll, lastScrollTop, function(direction, scroll){
                lastScrollTop = scroll;

                if(scroll && hasScrolled && !isMobile && viewPortWidth > 1200 && !is_iPad) {
                    if(direction === 'down') {
                        //on
                        if (scroll >= methodContainerOffset) {
                            if (!hasSnapped) {
                                methodContent.removeClass(visibleClassName);
                                //methodItem.removeClass('active');
                               // methodScrollContainer.addClass('fixed');
                                methodScrollContainer.addClass(visibleClassName);
                                handleMethodScroll(5);
                            }
                            //hasSnapped = true;
                        }

                        if (scroll >= methodContainerOffset + methodContainerHeight) {
                            CaseStudyContainer.addClass(visibleClassName);
                            methodContent.removeClass(visibleClassName);
                            //methodItem.removeClass('active');
                            //methodScrollContainer.removeClass('fixed');
                            methodScrollContainer.removeClass(visibleClassName);
                            //hasSnapped = false;
                        }

                        if (scroll >= preAboutContainerOffset) {
                            aboutContainer.addClass(visibleClassName);
                        }
                    } else {
                        CaseStudyContainer.addClass(visibleClassName);
                        methodContent.addClass(visibleClassName);
                        aboutContainer.addClass(visibleClassName);
                    }

                    if(direction === 'up') {
                        //on
                        if (scroll < CaseStudyContainerOffset - animationIncrements) {
                            if (!hasSnapped) {
                                //methodItem.removeClass(toggleClassName);
                                //methodScrollContainer.addClass('fixed');
                                methodScrollContainer.addClass(visibleClassName);
                                handleMethodScroll(5);
                            }
                            //hasSnapped = true;
                        }

                        if (scroll <= methodContainerOffset - 100 ) {
                            methodContent.removeClass(toggleClassName);
                            //methodItem.removeClass('active');
                            //methodScrollContainer.removeClass('fixed');
                            //hasSnapped = false;
                        }
                    }

                    if(hasSnapped) {
                        if (scroll > methodContainerOffset && scroll < methodContainerOffset + animationIncrements) {
                            step = 1;
                        } else if (scroll > methodContainerOffset + animationIncrements && scroll < methodContainerOffset + animationIncrements * 2) {
                            step = 2;
                        } else if (scroll > methodContainerOffset + animationIncrements * 2 && scroll < methodContainerOffset + animationIncrements * 3) {
                            step = 3;
                        } else if (scroll > methodContainerOffset + animationIncrements * 3 && scroll < methodContainerOffset + animationIncrements * 4) {
                            step = 4;
                        } else if (scroll > methodContainerOffset + animationIncrements * 4 && scroll < CaseStudyContainerOffset) {
                            step = 5;
                        }

                        handleMethodScroll(step);
                    }

                }
            });
        });
    }
});

function getDirection (scroll, lastScrollTop, callback){
    var direction = null
        , delta = 5;

    if(Math.abs(lastScrollTop - scroll) <= delta) {
        return;
    }

    if (scroll > lastScrollTop){
        direction = 'down';
    } else {
        direction = 'up';
    }
    callback(direction, scroll);
}

// This function showed the appropriate bubble
// currently not used as the scrolling function is disabled
function handleMethodScroll(step){
    var toggleClassName = 'method'
        , fadeInElemClass = '.fadeIn'
        , methodElem = '.method-item'
        , introElemClass = '.intro'
        , designElemClass = '.design'
        , tuningElemClass = '.tuning'
        , constructionElemClass = '.construction'
        , evalElemClass = '.eval';

    $(fadeInElemClass).removeClass(toggleClassName);
    $(methodElem).removeClass(toggleClassName);

    if(step === 1){
        $(fadeInElemClass+introElemClass).addClass(toggleClassName);
        $(methodElem+introElemClass).addClass(toggleClassName);
    } else if(step === 2) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(fadeInElemClass+designElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
    } else if(step === 3) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
        $(fadeInElemClass+tuningElemClass).addClass(toggleClassName);
        $(methodElem+tuningElemClass).addClass(toggleClassName);
    } else if(step === 4) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
        $(methodElem+tuningElemClass).addClass(toggleClassName);
        $(fadeInElemClass+constructionElemClass).addClass(toggleClassName);
        $(methodElem+constructionElemClass).addClass(toggleClassName);
    } else if(step === 5) {
        $(methodElem+introElemClass).addClass(toggleClassName);
        $(methodElem+designElemClass).addClass(toggleClassName);
        $(methodElem+tuningElemClass).addClass(toggleClassName);
        $(methodElem+constructionElemClass).addClass(toggleClassName);
        $(fadeInElemClass+evalElemClass).addClass(toggleClassName);
        $(methodElem+evalElemClass).addClass(toggleClassName);
    }
}
chooseCookie();

function setCookie(name,value,days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
}
function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}
function eraseCookie(name) {
    document.cookie = name+'=; Max-Age=-99999999;';
}

function chooseCookie(){
    var userLang = navigator.language || navigator.userLanguage;
    var activeCookie = getCookie('lang');
    var queryParam = getParameterByName('lang');
    if(activeCookie === undefined || activeCookie === null || activeCookie === ''){
        if(userLang.match(/de/g)){
            setCookie('lang','en',7);
        } else if (userLang.match(/en/g)){
            setCookie('lang','en',7);
        } else if (userLang.match(/nl/g)) {
            setCookie('lang','nl',7);
        } else {
            setCookie('lang','nl',7);
        }

        setTimeout(function(){
            window.location.reload();
        },20);
    } else {
        $('body').addClass(activeCookie);
    }

    if (queryParam !== undefined && queryParam === 'de'){
        setCookie('lang','de',7);
    }

    setTimeout(function(){
        $('#nav .active-loc').html(getCookie('lang'));
    },200);
    
}

function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

$(function () {
    var navIsOpen = false
        , mobileNav = $('#nav ul')
        , hamburgerElem = $('.hamburger')
        , viewPortOffset = $(window).scrollTop();

    $('#nav li a').on('click', function(e){
        e.preventDefault();
        var navLink = $(this).attr('href');
        if(navLink.indexOf('.') !== -1) {
            window.location.href = navLink;
        } else if ($(this).hasClass('loc')){
            eraseCookie('lang');
            setCookie('lang',navLink,7);
            setTimeout(function(){
                window.location.reload();
            },20);
        } else if(navLink.indexOf('#') !== -1) {
            var linkPos = $(navLink).offset().top;
            if (navLink === '#footer') {
                linkPos = $('#contact-info').offset().top;
            } else if (navLink === '#comparison') {
                linkPos = $('#comparison-wrapper').offset().top;
            }
            $("html, body").animate({ scrollTop: linkPos });
        }

        if (navIsOpen) {
            hamburgerElem.removeClass("is-active");
            mobileNav.removeClass("open");
            navIsOpen = false;
        }
    });

    hamburgerElem.click(function(){
        $(this).toggleClass("is-active");
        mobileNav.toggleClass("open");
        navIsOpen = true;
    });

    $(window).on('scroll', function(){
        var scroll = ~~$(this).scrollTop();
        fixNav(scroll);
    });

    $('.contact-btn').on('click', function(){
        var footerOffset = $('footer').offset().top;
        $("html, body").animate({ scrollTop: footerOffset });
    });

    fixNav(viewPortOffset);
});


function fixNav(scroll){
    var nav = $("#nav");
    if (scroll >= 500) {
        nav.addClass("fixed");
    } else {
        nav.removeClass("fixed");
    }
}
$(function(){
    // Load projects
    if ($('body').hasClass('homepage')){
        var url = './assets/json/content.bin';
        $.ajax({
            url: url,
            scriptCharset: "utf-8",
            type: "GET",
            success: function (data) {
                var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))));
                var loc = getCookie('lang');
                var locData = actual[loc];
                var homepage = locData.pages.homepage;
                var comparison = homepage.content.comparison;
                var comparisonWrapper = $("#comparison");
                var comparisonItem = comparison.comparisons || '';
                $.each(comparisonItem, function (index, item) {
                    comparisonWrapper.append('<div class="item"><img data-content="content-comparison-before" src="' + item.before + '" class="before" alt>\n' +
                        '<div data-content="content-comparison-after" class="after" style="background-image: url(' + item.after + ')"></div></div>');
                });

                setTimeout(function (){
                    comparisonWrapper.not('.slick-initialized').slick({
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        autoplay: true,
                        autoplaySpeed: 3000,
                        nextArrow: '.icon-arrow-right',
                        prevArrow: '.icon-arrow-left',
                        swipeToSlide: false
                    });
                    comparisonWrapper.on('setPosition', function(event, slick, currentSlide, nextSlide){
                        var inkbox = comparisonWrapper.find('.slick-active');
                        if (inkbox) {
                            inkbox.on("mousemove",trackLocation);
                            inkbox.on("touchstart",trackLocation);
                            inkbox.on("touchmove",trackLocation);
                        }
                    });
                },200);
                
            }
        });
    }
});

function trackLocation(e){
    var colorbox = $('.slick-active .after')
        , fillerImage = $('.slick-active .before')
        , rect = fillerImage[0].getBoundingClientRect()
        , fillerImageOw = fillerImage.outerWidth()
        , position = ((e.pageX - rect.left) / fillerImageOw)*100;

    if(position <= 100){
        colorbox.css('width', position+"%");
    }
}


$(function(){
    var url = './assets/json/content.bin';
    var $body = $("body");

    $.ajax({
        url: url,
        scriptCharset: "utf-8",
        type: "GET",
        success: function (data) {
            var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))));
            var loc = getCookie('lang');
            var locData = actual[loc];
            var nav = locData.nav.labels;
            var homepage = locData.pages.homepage;
            var header = homepage.header.content;
            var intro = homepage.content.intro;
            var brands = intro.images;
            var about = homepage.content.about;
            var aboutUs = homepage.content.aboutUs;
            var values = homepage.content.values;
            var comparison = homepage.content.comparison;
            var method = homepage.content.method;
            var model = homepage.content.model;
            var projects = homepage.content.projects;
            var footer = homepage.footer;

            if (locData) {
                $body.removeClass('loading');
            }

            if (loc === undefined) {
                chooseCookie();
            }

            if(nav) {
                var navItem = $('#nav > ul > li ');
                navItem.find('a[href="#preabout"]').html(nav.about);
                navItem.find('a[href="index.html#preabout"]').html(nav.about);
                navItem.find('a[href="#method"]').html(nav.method);
                navItem.find('a[href="index.html#method"]').html(nav.method);
                navItem.find('a[href="#values"]').html(nav.values);
                navItem.find('a[href="index.html#values"]').html(nav.values);
                navItem.find('a[href="#aboutUs"]').html(nav.aboutUs);
                navItem.find('a[href="index.html#aboutUs"]').html(nav.aboutUs);
                navItem.find('a[href="projects.html"]').html(nav.projects);
                navItem.find('a[href="#footer"]').html(nav.contact);
                navItem.find('a[href="#footer"]').html(nav.contact);
                navItem.find('a[href="#mission"]').html(nav.mission);
                navItem.find('a[href="index.html#mission"]').html(nav.mission);
                navItem.find('a[href="#model"]').html(nav.model);
                navItem.find('a[href="index.html#model"]').html(nav.model);
                navItem.find('a[href="#foundation"]').html(nav.foundation);
                navItem.find('a[href="index.html#foundation"]').html(nav.foundation);
                navItem.find('a[href="#comparison"]').html(nav.comparison);
                navItem.find('a[href="index.html#comparison"]').html(nav.comparison);
            }

            if (header) {
                $('.background-video').css({'backgroundImage': header.backgroundImageSrc});
                $('.youtube-video-embed iframe').attr('id', header.youtubeURL).attr('src', 'https://www.youtube.com/embed/' + header.youtubeURL + '?autoplay=0&rel=0&fs=1&enablejsapi=1')
                $('video source#mp4').attr('src', header.backgroundVideoMp4Src);
                $('video source#webm').attr('src', header.backgroundVideoWebMSrc);
                $body.find("[data-content='header-content-title']").html(header.header);
            }

            if (intro) {
                $body.find("[data-content='content-intro-title']").html(intro.header);
                $body.find("[data-content='content-intro-desc']").html(intro.description);

                if($('.brandlist').length > 0){
                    $.each(brands, function (index, brand) {
                        if(brand.src){
                            $body.find('.brandlist').append('<li><img src="'+brand.src+'" alt="'+brand.alt+'" /></li>');
                        }
                    });
                }
            }

            if (about) {
                $body.find("[data-content='content-about-row1-title']").html(about.row1.header);
                $body.find("[data-content='content-about-row1-image']").css({'backgroundImage': about.row1.image.src});
                $body.find("[data-content='content-about-row1-desc']").html(about.row1.description);

                $body.find("[data-content='content-about-row2-title']").html(about.row2.header);
                $body.find("[data-content='content-about-row2-image']").css({'backgroundImage': about.row2.image.src});
                $body.find("[data-content='content-about-row2-desc']").html(about.row2.description);
            }

            if (aboutUs) {
                $body.find("[data-content='content-aboutUs-title']").html(aboutUs.header);
                $body.find("[data-content='content-aboutUs-description']").html(aboutUs.description);

                $body.find("[data-content='content-employee-niek-image']").attr('src', aboutUs.employees.niek.image.src).attr('alt', aboutUs.employees.niek.image.alt);
                $body.find("[data-content='content-employee-niek-title']").html(aboutUs.employees.niek.header);
                $body.find("[data-content='content-employee-niek-desc']").html(aboutUs.employees.niek.description);

                $body.find("[data-content='content-employee-jan-image']").attr('src', aboutUs.employees.jan.image.src).attr('alt', aboutUs.employees.jan.image.alt);
                $body.find("[data-content='content-employee-jan-title']").html(aboutUs.employees.jan.header);
                $body.find("[data-content='content-employee-jan-desc']").html(aboutUs.employees.jan.description);
            }

            if (values) {
                $body.find("[data-content='content-values-image']").css({'backgroundImage': values.image.src});
                $body.find("[data-content='content-values-title']").html(values.header);
                $body.find("[data-content='content-values-desc']").html(values.description);

                $body.find("[data-content='content-value1']").html(values.values.value1);
                $body.find("[data-content='content-value2']").html(values.values.value2);
                $body.find("[data-content='content-value3']").html(values.values.value3);
                $body.find("[data-content='content-value4']").html(values.values.value4);
                $body.find("[data-content='content-value5']").html(values.values.value5);
                $body.find("[data-content='content-value6']").html(values.values.value6);
            }

            if (method) {
                $body.find("[data-content='content-method-title']").html(method.header);
                $body.find("[data-content='content-method-desc']").html(method.description);
                $body.find("[data-content='content-method-hoverLabel']").html(method.hoverLabel);

                $body.find("[data-content='content-method-intro-title']").html(method.methods.intro.header);
                $body.find("[data-content='content-method-intro-desc']").html(method.methods.intro.description);

                $body.find("[data-content='content-method-design-title']").html(method.methods.design.header);
                $body.find("[data-content='content-method-design-desc']").html(method.methods.design.description);

                $body.find("[data-content='content-method-tuning-title']").html(method.methods.tuning.header);
                $body.find("[data-content='content-method-tuning-desc']").html(method.methods.tuning.description);

                $body.find("[data-content='content-method-construction-title']").html(method.methods.construction.header);
                $body.find("[data-content='content-method-construction-desc']").html(method.methods.construction.description);

                $body.find("[data-content='content-method-eval-title']").html(method.methods.eval.header);
                $body.find("[data-content='content-method-eval-desc']").html(method.methods.eval.description);
            }

            if (model) {
                $body.find("[data-content='content-model-title']").html(model.header);
                $body.find("[data-content='content-model-image']").css({'backgroundImage': model.image.src});
                $body.find("[data-content='content-model-desc']").html(model.description);
            }

            if (projects) {
                $body.find("[data-content='content-projects-title']").html(projects.header);
                $body.find("[data-content='content-projects-desc']").html(projects.description);
                $body.find("[data-content='content-projects-button']").html(projects.button.label);

                $body.find("[data-content='content-project1-image']").attr('src', projects.project1.image.src).attr('alt', projects.project1.image.alt);
                $body.find("[data-content='content-project1-title']").html(projects.project1.header);
                $body.find("[data-content='content-project1-btn']").html(projects.project1.button);

                $body.find("[data-content='content-project2-image']").attr('src', projects.project2.image.src).attr('alt', projects.project2.image.alt);
                $body.find("[data-content='content-project2-title']").html(projects.project2.header);
                $body.find("[data-content='content-project2-btn']").html(projects.project2.button);
            }

            if(comparison){
                $body.find("[data-content='content-projects-comparison-title']").html(comparison.header);
                $body.find("[data-content='content-projects-comparison-desc']").html(comparison.description);
            }

            if (footer) {
                $body.find("[data-content='footer-testimonials-title']").html(footer.testimonials.header);
                $body.find("[data-content='footer-contacts-header']").html(footer.contacts.header);

                $body.find("[data-content='footer-contacts-jan-title']").html(footer.contacts.jan.header);
                $body.find("[data-content='footer-contacts-jan-email']").attr('href', footer.contacts.jan.links.email.src).html(footer.contacts.jan.links.email.header);
                $body.find("[data-content='footer-contacts-linkedin-jan']").attr('href', footer.contacts.jan.links.linkedin.src);
                $body.find("[data-content='footer-contacts-linkedin-jan-title']").html( footer.contacts.jan.links.linkedin.header+' ');
                $body.find("[data-content='footer-contacts-call-jan-phone']").attr('href', footer.contacts.jan.phone);

                $body.find("[data-content='footer-contacts-niek-title']").html(footer.contacts.niek.header);
                $body.find("[data-content='footer-contacts-niek-email']").attr('href', footer.contacts.niek.links.email.src).html(footer.contacts.niek.links.email.header);
                $body.find("[data-content='footer-contacts-linkedin-niek']").attr('href', footer.contacts.niek.links.linkedin.src);
                $body.find("[data-content='footer-contacts-linkedin-niek-title']").html(footer.contacts.niek.links.linkedin.header+' ');
                $body.find("[data-content='footer-contacts-call-niek-phone']").attr('href', footer.contacts.niek.phone);

                $body.find("[data-content='footer-contacts-phone-header']").html(footer.phone.header);
                $body.find("[data-content='footer-contacts-visit-header']").html(footer.visit.header);

                $body.find("[data-content='footer-contacts-visit-desc']").html(footer.visit.description);
                $body.find("[data-content='footer-copyright-desc']").html(footer.copyright.description);
            }
        }
    });
});

// Google maps setup

var map;
google.maps.event.addDomListener(window, 'load', googleMapsInit);

function googleMapsInit() {
    var myLatlng = new google.maps.LatLng(51.372027, 6.160478);
    var mapOptions = {
        zoom: 15,
        center: myLatlng,
        scrollwheel: false,
        navigationControl: false,
        mapTypeControl: false,
        scaleControl: false,
        disableDefaultUI: true,
        styles: [{"featureType":"landscape","stylers":[{"visibility":"simplified"},{"color":"#2b3f57"},{"weight":0.1}]},{"featureType":"administrative","stylers":[{"visibility":"on"},{"hue":"#ff0000"},{"weight":0.4},{"color":"#ffffff"}]},{"featureType":"road.highway","elementType":"labels.text","stylers":[{"weight":1.3},{"color":"#FFFFFF"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"color":"#f55f77"},{"weight":3}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#f55f77"},{"weight":1.1}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#f55f77"},{"weight":0.4}]},{},{"featureType":"road.highway","elementType":"labels","stylers":[{"weight":0.8},{"color":"#ffffff"},{"visibility":"on"}]},{"featureType":"road.local","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"road.arterial","elementType":"labels","stylers":[{"color":"#ffffff"},{"weight":0.7}]},{"featureType":"poi","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi","stylers":[{"color":"#6c5b7b"}]},{"featureType":"water","stylers":[{"color":"#f3b191"}]},{"featureType":"transit.line","stylers":[{"visibility":"on"}]}]
    };

    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

    var marker = new google.maps.Marker({
        position: myLatlng,
        icon: '//expo-mate.github.io/assets/images/marker.png',
        map: map
    });

    var infowindow = new google.maps.InfoWindow({
        content: $('.contact-details-map').html()
    });


    if($(window).width() > 450){
        map.panBy(200, -150);
    }

    google.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map,marker);
    });
}
$(function(){
    // Load projects
    if ($('body').hasClass('projects')){
        var url = './assets/json/content.bin';
        var hash = window.location.hash;

        $.ajax({
            url: url,
            scriptCharset: "utf-8",
            type: "GET",
            success: function (data) {
                var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))))
                , loc = getCookie('lang')
                , homeproject = actual[loc].pages.homepage.content.projects
                , reviewLink = homeproject.reviewLink || ''
                , projectDetail = actual[loc].pages.projects
                , section = $('#projects .projects-wrapper');

                if (loc === undefined) {
                    chooseCookie();
                }

                $.each(projectDetail, function (index, item) {
                    var imageArray = []
                        , imageContent = item.images
                        , count = parseInt(index) + 1
                        , review = item.review
                        , author = review.author || ''
                        , desc = review.description || ''
                        , reviewDate = review.date || ''
                        , identifier = author.replace(/[^A-Z0-9]+/ig, "-").toLowerCase()
                        , starCount = review.stars || '';

                    if (imageContent && imageContent.length > 0) {
                        $.each(imageContent, function (index, item) {
                            if(item){
                                imageArray.push('<div class="project-image" style="background-image: url('+item.src+')"></div>')
                            }
                        });
                    }

                    section.append('<div class="project" id="project'+count+'">\n' +
                                    '	<div class="project-close"></div>\n' +
                                    '	<div class="project-wrapper">\n' +
                                    '		<div class="project-images">\n' +
                                    '			<div class="slider">'+imageArray.join("")+'</div>\n' +
                                    '		</div>\n' +
                                    '		<div class="project-desc-wrapper">\n' +
                                    '			<div class="project-desc-content">\n' +
                                    '				<div class="project-header">\n' +
                                    '					<h2 class="project-title">'+item.header+'</h2>\n' +
                                    '					<div class="project-sub-title">'+item.subTitle+'</div>\n' +
                                    '				</div>\n' +
                                    '				<div class="project-desc"> \n' +
                                    '				   <span>'+item.description+'</span> \n' +
                                    '				   <a class="read-review" data-count="'+count+'">'+reviewLink+' '+item.header+'</a> \n' +
                                    '			   </div>\n' +
                                    '			</div>\n' +
                                    '		</div> \n' +
                                    '	</div>\n' +
                                    '	<div class="project-review">\n' +
                                    '		<div class="review-close"></div> \n' +
                                    '		<div class="review" id="'+identifier+'">\n' +
                                    '			<div class="review-author">'+author+'</div>\n' +
                                    '			<div class="review-date">'+reviewDate+'</div>\n' +
                                    '           <div class="review-stars"><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full fifth"></i></div>\n' +
                                    '			<div class="review-text">'+desc+'</div>\n' +
                                    '		</div>\n' +
                                    '	</div>\n' +
                                    '</div>');

                    if (starCount === 4) {
                        $('.review-stars').find('.fifth').remove();
                    }

                    if (review === undefined || desc === '' || desc === undefined){
                        $('#project'+count).find('.read-review').addClass('hidden');
                    }

                    $('.project-images').on('click', function(){
                        if(!$('body').hasClass('open')) {
                            $(this).parent().parent('.project').addClass('open');
                            var parentID = $(this).parent().parent('.project').attr('id');
                            document.location.href = "#" + parentID;
                            $('body').addClass('open');
                            sliderInit(parentID);
                        }
                    });

                    $('.project-title').on('click', function(){
                        if(!$('body').hasClass('open')){
                            var parentElem = $(this).parent().parent().parent().parent().parent();
                            parentElem.addClass('open');
                            var parentID = parentElem.attr('id');
                            document.location.href="#"+parentID;
                            $('body').addClass('open');
                            sliderInit(parentID);
                        }
                    });

                    $('.project-close').on('click', function() {
                        $('body').removeClass('open');
                        $(this).parent('.project').removeClass('open');
                        var parentID = $(this).parent('.project').attr('id');
                        $('#'+parentID+' .slider').slick("unslick");
                        window.location.hash="";
                        document.getElementById(parentID).scrollIntoView(true);
                    });

                    $('.read-review').on('click', function(e){
                        e.preventDefault();
                        var count = $(this).attr('data-count');
                        $("#project"+count).addClass('show-review').find('.project-review').addClass('show');
                    });

                    $('.review-close').on('click', function(){
                        $(this).parent().removeClass('show').parent('.project').removeClass('show-review');
                    });

                    if(hash && hash !== undefined){
                        hash = window.location.hash.substring(1);
                        var projectID = "project"+count;
                        if (projectID === hash) {
                            $('#'+hash).addClass('open');
                            $('body').addClass('open');
                            sliderInit(projectID);
                        }
                    }
                });
            }, 
            error: function (err) {
                chooseCookie();
            }
        });
    }
});


function sliderInit(projectElem){
    if(typeof projectElem === 'string'){
        $('#'+projectElem+' .slider').not('.slick-initialized').slick({
            slidesToShow: 1,
            slidesToScroll: 1,
            autoplay: true,
            autoplaySpeed: 8000,
            arrows: true
        });
    }
}



var testimonial = $('#google-reviews');

$(function() {
    var url = './assets/json/content.bin';
    $.ajax({
        url: url,
        scriptCharset: "utf-8",
        type: "GET",
        success: function (data) {
            var actual = JSON.parse(decodeURIComponent(escape(window.atob(data))));
            var loc = getCookie('lang');
            var projectDetail = actual[loc].pages.projects;

            $.each(projectDetail, function (index, item) {
                var review = item.review
                    , author = review.author || ''
                    , desc = review.description || ''
                    , reviewDate = review.date || ''
                    , identifier = author.replace(/[^A-Z0-9]+/ig, "-").toLowerCase()
                    , starCount = review.stars || '';

                if (review && review !== undefined && desc !== '' && desc !== undefined || starCount !== '' && starCount !== undefined) {
                    testimonial.addClass('hidden');
                    if (testimonial.length > 0) {
                        testimonial.append('<div class="review" id="' + identifier + '">\n' +
                            '               <div class="review-author">' + author + '</div>\n' +
                            '               <div class="review-date">' + reviewDate + '</div>\n' +
                            '               <div class="review-stars"><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full"></i><i class="icon-star-full fifth"></i></div>\n' +
                            '               <div class="review-text">' + review.description + '</div>\n' +
                            '            </div>');

                        if (starCount === 4) {
                            $('.review-stars').find('.fifth').remove();
                        }
                    }
                }
            });

            setTimeout(function () {
                reviewSlider();
            }, 1000);
        }
    });
});


function reviewSlider(){
    testimonial.removeClass('hidden');
    testimonial.not('.slick-initialized').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        autoplay: true,
        fade: true,
        infinite: true,
        autoplaySpeed: 8000,
        arrows: true
    });
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuaW1hdGlvbnMuanMiLCJib290c3RyYXAuanMiLCJjb29raWVzLmpzIiwiaGVhZGVyLmpzIiwiaW1hZ2VDb21wYXJpc29uLmpzIiwibG9jYWxlLmpzIiwibWFwc0luaXQuanMiLCJwcm9qZWN0LWJvb3RzdHJhcC5qcyIsInJldmlld3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBpc0hvbWVQYWdlID0gJCgnYm9keS5ob21lcGFnZScpO1xyXG5pZiAoaXNIb21lUGFnZSl7XHJcbiAgICAkLmZuLmlzSW5WaWV3cG9ydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciB0aGF0ID0gJCh0aGlzKTtcclxuICAgICAgICBpZiAodGhhdCAhPT0gJ3VuZGVmaW5lZCcgJiYgdGhhdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdmFyIGVsZW1lbnRUb3AgPSAkKHRoaXMpLm9mZnNldCgpLnRvcDtcclxuICAgICAgICAgICAgdmFyIGVsZW1lbnRCb3R0b20gPSBlbGVtZW50VG9wICsgJCh0aGlzKS5vdXRlckhlaWdodCgpO1xyXG4gICAgICAgICAgICB2YXIgdmlld3BvcnRUb3AgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XHJcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydEJvdHRvbSA9IHZpZXdwb3J0VG9wICsgJCh3aW5kb3cpLmhlaWdodCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudEJvdHRvbSA+IHZpZXdwb3J0VG9wICYmIGVsZW1lbnRUb3AgPCB2aWV3cG9ydEJvdHRvbTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XHJcblxyXG52YXIgYWJvdXRBbmltYXRpb25IYXNSYW4gPSBmYWxzZTtcclxudmFyIGFib3V0VXNBbmltYXRpb25IYXNSYW4gPSBmYWxzZTtcclxudmFyIHZhbHVlc0FuaW1hdGlvbkhhc1JhbiA9IGZhbHNlO1xyXG52YXIgaGVhZGVyQW5pbWF0aW9uSGFzUmFuID0gZmFsc2U7XHJcbnZhciBicmFuZHNBbmltYXRpb25IYXNSYW4gPSBmYWxzZTtcclxudmFyIGhlYWRlckVsZW0gPSAkKCcjaGVhZGVyJyk7XHJcbnZhciBhYm91dEVsZW0gPSAkKCcjYWJvdXQnKTtcclxudmFyIGJyYW5kc0VsZW0gPSAkKCcuYnJhbmRsaXN0Jyk7XHJcbnZhciBhYm91dFVzRWxlbSA9ICQoJyNhYm91dFVzJyk7XHJcbnZhciB2YWx1ZXNFbGVtID0gJCgnI3ZhbHVlcycpO1xyXG5cclxuXHJcbiQoZnVuY3Rpb24oKXtcclxuICAgIGlmIChpc0hvbWVQYWdlKXtcclxuICAgICAgICBmaXJlQW5pbWF0aW9ucygpO1xyXG4gICAgICAgICQod2luZG93KS5vbigncmVzaXplIHNjcm9sbCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBmaXJlQW5pbWF0aW9ucygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGZpcmVBbmltYXRpb25zKCl7XHJcbiAgICBpZihpc0hvbWVQYWdlICYmIGhlYWRlckVsZW0ubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgaWYoaGVhZGVyRWxlbS5pc0luVmlld3BvcnQoKSl7XHJcbiAgICAgICAgICAgIHZhciBsb2dvID0gJCgnI2hlYWRlciAubG9nbycpO1xyXG4gICAgICAgICAgICB2YXIgY2FwdGlvbiA9ICQoJyNoZWFkZXIgaDEnKTtcclxuICAgICAgICAgICAgdmFyIHBsYXlCdG4gPSAkKCcjaGVhZGVyIC5pY29uLXBsYXknKTtcclxuICAgICAgICAgICAgaWYgKCFoZWFkZXJBbmltYXRpb25IYXNSYW4pIHtcclxuICAgICAgICAgICAgICAgIFR3ZWVuTWF4LmZyb21Ubyhsb2dvLCAuNSwge2Nzczoge3k6IFwiLTMwXCIsIG9wYWNpdHk6IDB9fSwge2Nzczp7eTpcIjBcIiwgb3BhY2l0eTogXCIxXCJ9fSk7XHJcbiAgICAgICAgICAgICAgICBUd2Vlbk1heC5mcm9tVG8oY2FwdGlvbiwgLjUsIHtjc3M6IHt5OiBcIi0zMFwiLCBvcGFjaXR5OiAwfX0sIHtjc3M6e3k6XCIwXCIsIG9wYWNpdHk6IFwiMVwifSwgZGVsYXk6IC4zfSk7XHJcbiAgICAgICAgICAgICAgICBUd2Vlbk1heC5mcm9tVG8ocGxheUJ0biwgLjUsIHtvcGFjaXR5OiAwLCBzY2FsZToxLjUsIGVhc2U6Qm91bmNlLmVhc2V9LCB7b3BhY2l0eTogMSwgc2NhbGU6MX0pO1xyXG4gICAgICAgICAgICAgICAgaGVhZGVyQW5pbWF0aW9uSGFzUmFuID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZihpc0hvbWVQYWdlICYmIGhlYWRlckVsZW0ubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgaWYoYWJvdXRFbGVtLmlzSW5WaWV3cG9ydCgpKXtcclxuICAgICAgICAgICAgdmFyIGxlZnRTaWRlRWxlbSA9ICQoJyNhYm91dCA+IC5sZWZ0LWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICB2YXIgcmlnaHRTaWRlRWxlbSA9ICQoJyNhYm91dCA+IC5yaWdodC1jb250YWluZXInKTtcclxuICAgICAgICAgICAgaWYgKCFhYm91dEFuaW1hdGlvbkhhc1Jhbikge1xyXG4gICAgICAgICAgICAgICAgVHdlZW5NYXguZnJvbVRvKGxlZnRTaWRlRWxlbSwgMSwge2Nzczoge3g6IFwiLTEwMFwiLCBvcGFjaXR5OiAwfX0sIHtjc3M6e3g6XCIwXCIsIG9wYWNpdHk6IFwiMVwifSwgZGVsYXk6IDF9KTtcclxuICAgICAgICAgICAgICAgIFR3ZWVuTWF4LmZyb21UbyhyaWdodFNpZGVFbGVtLCAxLCB7Y3NzOiB7eDogXCIxMDBcIiwgb3BhY2l0eTogMH19LCB7Y3NzOnt4OlwiMFwiLCBvcGFjaXR5OiBcIjFcIn0sIGRlbGF5OiAxfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgYWJvdXRBbmltYXRpb25IYXNSYW4gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmKGlzSG9tZVBhZ2UgJiYgYWJvdXRVc0VsZW0ubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgaWYoYWJvdXRVc0VsZW0uaXNJblZpZXdwb3J0KCkpe1xyXG4gICAgICAgICAgICB2YXIgZW1wbG8gPSAkKCcuZW1wbG95ZWUtd3JhcHBlcicpO1xyXG4gICAgICAgICAgICBpZiAoIWFib3V0VXNBbmltYXRpb25IYXNSYW4pIHtcclxuICAgICAgICAgICAgICAgIFR3ZWVuTWF4LnN0YWdnZXJGcm9tVG8oZW1wbG8sIDEsIHtjc3M6IHt4OiBcIi0xMDBcIiwgb3BhY2l0eTogMH19LCB7Y3NzOnt4OlwiMFwiLCBvcGFjaXR5OiBcIjFcIn0sIGRlbGF5OiAxfSwgMC41KTtcclxuICAgICAgICAgICAgICAgIGFib3V0VXNBbmltYXRpb25IYXNSYW4gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmKGlzSG9tZVBhZ2UgJiYgYnJhbmRzRWxlbS5sZW5ndGggPiAwKXtcclxuICAgICAgICBpZihicmFuZHNFbGVtLmlzSW5WaWV3cG9ydCgpKXtcclxuICAgICAgICAgICAgdmFyIGJyYW5kID0gYnJhbmRzRWxlbS5maW5kKCdsaScpO1xyXG4gICAgICAgICAgICBpZiAoIWJyYW5kc0FuaW1hdGlvbkhhc1Jhbikge1xyXG4gICAgICAgICAgICAgICAgVHdlZW5NYXguc3RhZ2dlckZyb21UbyhicmFuZCwgLjUsIHtjc3M6IHt4OiBcIi00MFwiLCBvcGFjaXR5OiAwfX0sIHtjc3M6e3g6XCIwXCIsIG9wYWNpdHk6IFwiMVwifSwgZGVsYXk6IC4yfSwgMC4yKTtcclxuICAgICAgICAgICAgICAgIGJyYW5kc0FuaW1hdGlvbkhhc1JhbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaXNIb21lUGFnZSAmJiB2YWx1ZXNFbGVtLmxlbmd0aCA+IDApe1xyXG4gICAgICAgIGlmKHZhbHVlc0VsZW0uaXNJblZpZXdwb3J0KCkpe1xyXG4gICAgICAgICAgICB2YXIgdmFsdWVJdGVtID0gJCgnLnZhbHVlSXRlbScpO1xyXG4gICAgICAgICAgICBpZiAoIXZhbHVlc0FuaW1hdGlvbkhhc1Jhbikge1xyXG5cclxuICAgICAgICAgICAgICAgICQuZWFjaCh2YWx1ZUl0ZW0sIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHRFbGVtID0gJCh0aGlzKS5maW5kKCdzdHJvbmcnKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZG9tTnVtID0gKE1hdGgucmFuZG9tKCkgKiAoMC41IC0gMi45KSArIDIuOSkudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgICAgICAgICBUd2Vlbk1heC5mcm9tVG8odGV4dEVsZW0sIDEsIHtjc3M6IHt4OiBcIi0xMFwiLCBvcGFjaXR5OiAwfX0sIHtjc3M6e3g6XCIwXCIsIG9wYWNpdHk6IFwiMVwifSwgZGVsYXk6IHJhbmRvbU51bX0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFsdWVzQW5pbWF0aW9uSGFzUmFuID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZihpc0hvbWVQYWdlICYmIGFib3V0VXNFbGVtLmxlbmd0aCA+IDApe1xyXG4gICAgICAgIGlmKGFib3V0VXNFbGVtLmlzSW5WaWV3cG9ydCgpKXtcclxuICAgICAgICAgICAgdmFyIGVtcGxveWVlID0gJCgnLmVtcGxveWVlLXdyYXBwZXInKTtcclxuICAgICAgICAgICAgaWYgKCFhYm91dFVzQW5pbWF0aW9uSGFzUmFuKSB7XHJcbiAgICAgICAgICAgICAgICBUd2Vlbk1heC5zdGFnZ2VyRnJvbVRvKGVtcGxveWVlLCAxLCB7Y3NzOiB7eDogXCItMTAwXCIsIG9wYWNpdHk6IDB9fSwge2Nzczp7eDpcIjBcIiwgb3BhY2l0eTogXCIxXCJ9LCBkZWxheTogMX0sIDAuNSk7XHJcbiAgICAgICAgICAgICAgICBhYm91dFVzQW5pbWF0aW9uSGFzUmFuID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuXHJcblxyXG4iLCIkKGZ1bmN0aW9uICgpIHtcclxuICAgIC8vKioqKioqKioqIENvbnN0XHJcbiAgICB2YXIgbGFzdFNjcm9sbFRvcCA9IDBcclxuICAgICAgICAsIGhhc1Njcm9sbGVkID0gZmFsc2VcclxuICAgICAgICAsIGhlYWRlckVsZW0gPSAkKCcjaGVhZGVyJylcclxuICAgICAgICAsIGlzSG9tZVBhZ2UgPSAkKCdib2R5LmhvbWVwYWdlJylcclxuICAgICAgICAsIHZpZXdQb3J0SGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpXHJcbiAgICAgICAgLCB2aWV3UG9ydFdpZHRoID0gJCh3aW5kb3cpLndpZHRoKClcclxuICAgICAgICAsIGFuaW1hdGlvbkluY3JlbWVudHMgPSA5NTBcclxuICAgICAgICAsIHN0ZXAgPSAwXHJcbiAgICAgICAgLCBzY3JvbGwgPSAwXHJcbiAgICAgICAgLCBoYXNTbmFwcGVkID0gZmFsc2VcclxuICAgICAgICAsIG1ldGhvZEl0ZW0gPSAkKCcubWV0aG9kLWl0ZW0nKVxyXG4gICAgICAgICwgbWV0aG9kQ29udGVudCA9ICQoJy5mYWRlSW4nKVxyXG4gICAgICAgICwgaXNNb2JpbGUgPSB3aW5kb3cub3JpZW50YXRpb24gPiAtMSAmJiBzY3JlZW4ud2lkdGggPD0gNjQwXHJcbiAgICAgICAgLCBpc19pUGFkID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvaVBhZC9pKSAhPSBudWxsXHJcbiAgICAgICAgLCBwbGFjZWhvbGRlciA9ICQoJ2JvZHknKS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtaG92ZXJMYWJlbCddXCIpO1xyXG5cclxuICAgIC8vKioqKioqKioqIEV2ZW50IEhhbmRsZXJzXHJcblxyXG4gICAgJCh3aW5kb3cpLm9uKCdtb3VzZXdoZWVsIERPTU1vdXNlU2Nyb2xsIHRvdWNobW92ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGhhc1Njcm9sbGVkID0gdHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgICQod2luZG93KS5vbigncmVzaXplJywgZnVuY3Rpb24oKXtcclxuICAgICAgICB2aWV3UG9ydEhlaWdodCA9ICQodGhpcykuaGVpZ2h0KCk7XHJcbiAgICAgICAgdmlld1BvcnRXaWR0aCA9ICQodGhpcykud2lkdGgoKTtcclxuICAgICAgICBhbmltYXRpb25JbmNyZW1lbnRzID0gJCh3aW5kb3cpLmhlaWdodCgpIC8gMTAwICogMjA7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZihpc0hvbWVQYWdlICE9PSB1bmRlZmluZWQgJiYgaXNIb21lUGFnZS5sZW5ndGggPiAwKXtcclxuICAgICAgICB2YXIgbWV0aG9kQ29udGFpbmVyID0gJCgnI21ldGhvZCcpXHJcbiAgICAgICAgICAgICwgbWV0aG9kU2Nyb2xsQ29udGFpbmVyID0gJCgnLm1ldGhvZC1zY3JvbGwtd3JhcHBlcicpXHJcbiAgICAgICAgICAgICwgbWV0aG9kQ29udGFpbmVySGVpZ2h0ID0gbWV0aG9kQ29udGFpbmVyLmhlaWdodCgpXHJcbiAgICAgICAgICAgICwgbWV0aG9kQ29udGFpbmVyT2Zmc2V0ID0gbWV0aG9kQ29udGFpbmVyLm9mZnNldCgpLnRvcFxyXG4gICAgICAgICAgICAsIENhc2VTdHVkeUNvbnRhaW5lciA9ICQoJyNjYXNlLXN0dWRpZXMnKVxyXG4gICAgICAgICAgICAsIENhc2VTdHVkeUNvbnRhaW5lck9mZnNldCA9IH5+Q2FzZVN0dWR5Q29udGFpbmVyLm9mZnNldCgpLnRvcFxyXG4gICAgICAgICAgICAsIGFib3V0Q29udGFpbmVyID0gJCgnI2Fib3V0JylcclxuICAgICAgICAgICAgLCBwcmVBYm91dENvbnRhaW5lciA9ICQoJyNwcmVhYm91dCcpXHJcbiAgICAgICAgICAgICwgcHJlQWJvdXRDb250YWluZXJPZmZzZXQgPSBwcmVBYm91dENvbnRhaW5lci5vZmZzZXQoKS50b3BcclxuICAgICAgICAgICAgLCB0b2dnbGVDbGFzc05hbWUgPSAnYWN0aXZlJ1xyXG4gICAgICAgICAgICAsIHZpc2libGVDbGFzc05hbWUgPSAnc2hvdyc7XHJcblxyXG4gICAgICAgIGlmKGlzTW9iaWxlIHx8IGlzX2lQYWQpIHtcclxuICAgICAgICAgICAgQ2FzZVN0dWR5Q29udGFpbmVyLmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICBtZXRob2RDb250ZW50LmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICBhYm91dENvbnRhaW5lci5hZGRDbGFzcyh2aXNpYmxlQ2xhc3NOYW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICQobWV0aG9kSXRlbSkub24oJ21vdXNlZW50ZXInLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9ICQodGhpcykuYXR0cignZGF0YS1pdGVtJyk7XHJcbiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAkKCcuZGlhZ3JhbS1sb2dvJykuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICBpZihwbGFjZWhvbGRlci5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKCcubWV0aG9kLWRlc2MuJysgaXRlbSkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAkKCcjZGlhZ3JhbScpLmFkZENsYXNzKGl0ZW0pO1xyXG4gICAgICAgIH0pLm9uKCdtb3VzZWxlYXZlJyxmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9ICQodGhpcykuYXR0cignZGF0YS1pdGVtJyk7XHJcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAkKCcuZGlhZ3JhbS1sb2dvJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICBpZihwbGFjZWhvbGRlci5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKCcubWV0aG9kLWRlc2MuJysgaXRlbSkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAkKCcjZGlhZ3JhbScpLnJlbW92ZUNsYXNzKGl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKCcuY2xvc2UtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgJCgnYm9keScpLnRvZ2dsZUNsYXNzKCdpc1BsYXlpbmcnKTtcclxuICAgICAgICAgICAgaGVhZGVyRWxlbS5yZW1vdmVDbGFzcygncGxheScpO1xyXG4gICAgICAgICAgICBoZWFkZXJFbGVtLmZpbmQoJy52aWRlby1jb250YWluZXInKS5yZW1vdmVDbGFzcygncGxheScpO1xyXG4gICAgICAgICAgICAkKCcueW91dHViZS12aWRlby1lbWJlZCBpZnJhbWUnKS5hdHRyKCdpZCcsICcnKS5hdHRyKCdzcmMnLCAnJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQoJy5wbGF5LXZpZGVvLXdyYXBwZXInKS5vbignY2xpY2snLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAkKCdib2R5JykudG9nZ2xlQ2xhc3MoJ2lzUGxheWluZycpO1xyXG4gICAgICAgICAgICBoZWFkZXJFbGVtLmFkZENsYXNzKCdwbGF5Jyk7XHJcbiAgICAgICAgICAgIGhlYWRlckVsZW0uZmluZCgnLnZpZGVvLWNvbnRhaW5lcicpLmFkZENsYXNzKCdwbGF5Jyk7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSAnLi9hc3NldHMvanNvbi9jb250ZW50Lmpzb24nO1xyXG4gICAgICAgICAgICAkLmdldEpTT04odXJsLCBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG9jID0gZ2V0Q29va2llKCdsYW5nJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG9jRGF0YSA9IGRhdGFbbG9jXTtcclxuICAgICAgICAgICAgICAgIHZhciBob21lcGFnZSA9IGxvY0RhdGEucGFnZXMuaG9tZXBhZ2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyID0gaG9tZXBhZ2UuaGVhZGVyLmNvbnRlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgJCgnLnlvdXR1YmUtdmlkZW8tZW1iZWQgaWZyYW1lJykuYXR0cignaWQnLCBoZWFkZXIueW91dHViZVVSTCkuYXR0cignc3JjJywgJ2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLycgKyBoZWFkZXIueW91dHViZVVSTCArICc/YXV0b3BsYXk9MCZyZWw9MCZmcz0xJmVuYWJsZWpzYXBpPTEnKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBzY3JvbGwgPSB+fiQodGhpcykuc2Nyb2xsVG9wKCk7XHJcblxyXG4gICAgICAgICAgICBpZih2aWV3UG9ydEhlaWdodCA8IDExMDApe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uSW5jcmVtZW50cyA9IDEwNTA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG1ldGhvZEl0ZW0ucmVtb3ZlQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuXHJcbiAgICAgICAgICAgIGdldERpcmVjdGlvbihzY3JvbGwsIGxhc3RTY3JvbGxUb3AsIGZ1bmN0aW9uKGRpcmVjdGlvbiwgc2Nyb2xsKXtcclxuICAgICAgICAgICAgICAgIGxhc3RTY3JvbGxUb3AgPSBzY3JvbGw7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoc2Nyb2xsICYmIGhhc1Njcm9sbGVkICYmICFpc01vYmlsZSAmJiB2aWV3UG9ydFdpZHRoID4gMTIwMCAmJiAhaXNfaVBhZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGRpcmVjdGlvbiA9PT0gJ2Rvd24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjcm9sbCA+PSBtZXRob2RDb250YWluZXJPZmZzZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGFzU25hcHBlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZENvbnRlbnQucmVtb3ZlQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tZXRob2RJdGVtLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1ldGhvZFNjcm9sbENvbnRhaW5lci5hZGRDbGFzcygnZml4ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RTY3JvbGxDb250YWluZXIuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlTWV0aG9kU2Nyb2xsKDUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9oYXNTbmFwcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjcm9sbCA+PSBtZXRob2RDb250YWluZXJPZmZzZXQgKyBtZXRob2RDb250YWluZXJIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhc2VTdHVkeUNvbnRhaW5lci5hZGRDbGFzcyh2aXNpYmxlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZENvbnRlbnQucmVtb3ZlQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21ldGhvZEl0ZW0ucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tZXRob2RTY3JvbGxDb250YWluZXIucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RTY3JvbGxDb250YWluZXIucmVtb3ZlQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2hhc1NuYXBwZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjcm9sbCA+PSBwcmVBYm91dENvbnRhaW5lck9mZnNldCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvdXRDb250YWluZXIuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBDYXNlU3R1ZHlDb250YWluZXIuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZENvbnRlbnQuYWRkQ2xhc3ModmlzaWJsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFib3V0Q29udGFpbmVyLmFkZENsYXNzKHZpc2libGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoZGlyZWN0aW9uID09PSAndXAnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjcm9sbCA8IENhc2VTdHVkeUNvbnRhaW5lck9mZnNldCAtIGFuaW1hdGlvbkluY3JlbWVudHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGFzU25hcHBlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbWV0aG9kSXRlbS5yZW1vdmVDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbWV0aG9kU2Nyb2xsQ29udGFpbmVyLmFkZENsYXNzKCdmaXhlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZFNjcm9sbENvbnRhaW5lci5hZGRDbGFzcyh2aXNpYmxlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVNZXRob2RTY3JvbGwoNSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2hhc1NuYXBwZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Nyb2xsIDw9IG1ldGhvZENvbnRhaW5lck9mZnNldCAtIDEwMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZENvbnRlbnQucmVtb3ZlQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbWV0aG9kSXRlbS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21ldGhvZFNjcm9sbENvbnRhaW5lci5yZW1vdmVDbGFzcygnZml4ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaGFzU25hcHBlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihoYXNTbmFwcGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGwgPiBtZXRob2RDb250YWluZXJPZmZzZXQgJiYgc2Nyb2xsIDwgbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgYW5pbWF0aW9uSW5jcmVtZW50cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2Nyb2xsID4gbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgYW5pbWF0aW9uSW5jcmVtZW50cyAmJiBzY3JvbGwgPCBtZXRob2RDb250YWluZXJPZmZzZXQgKyBhbmltYXRpb25JbmNyZW1lbnRzICogMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcCA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2Nyb2xsID4gbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgYW5pbWF0aW9uSW5jcmVtZW50cyAqIDIgJiYgc2Nyb2xsIDwgbWV0aG9kQ29udGFpbmVyT2Zmc2V0ICsgYW5pbWF0aW9uSW5jcmVtZW50cyAqIDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAgPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjcm9sbCA+IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMgKiAzICYmIHNjcm9sbCA8IG1ldGhvZENvbnRhaW5lck9mZnNldCArIGFuaW1hdGlvbkluY3JlbWVudHMgKiA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwID0gNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY3JvbGwgPiBtZXRob2RDb250YWluZXJPZmZzZXQgKyBhbmltYXRpb25JbmNyZW1lbnRzICogNCAmJiBzY3JvbGwgPCBDYXNlU3R1ZHlDb250YWluZXJPZmZzZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAgPSA1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVNZXRob2RTY3JvbGwoc3RlcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gZ2V0RGlyZWN0aW9uIChzY3JvbGwsIGxhc3RTY3JvbGxUb3AsIGNhbGxiYWNrKXtcclxuICAgIHZhciBkaXJlY3Rpb24gPSBudWxsXHJcbiAgICAgICAgLCBkZWx0YSA9IDU7XHJcblxyXG4gICAgaWYoTWF0aC5hYnMobGFzdFNjcm9sbFRvcCAtIHNjcm9sbCkgPD0gZGVsdGEpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHNjcm9sbCA+IGxhc3RTY3JvbGxUb3Ape1xyXG4gICAgICAgIGRpcmVjdGlvbiA9ICdkb3duJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZGlyZWN0aW9uID0gJ3VwJztcclxuICAgIH1cclxuICAgIGNhbGxiYWNrKGRpcmVjdGlvbiwgc2Nyb2xsKTtcclxufVxyXG5cclxuLy8gVGhpcyBmdW5jdGlvbiBzaG93ZWQgdGhlIGFwcHJvcHJpYXRlIGJ1YmJsZVxyXG4vLyBjdXJyZW50bHkgbm90IHVzZWQgYXMgdGhlIHNjcm9sbGluZyBmdW5jdGlvbiBpcyBkaXNhYmxlZFxyXG5mdW5jdGlvbiBoYW5kbGVNZXRob2RTY3JvbGwoc3RlcCl7XHJcbiAgICB2YXIgdG9nZ2xlQ2xhc3NOYW1lID0gJ21ldGhvZCdcclxuICAgICAgICAsIGZhZGVJbkVsZW1DbGFzcyA9ICcuZmFkZUluJ1xyXG4gICAgICAgICwgbWV0aG9kRWxlbSA9ICcubWV0aG9kLWl0ZW0nXHJcbiAgICAgICAgLCBpbnRyb0VsZW1DbGFzcyA9ICcuaW50cm8nXHJcbiAgICAgICAgLCBkZXNpZ25FbGVtQ2xhc3MgPSAnLmRlc2lnbidcclxuICAgICAgICAsIHR1bmluZ0VsZW1DbGFzcyA9ICcudHVuaW5nJ1xyXG4gICAgICAgICwgY29uc3RydWN0aW9uRWxlbUNsYXNzID0gJy5jb25zdHJ1Y3Rpb24nXHJcbiAgICAgICAgLCBldmFsRWxlbUNsYXNzID0gJy5ldmFsJztcclxuXHJcbiAgICAkKGZhZGVJbkVsZW1DbGFzcykucmVtb3ZlQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICQobWV0aG9kRWxlbSkucmVtb3ZlQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuXHJcbiAgICBpZihzdGVwID09PSAxKXtcclxuICAgICAgICAkKGZhZGVJbkVsZW1DbGFzcytpbnRyb0VsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0raW50cm9FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICB9IGVsc2UgaWYoc3RlcCA9PT0gMikge1xyXG4gICAgICAgICQobWV0aG9kRWxlbStpbnRyb0VsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKGZhZGVJbkVsZW1DbGFzcytkZXNpZ25FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChtZXRob2RFbGVtK2Rlc2lnbkVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgIH0gZWxzZSBpZihzdGVwID09PSAzKSB7XHJcbiAgICAgICAgJChtZXRob2RFbGVtK2ludHJvRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbStkZXNpZ25FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChmYWRlSW5FbGVtQ2xhc3MrdHVuaW5nRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbSt0dW5pbmdFbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICB9IGVsc2UgaWYoc3RlcCA9PT0gNCkge1xyXG4gICAgICAgICQobWV0aG9kRWxlbStpbnRyb0VsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rZGVzaWduRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbSt0dW5pbmdFbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChmYWRlSW5FbGVtQ2xhc3MrY29uc3RydWN0aW9uRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbStjb25zdHJ1Y3Rpb25FbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICB9IGVsc2UgaWYoc3RlcCA9PT0gNSkge1xyXG4gICAgICAgICQobWV0aG9kRWxlbStpbnRyb0VsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKG1ldGhvZEVsZW0rZGVzaWduRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbSt0dW5pbmdFbGVtQ2xhc3MpLmFkZENsYXNzKHRvZ2dsZUNsYXNzTmFtZSk7XHJcbiAgICAgICAgJChtZXRob2RFbGVtK2NvbnN0cnVjdGlvbkVsZW1DbGFzcykuYWRkQ2xhc3ModG9nZ2xlQ2xhc3NOYW1lKTtcclxuICAgICAgICAkKGZhZGVJbkVsZW1DbGFzcytldmFsRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgICAgICQobWV0aG9kRWxlbStldmFsRWxlbUNsYXNzKS5hZGRDbGFzcyh0b2dnbGVDbGFzc05hbWUpO1xyXG4gICAgfVxyXG59IiwiY2hvb3NlQ29va2llKCk7XHJcblxyXG5mdW5jdGlvbiBzZXRDb29raWUobmFtZSx2YWx1ZSxkYXlzKSB7XHJcbiAgICB2YXIgZXhwaXJlcyA9IFwiXCI7XHJcbiAgICBpZiAoZGF5cykge1xyXG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyAoZGF5cyoyNCo2MCo2MCoxMDAwKSk7XHJcbiAgICAgICAgZXhwaXJlcyA9IFwiOyBleHBpcmVzPVwiICsgZGF0ZS50b1VUQ1N0cmluZygpO1xyXG4gICAgfVxyXG4gICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArIFwiPVwiICsgKHZhbHVlIHx8IFwiXCIpICArIGV4cGlyZXMgKyBcIjsgcGF0aD0vXCI7XHJcbn1cclxuZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUpIHtcclxuICAgIHZhciBuYW1lRVEgPSBuYW1lICsgXCI9XCI7XHJcbiAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTtcclxuICAgIGZvcih2YXIgaT0wO2kgPCBjYS5sZW5ndGg7aSsrKSB7XHJcbiAgICAgICAgdmFyIGMgPSBjYVtpXTtcclxuICAgICAgICB3aGlsZSAoYy5jaGFyQXQoMCk9PScgJykgYyA9IGMuc3Vic3RyaW5nKDEsYy5sZW5ndGgpO1xyXG4gICAgICAgIGlmIChjLmluZGV4T2YobmFtZUVRKSA9PSAwKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZUVRLmxlbmd0aCxjLmxlbmd0aCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufVxyXG5mdW5jdGlvbiBlcmFzZUNvb2tpZShuYW1lKSB7XHJcbiAgICBkb2N1bWVudC5jb29raWUgPSBuYW1lKyc9OyBNYXgtQWdlPS05OTk5OTk5OTsnO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjaG9vc2VDb29raWUoKXtcclxuICAgIHZhciB1c2VyTGFuZyA9IG5hdmlnYXRvci5sYW5ndWFnZSB8fCBuYXZpZ2F0b3IudXNlckxhbmd1YWdlO1xyXG4gICAgdmFyIGFjdGl2ZUNvb2tpZSA9IGdldENvb2tpZSgnbGFuZycpO1xyXG4gICAgdmFyIHF1ZXJ5UGFyYW0gPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2xhbmcnKTtcclxuICAgIGlmKGFjdGl2ZUNvb2tpZSA9PT0gdW5kZWZpbmVkIHx8IGFjdGl2ZUNvb2tpZSA9PT0gbnVsbCB8fCBhY3RpdmVDb29raWUgPT09ICcnKXtcclxuICAgICAgICBpZih1c2VyTGFuZy5tYXRjaCgvZGUvZykpe1xyXG4gICAgICAgICAgICBzZXRDb29raWUoJ2xhbmcnLCdlbicsNyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh1c2VyTGFuZy5tYXRjaCgvZW4vZykpe1xyXG4gICAgICAgICAgICBzZXRDb29raWUoJ2xhbmcnLCdlbicsNyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh1c2VyTGFuZy5tYXRjaCgvbmwvZykpIHtcclxuICAgICAgICAgICAgc2V0Q29va2llKCdsYW5nJywnbmwnLDcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNldENvb2tpZSgnbGFuZycsJ25sJyw3KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgIH0sMjApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoYWN0aXZlQ29va2llKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocXVlcnlQYXJhbSAhPT0gdW5kZWZpbmVkICYmIHF1ZXJ5UGFyYW0gPT09ICdkZScpe1xyXG4gICAgICAgIHNldENvb2tpZSgnbGFuZycsJ2RlJyw3KTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJCgnI25hdiAuYWN0aXZlLWxvYycpLmh0bWwoZ2V0Q29va2llKCdsYW5nJykpO1xyXG4gICAgfSwyMDApO1xyXG4gICAgXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFBhcmFtZXRlckJ5TmFtZShuYW1lLCB1cmwpIHtcclxuICAgIGlmICghdXJsKSB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcclxuICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcclxuICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoJ1s/Jl0nICsgbmFtZSArICcoPShbXiYjXSopfCZ8I3wkKScpLFxyXG4gICAgICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgICBpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xyXG4gICAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gJyc7XHJcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xyXG59XHJcbiIsIiQoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG5hdklzT3BlbiA9IGZhbHNlXHJcbiAgICAgICAgLCBtb2JpbGVOYXYgPSAkKCcjbmF2IHVsJylcclxuICAgICAgICAsIGhhbWJ1cmdlckVsZW0gPSAkKCcuaGFtYnVyZ2VyJylcclxuICAgICAgICAsIHZpZXdQb3J0T2Zmc2V0ID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xyXG5cclxuICAgICQoJyNuYXYgbGkgYScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB2YXIgbmF2TGluayA9ICQodGhpcykuYXR0cignaHJlZicpO1xyXG4gICAgICAgIGlmKG5hdkxpbmsuaW5kZXhPZignLicpICE9PSAtMSkge1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG5hdkxpbms7XHJcbiAgICAgICAgfSBlbHNlIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdsb2MnKSl7XHJcbiAgICAgICAgICAgIGVyYXNlQ29va2llKCdsYW5nJyk7XHJcbiAgICAgICAgICAgIHNldENvb2tpZSgnbGFuZycsbmF2TGluayw3KTtcclxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICB9LDIwKTtcclxuICAgICAgICB9IGVsc2UgaWYobmF2TGluay5pbmRleE9mKCcjJykgIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHZhciBsaW5rUG9zID0gJChuYXZMaW5rKS5vZmZzZXQoKS50b3A7XHJcbiAgICAgICAgICAgIGlmIChuYXZMaW5rID09PSAnI2Zvb3RlcicpIHtcclxuICAgICAgICAgICAgICAgIGxpbmtQb3MgPSAkKCcjY29udGFjdC1pbmZvJykub2Zmc2V0KCkudG9wO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5hdkxpbmsgPT09ICcjY29tcGFyaXNvbicpIHtcclxuICAgICAgICAgICAgICAgIGxpbmtQb3MgPSAkKCcjY29tcGFyaXNvbi13cmFwcGVyJykub2Zmc2V0KCkudG9wO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICQoXCJodG1sLCBib2R5XCIpLmFuaW1hdGUoeyBzY3JvbGxUb3A6IGxpbmtQb3MgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobmF2SXNPcGVuKSB7XHJcbiAgICAgICAgICAgIGhhbWJ1cmdlckVsZW0ucmVtb3ZlQ2xhc3MoXCJpcy1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgIG1vYmlsZU5hdi5yZW1vdmVDbGFzcyhcIm9wZW5cIik7XHJcbiAgICAgICAgICAgIG5hdklzT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGhhbWJ1cmdlckVsZW0uY2xpY2soZnVuY3Rpb24oKXtcclxuICAgICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKFwiaXMtYWN0aXZlXCIpO1xyXG4gICAgICAgIG1vYmlsZU5hdi50b2dnbGVDbGFzcyhcIm9wZW5cIik7XHJcbiAgICAgICAgbmF2SXNPcGVuID0gdHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgICQod2luZG93KS5vbignc2Nyb2xsJywgZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgc2Nyb2xsID0gfn4kKHRoaXMpLnNjcm9sbFRvcCgpO1xyXG4gICAgICAgIGZpeE5hdihzY3JvbGwpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnLmNvbnRhY3QtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgZm9vdGVyT2Zmc2V0ID0gJCgnZm9vdGVyJykub2Zmc2V0KCkudG9wO1xyXG4gICAgICAgICQoXCJodG1sLCBib2R5XCIpLmFuaW1hdGUoeyBzY3JvbGxUb3A6IGZvb3Rlck9mZnNldCB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGZpeE5hdih2aWV3UG9ydE9mZnNldCk7XHJcbn0pO1xyXG5cclxuXHJcbmZ1bmN0aW9uIGZpeE5hdihzY3JvbGwpe1xyXG4gICAgdmFyIG5hdiA9ICQoXCIjbmF2XCIpO1xyXG4gICAgaWYgKHNjcm9sbCA+PSA1MDApIHtcclxuICAgICAgICBuYXYuYWRkQ2xhc3MoXCJmaXhlZFwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbmF2LnJlbW92ZUNsYXNzKFwiZml4ZWRcIik7XHJcbiAgICB9XHJcbn0iLCIkKGZ1bmN0aW9uKCl7XHJcbiAgICAvLyBMb2FkIHByb2plY3RzXHJcbiAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdob21lcGFnZScpKXtcclxuICAgICAgICB2YXIgdXJsID0gJy4vYXNzZXRzL2pzb24vY29udGVudC5iaW4nO1xyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICBzY3JpcHRDaGFyc2V0OiBcInV0Zi04XCIsXHJcbiAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0dWFsID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKGRhdGEpKSkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxvYyA9IGdldENvb2tpZSgnbGFuZycpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxvY0RhdGEgPSBhY3R1YWxbbG9jXTtcclxuICAgICAgICAgICAgICAgIHZhciBob21lcGFnZSA9IGxvY0RhdGEucGFnZXMuaG9tZXBhZ2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29tcGFyaXNvbiA9IGhvbWVwYWdlLmNvbnRlbnQuY29tcGFyaXNvbjtcclxuICAgICAgICAgICAgICAgIHZhciBjb21wYXJpc29uV3JhcHBlciA9ICQoXCIjY29tcGFyaXNvblwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBjb21wYXJpc29uSXRlbSA9IGNvbXBhcmlzb24uY29tcGFyaXNvbnMgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goY29tcGFyaXNvbkl0ZW0sIGZ1bmN0aW9uIChpbmRleCwgaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBhcmlzb25XcmFwcGVyLmFwcGVuZCgnPGRpdiBjbGFzcz1cIml0ZW1cIj48aW1nIGRhdGEtY29udGVudD1cImNvbnRlbnQtY29tcGFyaXNvbi1iZWZvcmVcIiBzcmM9XCInICsgaXRlbS5iZWZvcmUgKyAnXCIgY2xhc3M9XCJiZWZvcmVcIiBhbHQ+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGRhdGEtY29udGVudD1cImNvbnRlbnQtY29tcGFyaXNvbi1hZnRlclwiIGNsYXNzPVwiYWZ0ZXJcIiBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnICsgaXRlbS5hZnRlciArICcpXCI+PC9kaXY+PC9kaXY+Jyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBhcmlzb25XcmFwcGVyLm5vdCgnLnNsaWNrLWluaXRpYWxpemVkJykuc2xpY2soe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNUb1Nob3c6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1RvU2Nyb2xsOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRvcGxheTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3BsYXlTcGVlZDogMzAwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dEFycm93OiAnLmljb24tYXJyb3ctcmlnaHQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2QXJyb3c6ICcuaWNvbi1hcnJvdy1sZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpcGVUb1NsaWRlOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBhcmlzb25XcmFwcGVyLm9uKCdzZXRQb3NpdGlvbicsIGZ1bmN0aW9uKGV2ZW50LCBzbGljaywgY3VycmVudFNsaWRlLCBuZXh0U2xpZGUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5rYm94ID0gY29tcGFyaXNvbldyYXBwZXIuZmluZCgnLnNsaWNrLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5rYm94KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmtib3gub24oXCJtb3VzZW1vdmVcIix0cmFja0xvY2F0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlua2JveC5vbihcInRvdWNoc3RhcnRcIix0cmFja0xvY2F0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlua2JveC5vbihcInRvdWNobW92ZVwiLHRyYWNrTG9jYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9LDIwMCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbmZ1bmN0aW9uIHRyYWNrTG9jYXRpb24oZSl7XHJcbiAgICB2YXIgY29sb3Jib3ggPSAkKCcuc2xpY2stYWN0aXZlIC5hZnRlcicpXHJcbiAgICAgICAgLCBmaWxsZXJJbWFnZSA9ICQoJy5zbGljay1hY3RpdmUgLmJlZm9yZScpXHJcbiAgICAgICAgLCByZWN0ID0gZmlsbGVySW1hZ2VbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcclxuICAgICAgICAsIGZpbGxlckltYWdlT3cgPSBmaWxsZXJJbWFnZS5vdXRlcldpZHRoKClcclxuICAgICAgICAsIHBvc2l0aW9uID0gKChlLnBhZ2VYIC0gcmVjdC5sZWZ0KSAvIGZpbGxlckltYWdlT3cpKjEwMDtcclxuXHJcbiAgICBpZihwb3NpdGlvbiA8PSAxMDApe1xyXG4gICAgICAgIGNvbG9yYm94LmNzcygnd2lkdGgnLCBwb3NpdGlvbitcIiVcIik7XHJcbiAgICB9XHJcbn1cclxuXHJcbiIsIiQoZnVuY3Rpb24oKXtcclxuICAgIHZhciB1cmwgPSAnLi9hc3NldHMvanNvbi9jb250ZW50LmJpbic7XHJcbiAgICB2YXIgJGJvZHkgPSAkKFwiYm9keVwiKTtcclxuXHJcbiAgICAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgIHNjcmlwdENoYXJzZXQ6IFwidXRmLThcIixcclxuICAgICAgICB0eXBlOiBcIkdFVFwiLFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBhY3R1YWwgPSBKU09OLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUod2luZG93LmF0b2IoZGF0YSkpKSk7XHJcbiAgICAgICAgICAgIHZhciBsb2MgPSBnZXRDb29raWUoJ2xhbmcnKTtcclxuICAgICAgICAgICAgdmFyIGxvY0RhdGEgPSBhY3R1YWxbbG9jXTtcclxuICAgICAgICAgICAgdmFyIG5hdiA9IGxvY0RhdGEubmF2LmxhYmVscztcclxuICAgICAgICAgICAgdmFyIGhvbWVwYWdlID0gbG9jRGF0YS5wYWdlcy5ob21lcGFnZTtcclxuICAgICAgICAgICAgdmFyIGhlYWRlciA9IGhvbWVwYWdlLmhlYWRlci5jb250ZW50O1xyXG4gICAgICAgICAgICB2YXIgaW50cm8gPSBob21lcGFnZS5jb250ZW50LmludHJvO1xyXG4gICAgICAgICAgICB2YXIgYnJhbmRzID0gaW50cm8uaW1hZ2VzO1xyXG4gICAgICAgICAgICB2YXIgYWJvdXQgPSBob21lcGFnZS5jb250ZW50LmFib3V0O1xyXG4gICAgICAgICAgICB2YXIgYWJvdXRVcyA9IGhvbWVwYWdlLmNvbnRlbnQuYWJvdXRVcztcclxuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGhvbWVwYWdlLmNvbnRlbnQudmFsdWVzO1xyXG4gICAgICAgICAgICB2YXIgY29tcGFyaXNvbiA9IGhvbWVwYWdlLmNvbnRlbnQuY29tcGFyaXNvbjtcclxuICAgICAgICAgICAgdmFyIG1ldGhvZCA9IGhvbWVwYWdlLmNvbnRlbnQubWV0aG9kO1xyXG4gICAgICAgICAgICB2YXIgbW9kZWwgPSBob21lcGFnZS5jb250ZW50Lm1vZGVsO1xyXG4gICAgICAgICAgICB2YXIgcHJvamVjdHMgPSBob21lcGFnZS5jb250ZW50LnByb2plY3RzO1xyXG4gICAgICAgICAgICB2YXIgZm9vdGVyID0gaG9tZXBhZ2UuZm9vdGVyO1xyXG5cclxuICAgICAgICAgICAgaWYgKGxvY0RhdGEpIHtcclxuICAgICAgICAgICAgICAgICRib2R5LnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChsb2MgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY2hvb3NlQ29va2llKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKG5hdikge1xyXG4gICAgICAgICAgICAgICAgdmFyIG5hdkl0ZW0gPSAkKCcjbmF2ID4gdWwgPiBsaSAnKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI3ByZWFib3V0XCJdJykuaHRtbChuYXYuYWJvdXQpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCJpbmRleC5odG1sI3ByZWFib3V0XCJdJykuaHRtbChuYXYuYWJvdXQpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjbWV0aG9kXCJdJykuaHRtbChuYXYubWV0aG9kKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiaW5kZXguaHRtbCNtZXRob2RcIl0nKS5odG1sKG5hdi5tZXRob2QpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjdmFsdWVzXCJdJykuaHRtbChuYXYudmFsdWVzKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiaW5kZXguaHRtbCN2YWx1ZXNcIl0nKS5odG1sKG5hdi52YWx1ZXMpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjYWJvdXRVc1wiXScpLmh0bWwobmF2LmFib3V0VXMpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCJpbmRleC5odG1sI2Fib3V0VXNcIl0nKS5odG1sKG5hdi5hYm91dFVzKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwicHJvamVjdHMuaHRtbFwiXScpLmh0bWwobmF2LnByb2plY3RzKTtcclxuICAgICAgICAgICAgICAgIG5hdkl0ZW0uZmluZCgnYVtocmVmPVwiI2Zvb3RlclwiXScpLmh0bWwobmF2LmNvbnRhY3QpO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjZm9vdGVyXCJdJykuaHRtbChuYXYuY29udGFjdCk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiNtaXNzaW9uXCJdJykuaHRtbChuYXYubWlzc2lvbik7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cImluZGV4Lmh0bWwjbWlzc2lvblwiXScpLmh0bWwobmF2Lm1pc3Npb24pO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjbW9kZWxcIl0nKS5odG1sKG5hdi5tb2RlbCk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cImluZGV4Lmh0bWwjbW9kZWxcIl0nKS5odG1sKG5hdi5tb2RlbCk7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cIiNmb3VuZGF0aW9uXCJdJykuaHRtbChuYXYuZm91bmRhdGlvbik7XHJcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmZpbmQoJ2FbaHJlZj1cImluZGV4Lmh0bWwjZm91bmRhdGlvblwiXScpLmh0bWwobmF2LmZvdW5kYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCIjY29tcGFyaXNvblwiXScpLmh0bWwobmF2LmNvbXBhcmlzb24pO1xyXG4gICAgICAgICAgICAgICAgbmF2SXRlbS5maW5kKCdhW2hyZWY9XCJpbmRleC5odG1sI2NvbXBhcmlzb25cIl0nKS5odG1sKG5hdi5jb21wYXJpc29uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGhlYWRlcikge1xyXG4gICAgICAgICAgICAgICAgJCgnLmJhY2tncm91bmQtdmlkZW8nKS5jc3MoeydiYWNrZ3JvdW5kSW1hZ2UnOiBoZWFkZXIuYmFja2dyb3VuZEltYWdlU3JjfSk7XHJcbiAgICAgICAgICAgICAgICAkKCcueW91dHViZS12aWRlby1lbWJlZCBpZnJhbWUnKS5hdHRyKCdpZCcsIGhlYWRlci55b3V0dWJlVVJMKS5hdHRyKCdzcmMnLCAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvJyArIGhlYWRlci55b3V0dWJlVVJMICsgJz9hdXRvcGxheT0wJnJlbD0wJmZzPTEmZW5hYmxlanNhcGk9MScpXHJcbiAgICAgICAgICAgICAgICAkKCd2aWRlbyBzb3VyY2UjbXA0JykuYXR0cignc3JjJywgaGVhZGVyLmJhY2tncm91bmRWaWRlb01wNFNyYyk7XHJcbiAgICAgICAgICAgICAgICAkKCd2aWRlbyBzb3VyY2Ujd2VibScpLmF0dHIoJ3NyYycsIGhlYWRlci5iYWNrZ3JvdW5kVmlkZW9XZWJNU3JjKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdoZWFkZXItY29udGVudC10aXRsZSddXCIpLmh0bWwoaGVhZGVyLmhlYWRlcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChpbnRybykge1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtaW50cm8tdGl0bGUnXVwiKS5odG1sKGludHJvLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1pbnRyby1kZXNjJ11cIikuaHRtbChpbnRyby5kZXNjcmlwdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoJCgnLmJyYW5kbGlzdCcpLmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChicmFuZHMsIGZ1bmN0aW9uIChpbmRleCwgYnJhbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYnJhbmQuc3JjKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRib2R5LmZpbmQoJy5icmFuZGxpc3QnKS5hcHBlbmQoJzxsaT48aW1nIHNyYz1cIicrYnJhbmQuc3JjKydcIiBhbHQ9XCInK2JyYW5kLmFsdCsnXCIgLz48L2xpPicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChhYm91dCkge1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtYWJvdXQtcm93MS10aXRsZSddXCIpLmh0bWwoYWJvdXQucm93MS5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtYWJvdXQtcm93MS1pbWFnZSddXCIpLmNzcyh7J2JhY2tncm91bmRJbWFnZSc6IGFib3V0LnJvdzEuaW1hZ2Uuc3JjfSk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1hYm91dC1yb3cxLWRlc2MnXVwiKS5odG1sKGFib3V0LnJvdzEuZGVzY3JpcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWFib3V0LXJvdzItdGl0bGUnXVwiKS5odG1sKGFib3V0LnJvdzIuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWFib3V0LXJvdzItaW1hZ2UnXVwiKS5jc3MoeydiYWNrZ3JvdW5kSW1hZ2UnOiBhYm91dC5yb3cyLmltYWdlLnNyY30pO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtYWJvdXQtcm93Mi1kZXNjJ11cIikuaHRtbChhYm91dC5yb3cyLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGFib3V0VXMpIHtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWFib3V0VXMtdGl0bGUnXVwiKS5odG1sKGFib3V0VXMuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWFib3V0VXMtZGVzY3JpcHRpb24nXVwiKS5odG1sKGFib3V0VXMuZGVzY3JpcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWVtcGxveWVlLW5pZWstaW1hZ2UnXVwiKS5hdHRyKCdzcmMnLCBhYm91dFVzLmVtcGxveWVlcy5uaWVrLmltYWdlLnNyYykuYXR0cignYWx0JywgYWJvdXRVcy5lbXBsb3llZXMubmllay5pbWFnZS5hbHQpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtZW1wbG95ZWUtbmllay10aXRsZSddXCIpLmh0bWwoYWJvdXRVcy5lbXBsb3llZXMubmllay5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtZW1wbG95ZWUtbmllay1kZXNjJ11cIikuaHRtbChhYm91dFVzLmVtcGxveWVlcy5uaWVrLmRlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1lbXBsb3llZS1qYW4taW1hZ2UnXVwiKS5hdHRyKCdzcmMnLCBhYm91dFVzLmVtcGxveWVlcy5qYW4uaW1hZ2Uuc3JjKS5hdHRyKCdhbHQnLCBhYm91dFVzLmVtcGxveWVlcy5qYW4uaW1hZ2UuYWx0KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LWVtcGxveWVlLWphbi10aXRsZSddXCIpLmh0bWwoYWJvdXRVcy5lbXBsb3llZXMuamFuLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1lbXBsb3llZS1qYW4tZGVzYyddXCIpLmh0bWwoYWJvdXRVcy5lbXBsb3llZXMuamFuLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtdmFsdWVzLWltYWdlJ11cIikuY3NzKHsnYmFja2dyb3VuZEltYWdlJzogdmFsdWVzLmltYWdlLnNyY30pO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtdmFsdWVzLXRpdGxlJ11cIikuaHRtbCh2YWx1ZXMuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXZhbHVlcy1kZXNjJ11cIikuaHRtbCh2YWx1ZXMuZGVzY3JpcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXZhbHVlMSddXCIpLmh0bWwodmFsdWVzLnZhbHVlcy52YWx1ZTEpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtdmFsdWUyJ11cIikuaHRtbCh2YWx1ZXMudmFsdWVzLnZhbHVlMik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC12YWx1ZTMnXVwiKS5odG1sKHZhbHVlcy52YWx1ZXMudmFsdWUzKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXZhbHVlNCddXCIpLmh0bWwodmFsdWVzLnZhbHVlcy52YWx1ZTQpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtdmFsdWU1J11cIikuaHRtbCh2YWx1ZXMudmFsdWVzLnZhbHVlNSk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC12YWx1ZTYnXVwiKS5odG1sKHZhbHVlcy52YWx1ZXMudmFsdWU2KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG1ldGhvZCkge1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLXRpdGxlJ11cIikuaHRtbChtZXRob2QuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1kZXNjJ11cIikuaHRtbChtZXRob2QuZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWhvdmVyTGFiZWwnXVwiKS5odG1sKG1ldGhvZC5ob3ZlckxhYmVsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtaW50cm8tdGl0bGUnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLmludHJvLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtaW50cm8tZGVzYyddXCIpLmh0bWwobWV0aG9kLm1ldGhvZHMuaW50cm8uZGVzY3JpcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1kZXNpZ24tdGl0bGUnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLmRlc2lnbi5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWRlc2lnbi1kZXNjJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy5kZXNpZ24uZGVzY3JpcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC10dW5pbmctdGl0bGUnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLnR1bmluZy5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLXR1bmluZy1kZXNjJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy50dW5pbmcuZGVzY3JpcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1jb25zdHJ1Y3Rpb24tdGl0bGUnXVwiKS5odG1sKG1ldGhvZC5tZXRob2RzLmNvbnN0cnVjdGlvbi5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtbWV0aG9kLWNvbnN0cnVjdGlvbi1kZXNjJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy5jb25zdHJ1Y3Rpb24uZGVzY3JpcHRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1ldGhvZC1ldmFsLXRpdGxlJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy5ldmFsLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tZXRob2QtZXZhbC1kZXNjJ11cIikuaHRtbChtZXRob2QubWV0aG9kcy5ldmFsLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG1vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tb2RlbC10aXRsZSddXCIpLmh0bWwobW9kZWwuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LW1vZGVsLWltYWdlJ11cIikuY3NzKHsnYmFja2dyb3VuZEltYWdlJzogbW9kZWwuaW1hZ2Uuc3JjfSk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1tb2RlbC1kZXNjJ11cIikuaHRtbChtb2RlbC5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwcm9qZWN0cykge1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdHMtdGl0bGUnXVwiKS5odG1sKHByb2plY3RzLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0cy1kZXNjJ11cIikuaHRtbChwcm9qZWN0cy5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0cy1idXR0b24nXVwiKS5odG1sKHByb2plY3RzLmJ1dHRvbi5sYWJlbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdDEtaW1hZ2UnXVwiKS5hdHRyKCdzcmMnLCBwcm9qZWN0cy5wcm9qZWN0MS5pbWFnZS5zcmMpLmF0dHIoJ2FsdCcsIHByb2plY3RzLnByb2plY3QxLmltYWdlLmFsdCk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0MS10aXRsZSddXCIpLmh0bWwocHJvamVjdHMucHJvamVjdDEuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3QxLWJ0biddXCIpLmh0bWwocHJvamVjdHMucHJvamVjdDEuYnV0dG9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nY29udGVudC1wcm9qZWN0Mi1pbWFnZSddXCIpLmF0dHIoJ3NyYycsIHByb2plY3RzLnByb2plY3QyLmltYWdlLnNyYykuYXR0cignYWx0JywgcHJvamVjdHMucHJvamVjdDIuaW1hZ2UuYWx0KTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3QyLXRpdGxlJ11cIikuaHRtbChwcm9qZWN0cy5wcm9qZWN0Mi5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2NvbnRlbnQtcHJvamVjdDItYnRuJ11cIikuaHRtbChwcm9qZWN0cy5wcm9qZWN0Mi5idXR0b24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZihjb21wYXJpc29uKXtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3RzLWNvbXBhcmlzb24tdGl0bGUnXVwiKS5odG1sKGNvbXBhcmlzb24uaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdjb250ZW50LXByb2plY3RzLWNvbXBhcmlzb24tZGVzYyddXCIpLmh0bWwoY29tcGFyaXNvbi5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChmb290ZXIpIHtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItdGVzdGltb25pYWxzLXRpdGxlJ11cIikuaHRtbChmb290ZXIudGVzdGltb25pYWxzLmhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLWhlYWRlciddXCIpLmh0bWwoZm9vdGVyLmNvbnRhY3RzLmhlYWRlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1qYW4tdGl0bGUnXVwiKS5odG1sKGZvb3Rlci5jb250YWN0cy5qYW4uaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtamFuLWVtYWlsJ11cIikuYXR0cignaHJlZicsIGZvb3Rlci5jb250YWN0cy5qYW4ubGlua3MuZW1haWwuc3JjKS5odG1sKGZvb3Rlci5jb250YWN0cy5qYW4ubGlua3MuZW1haWwuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtbGlua2VkaW4tamFuJ11cIikuYXR0cignaHJlZicsIGZvb3Rlci5jb250YWN0cy5qYW4ubGlua3MubGlua2VkaW4uc3JjKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtbGlua2VkaW4tamFuLXRpdGxlJ11cIikuaHRtbCggZm9vdGVyLmNvbnRhY3RzLmphbi5saW5rcy5saW5rZWRpbi5oZWFkZXIrJyAnKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtY2FsbC1qYW4tcGhvbmUnXVwiKS5hdHRyKCdocmVmJywgZm9vdGVyLmNvbnRhY3RzLmphbi5waG9uZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1uaWVrLXRpdGxlJ11cIikuaHRtbChmb290ZXIuY29udGFjdHMubmllay5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1uaWVrLWVtYWlsJ11cIikuYXR0cignaHJlZicsIGZvb3Rlci5jb250YWN0cy5uaWVrLmxpbmtzLmVtYWlsLnNyYykuaHRtbChmb290ZXIuY29udGFjdHMubmllay5saW5rcy5lbWFpbC5oZWFkZXIpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1saW5rZWRpbi1uaWVrJ11cIikuYXR0cignaHJlZicsIGZvb3Rlci5jb250YWN0cy5uaWVrLmxpbmtzLmxpbmtlZGluLnNyYyk7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLWxpbmtlZGluLW5pZWstdGl0bGUnXVwiKS5odG1sKGZvb3Rlci5jb250YWN0cy5uaWVrLmxpbmtzLmxpbmtlZGluLmhlYWRlcisnICcpO1xyXG4gICAgICAgICAgICAgICAgJGJvZHkuZmluZChcIltkYXRhLWNvbnRlbnQ9J2Zvb3Rlci1jb250YWN0cy1jYWxsLW5pZWstcGhvbmUnXVwiKS5hdHRyKCdocmVmJywgZm9vdGVyLmNvbnRhY3RzLm5pZWsucGhvbmUpO1xyXG5cclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtcGhvbmUtaGVhZGVyJ11cIikuaHRtbChmb290ZXIucGhvbmUuaGVhZGVyKTtcclxuICAgICAgICAgICAgICAgICRib2R5LmZpbmQoXCJbZGF0YS1jb250ZW50PSdmb290ZXItY29udGFjdHMtdmlzaXQtaGVhZGVyJ11cIikuaHRtbChmb290ZXIudmlzaXQuaGVhZGVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvbnRhY3RzLXZpc2l0LWRlc2MnXVwiKS5odG1sKGZvb3Rlci52aXNpdC5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICAkYm9keS5maW5kKFwiW2RhdGEtY29udGVudD0nZm9vdGVyLWNvcHlyaWdodC1kZXNjJ11cIikuaHRtbChmb290ZXIuY29weXJpZ2h0LmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuIiwiLy8gR29vZ2xlIG1hcHMgc2V0dXBcclxuXHJcbnZhciBtYXA7XHJcbmdvb2dsZS5tYXBzLmV2ZW50LmFkZERvbUxpc3RlbmVyKHdpbmRvdywgJ2xvYWQnLCBnb29nbGVNYXBzSW5pdCk7XHJcblxyXG5mdW5jdGlvbiBnb29nbGVNYXBzSW5pdCgpIHtcclxuICAgIHZhciBteUxhdGxuZyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoNTEuMzcyMDI3LCA2LjE2MDQ3OCk7XHJcbiAgICB2YXIgbWFwT3B0aW9ucyA9IHtcclxuICAgICAgICB6b29tOiAxNSxcclxuICAgICAgICBjZW50ZXI6IG15TGF0bG5nLFxyXG4gICAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZSxcclxuICAgICAgICBuYXZpZ2F0aW9uQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgbWFwVHlwZUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgIHNjYWxlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgZGlzYWJsZURlZmF1bHRVSTogdHJ1ZSxcclxuICAgICAgICBzdHlsZXM6IFt7XCJmZWF0dXJlVHlwZVwiOlwibGFuZHNjYXBlXCIsXCJzdHlsZXJzXCI6W3tcInZpc2liaWxpdHlcIjpcInNpbXBsaWZpZWRcIn0se1wiY29sb3JcIjpcIiMyYjNmNTdcIn0se1wid2VpZ2h0XCI6MC4xfV19LHtcImZlYXR1cmVUeXBlXCI6XCJhZG1pbmlzdHJhdGl2ZVwiLFwic3R5bGVyc1wiOlt7XCJ2aXNpYmlsaXR5XCI6XCJvblwifSx7XCJodWVcIjpcIiNmZjAwMDBcIn0se1wid2VpZ2h0XCI6MC40fSx7XCJjb2xvclwiOlwiI2ZmZmZmZlwifV19LHtcImZlYXR1cmVUeXBlXCI6XCJyb2FkLmhpZ2h3YXlcIixcImVsZW1lbnRUeXBlXCI6XCJsYWJlbHMudGV4dFwiLFwic3R5bGVyc1wiOlt7XCJ3ZWlnaHRcIjoxLjN9LHtcImNvbG9yXCI6XCIjRkZGRkZGXCJ9XX0se1wiZmVhdHVyZVR5cGVcIjpcInJvYWQuaGlnaHdheVwiLFwiZWxlbWVudFR5cGVcIjpcImdlb21ldHJ5XCIsXCJzdHlsZXJzXCI6W3tcImNvbG9yXCI6XCIjZjU1Zjc3XCJ9LHtcIndlaWdodFwiOjN9XX0se1wiZmVhdHVyZVR5cGVcIjpcInJvYWQuYXJ0ZXJpYWxcIixcImVsZW1lbnRUeXBlXCI6XCJnZW9tZXRyeVwiLFwic3R5bGVyc1wiOlt7XCJjb2xvclwiOlwiI2Y1NWY3N1wifSx7XCJ3ZWlnaHRcIjoxLjF9XX0se1wiZmVhdHVyZVR5cGVcIjpcInJvYWQubG9jYWxcIixcImVsZW1lbnRUeXBlXCI6XCJnZW9tZXRyeVwiLFwic3R5bGVyc1wiOlt7XCJjb2xvclwiOlwiI2Y1NWY3N1wifSx7XCJ3ZWlnaHRcIjowLjR9XX0se30se1wiZmVhdHVyZVR5cGVcIjpcInJvYWQuaGlnaHdheVwiLFwiZWxlbWVudFR5cGVcIjpcImxhYmVsc1wiLFwic3R5bGVyc1wiOlt7XCJ3ZWlnaHRcIjowLjh9LHtcImNvbG9yXCI6XCIjZmZmZmZmXCJ9LHtcInZpc2liaWxpdHlcIjpcIm9uXCJ9XX0se1wiZmVhdHVyZVR5cGVcIjpcInJvYWQubG9jYWxcIixcImVsZW1lbnRUeXBlXCI6XCJsYWJlbHNcIixcInN0eWxlcnNcIjpbe1widmlzaWJpbGl0eVwiOlwib2ZmXCJ9XX0se1wiZmVhdHVyZVR5cGVcIjpcInJvYWQuYXJ0ZXJpYWxcIixcImVsZW1lbnRUeXBlXCI6XCJsYWJlbHNcIixcInN0eWxlcnNcIjpbe1wiY29sb3JcIjpcIiNmZmZmZmZcIn0se1wid2VpZ2h0XCI6MC43fV19LHtcImZlYXR1cmVUeXBlXCI6XCJwb2lcIixcImVsZW1lbnRUeXBlXCI6XCJsYWJlbHNcIixcInN0eWxlcnNcIjpbe1widmlzaWJpbGl0eVwiOlwib2ZmXCJ9XX0se1wiZmVhdHVyZVR5cGVcIjpcInBvaVwiLFwic3R5bGVyc1wiOlt7XCJjb2xvclwiOlwiIzZjNWI3YlwifV19LHtcImZlYXR1cmVUeXBlXCI6XCJ3YXRlclwiLFwic3R5bGVyc1wiOlt7XCJjb2xvclwiOlwiI2YzYjE5MVwifV19LHtcImZlYXR1cmVUeXBlXCI6XCJ0cmFuc2l0LmxpbmVcIixcInN0eWxlcnNcIjpbe1widmlzaWJpbGl0eVwiOlwib25cIn1dfV1cclxuICAgIH07XHJcblxyXG4gICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWNhbnZhcycpLCBtYXBPcHRpb25zKTtcclxuXHJcbiAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgcG9zaXRpb246IG15TGF0bG5nLFxyXG4gICAgICAgIGljb246ICcvL2V4cG8tbWF0ZS5naXRodWIuaW8vYXNzZXRzL2ltYWdlcy9tYXJrZXIucG5nJyxcclxuICAgICAgICBtYXA6IG1hcFxyXG4gICAgfSk7XHJcblxyXG4gICAgdmFyIGluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7XHJcbiAgICAgICAgY29udGVudDogJCgnLmNvbnRhY3QtZGV0YWlscy1tYXAnKS5odG1sKClcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICBpZigkKHdpbmRvdykud2lkdGgoKSA+IDQ1MCl7XHJcbiAgICAgICAgbWFwLnBhbkJ5KDIwMCwgLTE1MCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBpbmZvd2luZG93Lm9wZW4obWFwLG1hcmtlcik7XHJcbiAgICB9KTtcclxufSIsIiQoZnVuY3Rpb24oKXtcclxuICAgIC8vIExvYWQgcHJvamVjdHNcclxuICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3Byb2plY3RzJykpe1xyXG4gICAgICAgIHZhciB1cmwgPSAnLi9hc3NldHMvanNvbi9jb250ZW50LmJpbic7XHJcbiAgICAgICAgdmFyIGhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaDtcclxuXHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgIHNjcmlwdENoYXJzZXQ6IFwidXRmLThcIixcclxuICAgICAgICAgICAgdHlwZTogXCJHRVRcIixcclxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhY3R1YWwgPSBKU09OLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUod2luZG93LmF0b2IoZGF0YSkpKSlcclxuICAgICAgICAgICAgICAgICwgbG9jID0gZ2V0Q29va2llKCdsYW5nJylcclxuICAgICAgICAgICAgICAgICwgaG9tZXByb2plY3QgPSBhY3R1YWxbbG9jXS5wYWdlcy5ob21lcGFnZS5jb250ZW50LnByb2plY3RzXHJcbiAgICAgICAgICAgICAgICAsIHJldmlld0xpbmsgPSBob21lcHJvamVjdC5yZXZpZXdMaW5rIHx8ICcnXHJcbiAgICAgICAgICAgICAgICAsIHByb2plY3REZXRhaWwgPSBhY3R1YWxbbG9jXS5wYWdlcy5wcm9qZWN0c1xyXG4gICAgICAgICAgICAgICAgLCBzZWN0aW9uID0gJCgnI3Byb2plY3RzIC5wcm9qZWN0cy13cmFwcGVyJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGxvYyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hvb3NlQ29va2llKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJC5lYWNoKHByb2plY3REZXRhaWwsIGZ1bmN0aW9uIChpbmRleCwgaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWFnZUFycmF5ID0gW11cclxuICAgICAgICAgICAgICAgICAgICAgICAgLCBpbWFnZUNvbnRlbnQgPSBpdGVtLmltYWdlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGNvdW50ID0gcGFyc2VJbnQoaW5kZXgpICsgMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAsIHJldmlldyA9IGl0ZW0ucmV2aWV3XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICwgYXV0aG9yID0gcmV2aWV3LmF1dGhvciB8fCAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGRlc2MgPSByZXZpZXcuZGVzY3JpcHRpb24gfHwgJydcclxuICAgICAgICAgICAgICAgICAgICAgICAgLCByZXZpZXdEYXRlID0gcmV2aWV3LmRhdGUgfHwgJydcclxuICAgICAgICAgICAgICAgICAgICAgICAgLCBpZGVudGlmaWVyID0gYXV0aG9yLnJlcGxhY2UoL1teQS1aMC05XSsvaWcsIFwiLVwiKS50b0xvd2VyQ2FzZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICwgc3RhckNvdW50ID0gcmV2aWV3LnN0YXJzIHx8ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2VDb250ZW50ICYmIGltYWdlQ29udGVudC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChpbWFnZUNvbnRlbnQsIGZ1bmN0aW9uIChpbmRleCwgaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VBcnJheS5wdXNoKCc8ZGl2IGNsYXNzPVwicHJvamVjdC1pbWFnZVwiIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCcraXRlbS5zcmMrJylcIj48L2Rpdj4nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb24uYXBwZW5kKCc8ZGl2IGNsYXNzPVwicHJvamVjdFwiIGlkPVwicHJvamVjdCcrY291bnQrJ1wiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHQ8ZGl2IGNsYXNzPVwicHJvamVjdC1jbG9zZVwiPjwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHQ8ZGl2IGNsYXNzPVwicHJvamVjdC13cmFwcGVyXCI+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0PGRpdiBjbGFzcz1cInByb2plY3QtaW1hZ2VzXCI+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0XHQ8ZGl2IGNsYXNzPVwic2xpZGVyXCI+JytpbWFnZUFycmF5LmpvaW4oXCJcIikrJzwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdDwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdDxkaXYgY2xhc3M9XCJwcm9qZWN0LWRlc2Mtd3JhcHBlclwiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0PGRpdiBjbGFzcz1cInByb2plY3QtZGVzYy1jb250ZW50XCI+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0XHRcdDxkaXYgY2xhc3M9XCJwcm9qZWN0LWhlYWRlclwiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHRcdDxoMiBjbGFzcz1cInByb2plY3QtdGl0bGVcIj4nK2l0ZW0uaGVhZGVyKyc8L2gyPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJwcm9qZWN0LXN1Yi10aXRsZVwiPicraXRlbS5zdWJUaXRsZSsnPC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0XHRcdDwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHQ8ZGl2IGNsYXNzPVwicHJvamVjdC1kZXNjXCI+IFxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0XHQgICA8c3Bhbj4nK2l0ZW0uZGVzY3JpcHRpb24rJzwvc3Bhbj4gXFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0XHRcdCAgIDxhIGNsYXNzPVwicmVhZC1yZXZpZXdcIiBkYXRhLWNvdW50PVwiJytjb3VudCsnXCI+JytyZXZpZXdMaW5rKycgJytpdGVtLmhlYWRlcisnPC9hPiBcXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHRcdCAgIDwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0PC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0PC9kaXY+IFxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHQ8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0PGRpdiBjbGFzcz1cInByb2plY3QtcmV2aWV3XCI+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0PGRpdiBjbGFzcz1cInJldmlldy1jbG9zZVwiPjwvZGl2PiBcXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHQ8ZGl2IGNsYXNzPVwicmV2aWV3XCIgaWQ9XCInK2lkZW50aWZpZXIrJ1wiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0PGRpdiBjbGFzcz1cInJldmlldy1hdXRob3JcIj4nK2F1dGhvcisnPC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcdFx0XHQ8ZGl2IGNsYXNzPVwicmV2aWV3LWRhdGVcIj4nK3Jldmlld0RhdGUrJzwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmV2aWV3LXN0YXJzXCI+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbFwiPjwvaT48aSBjbGFzcz1cImljb24tc3Rhci1mdWxsXCI+PC9pPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGxcIj48L2k+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbFwiPjwvaT48aSBjbGFzcz1cImljb24tc3Rhci1mdWxsIGZpZnRoXCI+PC9pPjwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXHRcdFx0PGRpdiBjbGFzcz1cInJldmlldy10ZXh0XCI+JytkZXNjKyc8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0XHQ8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1x0PC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJDb3VudCA9PT0gNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcucmV2aWV3LXN0YXJzJykuZmluZCgnLmZpZnRoJykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmV2aWV3ID09PSB1bmRlZmluZWQgfHwgZGVzYyA9PT0gJycgfHwgZGVzYyA9PT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3Byb2plY3QnK2NvdW50KS5maW5kKCcucmVhZC1yZXZpZXcnKS5hZGRDbGFzcygnaGlkZGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKCcucHJvamVjdC1pbWFnZXMnKS5vbignY2xpY2snLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZighJCgnYm9keScpLmhhc0NsYXNzKCdvcGVuJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucGFyZW50KCcucHJvamVjdCcpLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50SUQgPSAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgnLnByb2plY3QnKS5hdHRyKCdpZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IFwiI1wiICsgcGFyZW50SUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlckluaXQocGFyZW50SUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoJy5wcm9qZWN0LXRpdGxlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoISQoJ2JvZHknKS5oYXNDbGFzcygnb3BlbicpKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnRFbGVtID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEVsZW0uYWRkQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnRJRCA9IHBhcmVudEVsZW0uYXR0cignaWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWY9XCIjXCIrcGFyZW50SUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlckluaXQocGFyZW50SUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoJy5wcm9qZWN0LWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgnLnByb2plY3QnKS5yZW1vdmVDbGFzcygnb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50SUQgPSAkKHRoaXMpLnBhcmVudCgnLnByb2plY3QnKS5hdHRyKCdpZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjJytwYXJlbnRJRCsnIC5zbGlkZXInKS5zbGljayhcInVuc2xpY2tcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoPVwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHBhcmVudElEKS5zY3JvbGxJbnRvVmlldyh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLnJlYWQtcmV2aWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gJCh0aGlzKS5hdHRyKCdkYXRhLWNvdW50Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjcHJvamVjdFwiK2NvdW50KS5hZGRDbGFzcygnc2hvdy1yZXZpZXcnKS5maW5kKCcucHJvamVjdC1yZXZpZXcnKS5hZGRDbGFzcygnc2hvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKCcucmV2aWV3LWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnc2hvdycpLnBhcmVudCgnLnByb2plY3QnKS5yZW1vdmVDbGFzcygnc2hvdy1yZXZpZXcnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaGFzaCAmJiBoYXNoICE9PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyaW5nKDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvamVjdElEID0gXCJwcm9qZWN0XCIrY291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0SUQgPT09IGhhc2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnK2hhc2gpLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlckluaXQocHJvamVjdElEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCBcclxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNob29zZUNvb2tpZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuXHJcbmZ1bmN0aW9uIHNsaWRlckluaXQocHJvamVjdEVsZW0pe1xyXG4gICAgaWYodHlwZW9mIHByb2plY3RFbGVtID09PSAnc3RyaW5nJyl7XHJcbiAgICAgICAgJCgnIycrcHJvamVjdEVsZW0rJyAuc2xpZGVyJykubm90KCcuc2xpY2staW5pdGlhbGl6ZWQnKS5zbGljayh7XHJcbiAgICAgICAgICAgIHNsaWRlc1RvU2hvdzogMSxcclxuICAgICAgICAgICAgc2xpZGVzVG9TY3JvbGw6IDEsXHJcbiAgICAgICAgICAgIGF1dG9wbGF5OiB0cnVlLFxyXG4gICAgICAgICAgICBhdXRvcGxheVNwZWVkOiA4MDAwLFxyXG4gICAgICAgICAgICBhcnJvd3M6IHRydWVcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cclxuIiwiXHJcbnZhciB0ZXN0aW1vbmlhbCA9ICQoJyNnb29nbGUtcmV2aWV3cycpO1xyXG5cclxuJChmdW5jdGlvbigpIHtcclxuICAgIHZhciB1cmwgPSAnLi9hc3NldHMvanNvbi9jb250ZW50LmJpbic7XHJcbiAgICAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgIHNjcmlwdENoYXJzZXQ6IFwidXRmLThcIixcclxuICAgICAgICB0eXBlOiBcIkdFVFwiLFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBhY3R1YWwgPSBKU09OLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUod2luZG93LmF0b2IoZGF0YSkpKSk7XHJcbiAgICAgICAgICAgIHZhciBsb2MgPSBnZXRDb29raWUoJ2xhbmcnKTtcclxuICAgICAgICAgICAgdmFyIHByb2plY3REZXRhaWwgPSBhY3R1YWxbbG9jXS5wYWdlcy5wcm9qZWN0cztcclxuXHJcbiAgICAgICAgICAgICQuZWFjaChwcm9qZWN0RGV0YWlsLCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXZpZXcgPSBpdGVtLnJldmlld1xyXG4gICAgICAgICAgICAgICAgICAgICwgYXV0aG9yID0gcmV2aWV3LmF1dGhvciB8fCAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICwgZGVzYyA9IHJldmlldy5kZXNjcmlwdGlvbiB8fCAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICwgcmV2aWV3RGF0ZSA9IHJldmlldy5kYXRlIHx8ICcnXHJcbiAgICAgICAgICAgICAgICAgICAgLCBpZGVudGlmaWVyID0gYXV0aG9yLnJlcGxhY2UoL1teQS1aMC05XSsvaWcsIFwiLVwiKS50b0xvd2VyQ2FzZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgLCBzdGFyQ291bnQgPSByZXZpZXcuc3RhcnMgfHwgJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJldmlldyAmJiByZXZpZXcgIT09IHVuZGVmaW5lZCAmJiBkZXNjICE9PSAnJyAmJiBkZXNjICE9PSB1bmRlZmluZWQgfHwgc3RhckNvdW50ICE9PSAnJyAmJiBzdGFyQ291bnQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlc3RpbW9uaWFsLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGVzdGltb25pYWwubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXN0aW1vbmlhbC5hcHBlbmQoJzxkaXYgY2xhc3M9XCJyZXZpZXdcIiBpZD1cIicgKyBpZGVudGlmaWVyICsgJ1wiPlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZXZpZXctYXV0aG9yXCI+JyArIGF1dGhvciArICc8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmV2aWV3LWRhdGVcIj4nICsgcmV2aWV3RGF0ZSArICc8L2Rpdj5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmV2aWV3LXN0YXJzXCI+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbFwiPjwvaT48aSBjbGFzcz1cImljb24tc3Rhci1mdWxsXCI+PC9pPjxpIGNsYXNzPVwiaWNvbi1zdGFyLWZ1bGxcIj48L2k+PGkgY2xhc3M9XCJpY29uLXN0YXItZnVsbFwiPjwvaT48aSBjbGFzcz1cImljb24tc3Rhci1mdWxsIGZpZnRoXCI+PC9pPjwvZGl2PlxcbicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZXZpZXctdGV4dFwiPicgKyByZXZpZXcuZGVzY3JpcHRpb24gKyAnPC9kaXY+XFxuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgPC9kaXY+Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhckNvdW50ID09PSA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcucmV2aWV3LXN0YXJzJykuZmluZCgnLmZpZnRoJykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXZpZXdTbGlkZXIoKTtcclxuICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuXHJcbmZ1bmN0aW9uIHJldmlld1NsaWRlcigpe1xyXG4gICAgdGVzdGltb25pYWwucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgdGVzdGltb25pYWwubm90KCcuc2xpY2staW5pdGlhbGl6ZWQnKS5zbGljayh7XHJcbiAgICAgICAgc2xpZGVzVG9TaG93OiAxLFxyXG4gICAgICAgIHNsaWRlc1RvU2Nyb2xsOiAxLFxyXG4gICAgICAgIGF1dG9wbGF5OiB0cnVlLFxyXG4gICAgICAgIGZhZGU6IHRydWUsXHJcbiAgICAgICAgaW5maW5pdGU6IHRydWUsXHJcbiAgICAgICAgYXV0b3BsYXlTcGVlZDogODAwMCxcclxuICAgICAgICBhcnJvd3M6IHRydWVcclxuICAgIH0pO1xyXG59XHJcbiJdfQ==
